(function() {
    'use strict';

    angular
        .module('kd', [
            'ionic',
            'templates',
            'ui.router',
            'ngCordova',
            'ngStorage',
            'angularMoment',
            'angular-cache',
            'ti-segmented-control',
            'ui.bootstrap',
            'ionic-timepicker',
            'dateSlider',
            'flexcalendar',
            'pascalprecht.translate',
            'angular-svg-round-progressbar',
            'rpCoverHeader',
            'kd.core',
            'kd.route',
            'kd.auth',
            'kd.app',
            'kd.home',
            'kd.goal',
            'kd.event',
            'kd.my',
            'kd.setting',
            'kd.message',
            'kd.top',
            'kd.topic',
            'kd.user',
            'kd.mall',
            'kd.comm',
            'kd.explore'
        ]);
})();

/**
 * Created by Jason.z on 2016/12/18.
 */

(function () {
    'use strict';

    angular
        .module('kd.app', [

        ]);
})();

/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.auth', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.comm', [

        ]);
})();
/**
 * Created by Jason_z on 2016/12/17.
 */

(function () {
    'use strict';

    angular
        .module('kd.core', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.event', [
            'angularMoment'
        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.explore', [
            'kd.core'
        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.home', [
            'kd.core'
        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.goal', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.mall', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.message', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.my', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.route', [
            'templates',
            'ui.router',
        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.setting', [
            'kd.core'
        ]);
})();
/**
 * Created by tuo3 on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.top', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.topic', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.user', [

        ]);
})();
/**
 * Created by Jason.z on 2016/12/19.
 */

(function () {
    'use strict';

    appConfig.$inject = ["$ionicConfigProvider", "$compileProvider", "$httpProvider"];
    angular
        .module('kd')
        .config(appConfig);

    function appConfig($ionicConfigProvider, $compileProvider, $httpProvider) {

        $ionicConfigProvider.views.swipeBackEnabled(false);
        $ionicConfigProvider.tabs.position('bottom');

        $compileProvider.imgSrcSanitizationWhitelist(/^\s*(https?|file|wxLocalResource|blob|cdvfile):|data:image\//);

        $httpProvider.interceptors.push(['$q', '$location', '$rootScope', '$localStorage', '$injector', '$log', function ($q, $location, $rootScope, $localStorage, $injector, $log) {
            return {
                request: function (config) {
                    config.headers = config.headers || {};
                    config.headers.Authorization = 'Bearer ' + $localStorage.token;
                    // $log.debug("开始请求");
                    return config;
                },
                // optional method
                'requestError': function (rejection) {
                    $log.error("请求错误");
                    return $q.reject(rejection);
                },
                response: function (response) {
                    // $log.debug("获取返回结果成功");
                    // $log.debug(response);
                    return response;
                },
                // optional method
                'responseError': function (rejection) {
                    $log.error("获取返回结果失败");
                    $log.error(rejection);
                    if (rejection.status === 400 || rejection.status === 401 || rejection.status === 403) {
                        $injector.get('Loading').show('token已过期,请重新登录');
                        delete $localStorage.token;
                        $location.path('/');
                    } else {
                        $injector.get('Loading').show('接口请求错误，请检查网络或重试');
                    }
                    return $q.reject(rejection);
                }
            };
        }]);
    }
})();



/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    appRun.$inject = ["$ionicPlatform", "$localStorage", "amMoment"];
    angular
        .module('kd')
        .run(appRun);

    function appRun($ionicPlatform,$localStorage,amMoment){
        window.BOOTSTRAP_OK = true;

        $ionicPlatform.ready(function() {
            // 隐藏启动页
            if (navigator.splashscreen) {
                navigator.splashscreen.hide();
            }

            if(window.cordova&&window.plugins) {
                // 初始化jpush
                if (window.plugins.jPushPlugin) {

                    var getRegistrationID = function() {
                        window.plugins.jPushPlugin.getRegistrationID(onGetRegistrationID);
                    };
                    var onGetRegistrationID = function(data) {
                        try {
                            console.log("JPushPlugin:registrationID is " + data);
                            if (data.length == 0) {
                                var t1 = window.setTimeout(getRegistrationID, 1000);
                            } else {
                                $localStorage.push_id =  data;
                            }
                        } catch (exception) {
                            console.log(exception);
                        }
                    };


                    window.plugins.jPushPlugin.init();

                    getRegistrationID();
                    if (device.platform != "Android") {
                        window.plugins.jPushPlugin.setDebugModeFromIos();
                        window.plugins.jPushPlugin.setApplicationIconBadgeNumber(0);
                    } else {
                        window.plugins.jPushPlugin.setDebugMode(true);
                        window.plugins.jPushPlugin.setStatisticsOpen(true);
                    }

                    window.plugins.jPushPlugin.setDebugMode(false);

                }

                if(window.cordova.plugins.Keyboard) {
                    cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);
                    cordova.plugins.Keyboard.disableScroll(true);
                }

                if(window.weibo) {
                    window.weibo.init(1114202144, "http://www.keepdays.com", function(){

                    }, function(err){
                        console.log("微博SDK初始化失败");
                        console.log(err);
                    });
                }
            }
        });

        amMoment.changeLocale('zh-cn');

    }

})();

(function() {

    'use strict';

    AppController.$inject = ["$http", "$localStorage", "ENV", "$interval"];
    angular
        .module('kd.app')
        .controller('AppController', AppController);  

    function AppController($http,$localStorage,ENV,$interval) {
        var vm = this;

        function getNewMessages(){
            if($localStorage.user) {
                var user_id = $localStorage.user.user_id;
                $http.get(ENV.apiUrl + 'user/new_messages?user_id='+user_id)
                    .success(function(response) {
                        if (response.status) {
                            vm.count = response.count;
                            $localStorage.new_messages_count = response.count;
                        } 
                    }).error(function(error) {
                    });
            }
        }

        // 每分钟获取
        var timer =  $interval(getNewMessages,60000);

        timer.then(success, error, notify);
        function success(){
            // console.log("done");
        }
        function error(){
            // console.log("error");
        }
        function notify(){
            // console.log("每次都更新");
        }

    }
    
})(); 
(function() {

    'use strict';

    	InitController.$inject = ["$state", "$log", "$localStorage", "Auth"];
    angular
        .module('kd.app')
        .controller('InitController', InitController);  

        function InitController($state,$log,$localStorage,Auth) {

         	var vm = this;


			if($localStorage.is_guide) {
				startApp();
			}

         	vm.startApp = function() {
         		if(!$localStorage.is_guide) {
					$localStorage.is_guide = true;
				}
				startApp();
			};

		    function startApp() {
                $log.debug("开始检查是否登录...");
		        if(Auth.isLogin()){
                    $log.debug("已登录，跳转至首页");
		            $state.go('app.home');
		        } else {
					$state.go('login');
				}
		    }

    	}
})(); 
(function() {
    'use strict';

    Auth.$inject = ["$http", "$q", "$localStorage", "ENV"];
    angular
        .module('kd.auth')
        .factory('Auth', Auth);

    function Auth($http, $q, $localStorage,ENV) {

        var service = {
            login: login,
            register:register,
            bind:bind,
            isLogin: isLogin,
            getEmail:getEmail,
            getUserId:getUserId
        };

        return service;

        function login(email,password) {
            $http.post(ENV.apiUrl + 'auth/login', {
                email:email,
                password:password
            }).success(function(){

            }).error(function(){

            });
        }

        function register(email,password) {
            $http.post(ENV.apiUrl + 'auth/register', {
                email:email,
                password:password
            }).success(function(){

            }).error(function(){

            });
        }

        function bind(email,password,is_register) {

            var deferred = $q.defer();

            if(!$localStorage.user) {
                deferred.reject("未发现绑定对象");
            }

            var user_id = $localStorage.user.user_id;

            $http.post(ENV.apiUrl + 'auth/bind', {
                email:email,
                password:password,
                user_id:user_id,
                is_register:is_register
            }).success(function(response){
                if(response.status) {
                    $localStorage.token = response.token;
                    $localStorage.user = response.user;
                    deferred.resolve(response.user);
                } else {
                    deferred.reject(response.message);
                }
            }).error(function(error){
                deferred.reject(error);
            });

            return deferred.promise;
        }

        function isLogin() {
            if ($localStorage.user && $localStorage.token) {
                 return true;
            } 
            return false;
        }

        function getEmail() {
            if ($localStorage.user) {
                return $localStorage.user.email;
            }
            return null;
        }

        function getUserId() {
            if ($localStorage.user) {
                return $localStorage.user.user_id;
            }
            return null;
        }
    }

})();

/**
 * Created by Jason.z on 16/9/21.
 */
(function () {

    'use strict';

    BindController.$inject = ["$state", "Loading", "Auth"];
    angular
        .module('kd.auth')
        .controller('BindController', BindController);

    function BindController($state, Loading, Auth) {

        var vm = this;

        vm.user = {
            'is_register': false
        };

        vm.doBind = doBind;

        function doBind() {
            Auth.bind(vm.user.email, vm.user.password, vm.user.is_register).then(function (data) {
                Loading.show("绑定成功");
                $state.go('app.home');
            }, function (error) {
                Loading.show("绑定失败:" + error);
            });
        }


    }

})();

/**
 * Created by Jason.z on 16/10/9.
 */

(function() {

    'use strict';

    FindController.$inject = ["$http", "$ionicLoading", "ENV", "$interval"];
    angular
        .module('kd.auth')
        .controller('FindController', FindController);

    function FindController($http,$ionicLoading,ENV,$interval) {

        var vm = this;

        vm.isSend = false;

        vm.find = {};


        var timer = null;

        vm.doSend = function() {

            $ionicLoading.show({
                template: '<ion-spinner icon="ios"></ion-spinner><br>验证码发送中,请稍候...',
                noBackdrop: true,
            });

            $http.post(ENV.apiUrl + 'auth/get_verify_code',{send_type:'email',send_object:vm.email,type:'find'})
                .success(function(response) {
                    if (response.status) {
                        $ionicLoading.show({
                            template: '发送成功,请到邮箱内查收',
                            noBackdrop: true,
                            duration: 2000
                        });

                        vm.isSend = true;
                        vm.time = 60;

                        timer = $interval(function(){
                            vm.time = vm.time - 1;
                            vm.codetime = vm.time+"秒后重新获取";
                            if(vm.time === 0) {
                                vm.codetime = "发送验证码";
                                $interval.cancel(timer);
                            }
                        }, 1000);
                    } else {
                        $ionicLoading.show({
                            template: '发送失败:'+response.message,
                            noBackdrop: true,
                            duration: 2000
                        });
                    }
                }).error(function(error) {
            });
        };

        vm.doFind = function() {
            vm.find.send_type = 'email';
            vm.find.send_object = vm.email;

            $http.post(ENV.apiUrl + 'auth/find',vm.find)
                .success(function(response) {
                    if (response.status) {
                        $ionicLoading.show({
                            template: '重置成功',
                            noBackdrop: true,
                            duration: 2000
                        });
                    } else {
                        $ionicLoading.show({
                            template: '重置失败:'+response.message,
                            noBackdrop: true,
                            duration: 2000
                        });
                    }
                }).error(function(error) {
                $ionicLoading.show({
                    template: '请求接口错误',
                    noBackdrop: true,
                    duration: 2000
                });
            });
        };


    }

})();
(function () {

    'use strict';

    LoginController.$inject = ["$http", "$state", "$log", "Loading", "$localStorage", "ENV", "Auth", "OAuth", "isXiaomiChannel", "isQQInstalled", "isWeiboInstalled"];
    angular
        .module('kd.auth')
        .controller('LoginController', LoginController);

    function LoginController($http, $state, $log, Loading, $localStorage, ENV, Auth, OAuth, isXiaomiChannel, isQQInstalled, isWeiboInstalled) {

        var vm = this;

        vm.isXiaomiChannel = isXiaomiChannel;
        vm.isQQInstalled = isQQInstalled;
        vm.isWeiboInstalled = isWeiboInstalled;

        vm.user = {};
        vm.user.email = Auth.getEmail();
        vm.user.device = ionic.Platform.device();
        vm.user.device.push_id = $localStorage.push_id;

        vm.doQQLogin = OAuth.doQQLogin;
        vm.doWeiboLogin = OAuth.doWeiboLogin;
        vm.doXiaomiLogin = OAuth.doXiaomiLogin;
        vm.doLogin = doLogin;

        function doLogin() {
            Loading.showWaiting("登录中,请稍候...");
            $http.post(ENV.apiUrl + 'auth/login', vm.user).success(function (response) {
                if (response.status) {
                    $localStorage.token = response.token;
                    $localStorage.user = response.user;
                    Loading.show("登录成功");
                    $state.go('app.home');
                } else {
                    Loading.show('登录失败:' + response.message);
                }
            }).error(function (error) {
                $log.error(error);
            });
        }

    }

})(); 
(function () {
    'use strict';

    OAuth.$inject = ["$http", "$localStorage", "Loading", "$log", "$state", "ENV"];
    angular
        .module('kd.auth')
        .factory('OAuth', OAuth);

    function OAuth($http, $localStorage, Loading, $log, $state, ENV) {

        var isCheckQQInstalled = 0;

        var service = {
            doWeiboLogin: doWeiboLogin,
            doQQLogin: doQQLogin,
            doXiaomiLogin: doXiaomiLogin,
            isWeiboInstalled: isWeiboInstalled,
            isQQInstalled: isQQInstalled,
        };

        return service;


        function doThirdLogin(provider, data) {
            // var loginData = {};
            data.provider = provider;
            data.device = ionic.Platform.device();
            data.push_id = $localStorage.push_id;

            Loading.showWaiting("登录中，请稍候...");

            $http.post(ENV.apiUrl + 'auth/oauth', data)
                .success(function (response, status, headers, config) {
                    if (response.status) {
                        var user = response.user;
                        $localStorage.user = user;
                        Loading.show("登录成功");
                        if (user.email) {
                            $localStorage.token = response.token;
                            $state.go('app.home');
                        } else {
                            $state.go('bind');
                        }
                    } else {
                        Loading.show("登录失败:" + response.message);
                    }
                })
                .error(function (error) {
                    Loading.show("API接口请求错误，请检查网络或重试");
                    $log.error(error);
                });
        }

        function isQQInstalled() {
            if (window.cordova && YCQQ) {
                $log.debug("QQ登录插件加载成功！");
                return YCQQ.checkClientInstalled(function () {
                    $log.debug("安装QQ客户端");
                    isCheckQQInstalled = 1;
                    return true;
                }, function () {
                    $log.debug("未安装QQ客户端");
                    return false;
                });
            } else {
                $log.debug("QQ登录插件未加载！");
                return false;
            }
        }

        function isWeiboInstalled() {
            // if(window.cordova&&YCWeibo){
            //     $log.debug("微博登录插件加载成功！");
            //     return true;
            // } else {
            //     $log.debug("微博登录插件未加载！");
            //     return false;
            // }
            if (window.cordova && window.weibo) {
                $log.debug("微博登录插件加载成功！");
                return true;
            } else {
                $log.debug("微博登录插件未加载！");
                return false;
            }
        }

        function doWeiboLogin() {
            if (isWeiboPluginLoaded) {
                // YCWeibo.ssoLogin(function (response) {
                window.weibo.login(function (response) {
                    $log.debug("微博登录成功", response);
                    // 获取用户信息
                    var url = "https://api.weibo.com/2/users/show.json?uid=" + response.uid + "&access_token=" + response.token;
                    $log.debug(url);
                    $http.get(url).success(function (data) {
                        $log.debug(data);
                        if (data.error_code) {
                            Loading.show('获取微博用户信息失败');
                        } else {
                            response.userid = response.uid;
                            response.access_token = response.token;
                            response = angular.extend(response, data);
                            doThirdLogin('weibo', response);
                        }
                    }).error(function (error) {
                        $log.error(error);
                        Loading.show("获取微博用户信息接口错误");
                    });

                }, function (reason) {
                    $log.error("微博登录失败", reason);
                });
            }
        }

        function doQQLogin() {
            YCQQ.ssoLogin(function (response) {
                $log.debug("QQ登录成功", response);
                Loading.showWaiting("正在获取用户信息...");

                // 获取用户信息
                var url = "https://graph.qq.com/user/get_user_info?access_token=" + response.access_token + "&oauth_consumer_key=1104758278&openid=" + response.userid;
                $log.debug(url);

                $http.get(url).success(function (data) {
                    $log.debug(data);
                    if (data.ret == 0) {
                        response = angular.extend(response, data);
                        doThirdLogin('qq', response);
                    } else {
                        Loading.show("获取用户信息失败" + data.msg);
                    }
                }).error(function (error) {
                    $log.error(error);
                    Loading.show("获取QQ用户接口错误");
                });

            }, function (error) {
                $log.error(error);
                if (error.user_cancelled == 'YES') {
                    Loading.show("登录取消");
                } else {
                    Loading.show("登录失败");
                }
            }, isCheckQQInstalled);
        }

        function doXiaomiLogin() {
            var data = {};

            $log.debug("小米SDK开始登录...");

            Xiaomi.getAccessToken(function (token) {
                data = token;
                $log.debug("获取token成功:");
                $log.error(token);

                Xiaomi.getOpenId(function (openID) {
                    $log.debug("获取openid成功:");
                    $log.error(openID);
                    data.openid = openID;

                    Xiaomi.getProfile(function (profile) {
                        $log.debug("获取profile成功:");
                        data = angular.extend(data, profile);

                        doThirdLogin('xiaomi', data);
                    }, function (error) {
                        $log.debug("获取profile失败:", error);
                    });
                }, function (error) {
                    $log.debug("获取openid失败:", error);
                });
            }, function (error) {
                $log.debug("获取token失败:", error);
            });
        }


    }

})();

(function () {

    'use strict';

    RegisterController.$inject = ["$http", "$state", "$localStorage", "Loading", "ENV", "OAuth", "isXiaomiChannel", "isQQInstalled", "isWeiboInstalled"];
    angular
        .module('kd.auth')
        .controller('RegisterController', RegisterController);

    function RegisterController($http, $state, $localStorage, Loading, ENV, OAuth, isXiaomiChannel, isQQInstalled, isWeiboInstalled) {

        var vm = this;

        vm.isXiaomiChannel = isXiaomiChannel;
        vm.isQQInstalled = isQQInstalled;
        vm.isWeiboInstalled = isWeiboInstalled;

        vm.user = {};
        vm.user.device = ionic.Platform.device();
        vm.user.device.push_id = $localStorage.push_id;

        vm.doQQLogin = OAuth.doQQLogin;
        vm.doWeiboLogin = OAuth.doWeiboLogin;
        vm.doRegister = doRegister;

       function doRegister() {
            Loading.showWaiting('注册中,请稍候...');
            $http.post(ENV.apiUrl + 'auth/register', vm.user).success(function (response) {
                if (response.status) {
                    Loading.show('注册成功');
                    $localStorage.token = response.token;
                    $localStorage.user = response.user;
                    $state.go('app.home');
                } else {
                    Loading.show('注册失败:' + response.message);
                }
            }).error(function (error) {
            });
        }
    }

})(); 
angular.module('kd.comm', [])

    .filter('parseUrl', function () {

        var replacePattern = /\b((http:\/\/|https:\/\/|ftp:\/\/|mailto:|news:)|www\.|ftp\.|[^ \,\;\:\!\)\(\""\'<>\f\n\r\t\v]+@)([^ \,\;\:\!\)\(\""\'<>\f\n\r\t\v]+)\b/gim;

        return function (text, target, otherProp) {
            var originText = text;
            if (text === undefined || text === "") {
                return "";
            } else {
                return text.replace(replacePattern, function ($0, $1) {
                    var match = $0;
                    var protocol = $1;

                    // if ((/^www\./i).test(match))
                    // {
                    //    return "<span onclick=\"window.open('http://" + match + "', '_system');\" class='link_url'>" + match + "</span>";
                    // }
                    // if ((/^ftp\./i).test(match))
                    // {
                    //    return "<span onclick=\"window.open('ftp://" + match + "', '_system');\" class='link_url'>" + match + "</span>";
                    // }

                    // if (protocol && protocol.charAt(0) === '@')
                    // {
                    //    return "<a href=\"mailto:" + match + "\">" + match + "</a>";
                    // }

                    return "<a href=\"" + match + "\"  target=\"_blank\" class='positive'><i class='ion-link'></i>网页链接</span>";
                });
            }
        };
    })

    .filter('trustHtml', ["$sce", function ($sce) {

        return function (input) {

            return $sce.trustAsHtml(input);

        };

    }])

    .filter('cutStr', function () {

        return function (value, wordwise, max, tail) {
            if (!value) return '';

            max = parseInt(max, 10);
            if (!max) return value;
            if (value.length <= max) return value;

            value = value.substr(0, max);
            if (wordwise) {
                var lastspace = value.lastIndexOf(' ');
                if (lastspace != -1) {
                    value = value.substr(0, lastspace);
                }
            }

            return value + (tail || '...');
        };


    })


    .filter('isEmpty', function () {
        var bar;
        return function (obj) {
            return angular.equals({}, obj) || obj == null;
        };
        // var bar;
        // return function (obj) {
        //   for (bar in obj) {
        //     if (obj.hasOwnProperty(bar)) {
        //       return false;
        //     }
        //   }
        //   return true;
        // };
    });

/**
 * 通用服务
 * Created by Jason.z on 2016/12/14.
 */

(function () {
    'use strict';

    Comm.$inject = ["$q", "$log"];
    angular
        .module('kd.comm')
        .factory('Comm', Comm);

    function Comm($q,$log) {

        var service = {
            getUmengChannel: getUmengChannel,
            isXiaoMiChannel:isXiaoMiChannel
        };

        function getUmengChannel() {
            var deferred = $q.defer();

            if (ionic.Platform.isAndroid()) {
                if (cordova && cordova.plugins && cordova.plugins.AppConfig) {
                    cordova.plugins.AppConfig.fetch(['UMENG_CHANNEL'], function (result) {
                        deferred.resolve(result.UMENG_CHANNEL);
                    });
                }
            } else if (ionic.Platform.isIOS() || ionic.Platform.isIPad()) {
                deferred.resolve("appstore");
            } else {
                deferred.resolve(null);
            }

            return deferred.promise;
        }

        function isXiaoMiChannel(){
            return getUmengChannel().then(function(channel){
                $log.debug(channel);
                if(channel == "xiaomi") {
                    return true;
                }
                return false;
            },function(error){
                return false;
            });
        }

        return service;


    }

})();


/**
 * Created by Jason.z on 2016/11/4.
 */
(function() {

    'use strict';

    angular
        .module('kd.comm')
        .directive('goBack', goBack);

    function goBack () {
        return {
            restrict: 'E',
            template:'<a class="button button-clear icon ion-ios-arrow-left" ng-click="vm.goBack()"></a>',
            controller:["$state", "$element", "$scope", "$ionicHistory", function($state,$element,$scope,$ionicHistory){
                var  vm = this;

                vm.goBack = function(){
                    if($ionicHistory.backView()) {
                        $ionicHistory.goBack();
                    } else {
                        $state.go('app.home');
                    }
                };

            }],
            controllerAs: 'vm',
            bindToController: true,
        };

    }




})();
/**
 * Created by Jason.z on 2016/11/2.
 */
(function() {

    'use strict';

    angular
        .module('kd.comm')
        .directive('goState', goState);

    function goState () {
        return {
            restrict: 'A',
            scope:{
              goState:'='
            },
            controller:["$state", "$element", "$scope", function($state,$element,$scope){
                var obj;
                var vm = this;
                $scope.$watch(function(){
                    return vm.goState;
                } , function(value){
                    obj = value;
                });

                $element.bind('click', function(event) {
                    if(obj.params&&obj.state) {
                        event.stopPropagation();
                        event.preventDefault();
                        $state.go(obj.state,obj.params);
                    }
                });
            }],
            controllerAs: 'vm',
            bindToController: true,
        };

    }

})();
/**
 * Created by Jason.z on 2016/11/25.
 */

(function() {

    'use strict';

    angular
        .module('kd.comm')
        .directive('imageOnload', imageOnload);

    function imageOnload () {
        return {
            restrict: 'A',
            link: function (scope, element, attrs) {
                element.bind('load', function () {
                    //call the function that was passed
                    scope.$apply(attrs.imageOnload);
                });
            }
        };
    }

})();

/**
 * Created by Jason.z on 2016/10/27.
 */

(function() {
    'use strict';

    Loading.$inject = ["$ionicLoading"];
    angular
        .module('kd.comm')
        .factory('Loading', Loading);

    function Loading($ionicLoading) {

        var service = {
            show:show,
            showWaiting:showWaiting,
            hide:hide,
        };

        function show(content) {
            $ionicLoading.show({
                template: content || '数据加载中...',
                animation: 'fade-in',
                noBackdrop: true,
                duration: 2000
            });
        }

        function showWaiting(content) {
            $ionicLoading.show({
                template: '<ion-spinner icon="ios"></ion-spinner><br>'+content,
                noBackdrop: false,
            });
        }

        function hide() {
            $ionicLoading.hide();
        }

        return service;
    }

})();

/**
 * Created by Jason.z on 16/7/20.
 */


(function () {
    'use strict';

    Modal.$inject = ["$ionicModal", "$rootScope", "$q", "$controller"];
    angular
        .module('kd.comm')
        .factory('Modal', Modal);

    function Modal($ionicModal, $rootScope, $q, $controller) {
        var vm = this;

        return {
            show: show
        };

        function show(templeteUrl, controller, parameters, options) {

            var deferred = $q.defer(),
                ctrlInstance,
                modalScope = $rootScope.$new(),
                thisScopeId = modalScope.$id,
                defaultOptions = {
                    animation: 'slide-in-up',
                    focusFirstInput: false,
                    backdropClickToClose: true,
                    hardwareBackButtonClose: true,
                    modalCallback: null
                };

            options = angular.extend({}, defaultOptions, options);

            $ionicModal.fromTemplateUrl(templeteUrl, {
                scope: modalScope,
                animation: options.animation,
                focusFirstInput: options.focusFirstInput,
                backdropClickToClose: options.backdropClickToClose,
                hardwareBackButtonClose: options.hardwareBackButtonClose
            }).then(function (modal) {
                modalScope.modal = modal;

                modalScope.openModal = function () {
                    modalScope.modal.show();
                };
                modalScope.closeModal = function (result) {
                    deferred.resolve(result);
                    modalScope.modal.hide();
                };
                modalScope.$on('modal.hidden', function (thisModal) {
                    if (thisModal.currentScope) {
                        var modalScopeId = thisModal.currentScope.$id;
                        if (thisScopeId === modalScopeId) {
                            deferred.resolve(null);
                            _cleanup(thisModal.currentScope);
                        }
                    }
                });

                // Invoke the controller
                var locals = {'$scope': modalScope, 'parameters': parameters};
                var ctrlEval = _evalController(controller);
                ctrlInstance = $controller(controller, locals);
                if (ctrlEval.isControllerAs) {
                    ctrlInstance.openModal = modalScope.openModal;
                    ctrlInstance.closeModal = modalScope.closeModal;
                }

                modalScope.modal.show()
                    .then(function () {
                        modalScope.$broadcast('modal.afterShow', modalScope.modal);
                    });

                if (angular.isFunction(options.modalCallback)) {
                    options.modalCallback(modal);
                }

            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }

        function _cleanup(scope) {
            scope.$destroy();
            if (scope.modal) {
                scope.modal.remove();
            }
        }

        function _evalController(ctrlName) {
            var result = {
                isControllerAs: false,
                controllerName: '',
                propName: ''
            };
            var fragments = (ctrlName || '').trim().split(/\s+/);
            result.isControllerAs = fragments.length === 3 && (fragments[1] || '').toLowerCase() === 'as';
            if (result.isControllerAs) {
                result.controllerName = fragments[0];
                result.propName = fragments[2];
            } else {
                result.controllerName = ctrlName;
            }

            return result;
        }
    }

})();
(function() {
    'use strict';

	    Timer.$inject = ["$http", "$localStorage", "$interval", "ENV"];
    angular
        .module('kd.comm')
        .factory('Timer', Timer);

        function Timer($http, $localStorage, $interval,ENV) {

	        var service = {
	            start: start,
	        };

	        function getNewMessages(){

	        	if($localStorage.user) {
	        		var user_id = $localStorage.user.user_id;
		            $http.get(ENV.apiUrl + 'user/new_messages?user_id='+user_id)
		                .success(function(response) {
		                    if (response.status) {
		                       $localStorage.new_messages = response.new_messages;
		                    } 
		                }).error(function(error) {

		                });
	        	}
	        }

	        function start() {
	        	$interval(getNewMessages(),6000);
	        }

	    	return service;

	    }

 })();
/**
 * Created by Jason.z on 16/9/27.
 */

(function () {
    'use strict';

    Update.$inject = ["$http", "$q", "$log", "Loading", "$ionicPopup", "$cordovaInAppBrowser", "ENV"];
    angular
        .module('kd.comm')
        .factory('Update', Update);

    function Update($http, $q, $log, Loading, $ionicPopup, $cordovaInAppBrowser, ENV) {

        var service = {
            check: check,
            update: update,
            checkAndUpdate: checkAndUpdate
        };

        /**
         * 检查更新
         */
        function check() {
            var deferred = $q.defer();

            $http.post(ENV.apiUrl + 'update/check', {platform: ionic.Platform.platform(), version: ENV.version})
                .success(function (response) {
                    $log.debug("更新结果;");
                    $log.debug(response);
                    if (response.status) {
                        deferred.resolve(response.version);
                    } else {
                        $log.error("更新失败");
                        $log.error(response.message);
                        deferred.reject(response.message);
                    }
                }).error(function (error) {
                deferred.reject(error);
            });

            return deferred.promise;
        }

        /**
         * 执行更新
         * @param version 检查版本对象
         */
        function update(version) {

            var deferred = $q.defer();

            if (!version) {
                deferred.reject("参数非法");
            } else {
                var type = version.type;

                var confirmPopup = $ionicPopup.confirm({
                    title: '发现新版本了!!!!',
                    template: version.content,
                    cancelText: '稍候再说',
                    okText: '马上更新'
                });

                confirmPopup.then(function (res) {
                    if (res) {
                        deferred.resolve("检查更新");
                        if (type == 1) {
                            checkResUpdate();
                        } else if (type == 2) {
                            gotoStore();
                        }
                    } else {
                        deferred.reject("取消更新");
                    }
                });
            }

            return deferred.promise;

        }

        /**
         * 检查更新并执行
         */
        function checkAndUpdate() {
            var deferred = $q.defer();

            // // 检查本地配置
            // if(!$localStorage.check_update) {
            //     var now = Math.floor(Date.now() / 1000);
            //     // 3天检查一次更新
            //     if($localStorage.last_check_update_time+86400*3>now) {
            //         deferred.resolve("跳过更新");
            //         return;
            //     }
            // }

            // 服务端检查
            check().then(function (version) {
                if (version.no > ENV.version) {
                    update(version).then(function (success) {
                        // $localStorage.check_update = true;
                        deferred.resolve("开始更新");
                    }, function (error) {
                        // $localStorage.check_update = false;
                        // $localStorage.last_check_update_time = Math.floor(Date.now() / 1000);
                        deferred.reject(error);
                    });
                }
            }, function (error) {
                deferred.reject(error);
            });

            return deferred.promise;

        }

        /**
         * 跳转到商店
         */
        function gotoStore() {

            var url = '';

            if (ionic.Platform.platform() == 'Android') {
                url = 'market://details?id=me.growu.drip';
            } else if (ionic.Platform.platform() == 'iOS') {
                url = 'itms://itunes.apple.com/us/app/apple-store/id1017364870?mt=8';
            }

            var options = {
                location: 'yes',
                clearcache: 'yes',
                toolbar: 'no'
            };

            Loading.showWaiting('正在跳转到商店...');

            document.addEventListener("deviceready", function () {
                $cordovaInAppBrowser.open(url, '_blank', options)
                    .then(function (event) {
                        // success
                        Loading.hide();
                    })
                    .catch(function (event) {
                        // error
                        $log.error('跳转失败');
                        $log.error(event);
                        Loading.hide();
                    });

                // $cordovaInAppBrowser.close();

            }, false);
        }

        /**
         * 资源更新
         */
        function checkResUpdate() {
            var fs = new CordovaPromiseFS({
                Promise: $q
            });
            // Initialize a CordovaAppLoader
            var loader = new CordovaAppLoader({
                fs: fs,
                serverRoot: ENV.downUrl,
                localRoot: 'app',
                cacheBuster: true, // make sure we're not downloading cached files.
                checkTimeout: 10000 // timeout for the "check" function - when you loose internet connection
            });

            function onProgress(ev) {
                Loading.showWaiting('正在下载资源包' + parseInt(ev.percentage * 100) + '%...');
            }

            loader.check().then(function (updateAvailable) {
                if (updateAvailable) {
                    loader.download(onProgress)
                        .then(function (manifest) {
                                Loading.showWaiting('正在覆盖旧的资源...');
                                loader.update();
                                Loading.show('更新成功');
                            },
                            function (error) {
                                $log.error("下载错误:", error);
                                Loading.show('资源下载失败,请检查网络配置重新尝试');
                            }
                        );
                } else {
                    $log.error("无更新内容");
                }
            });
        }

        return service;

    }

})();



/**
 * Created by Jason.z on 16/8/3.
 */
(function() {
    'use strict';

    Upload.$inject = ["$q", "$localStorage", "$cordovaImagePicker", "$cordovaFileTransfer", "Loading", "$log", "ENV"];
    angular
        .module('kd.comm')
        .factory('Upload', Upload);

    function Upload($q, $localStorage,$cordovaImagePicker,$cordovaFileTransfer,Loading, $log,ENV) {

        var service = {
            imageUpload: imageUpload,
        };

        // 图片上传
        function imageUpload(){
            var deferred = $q.defer();

            var options = {
                maximumImagesCount: 1,
                width: 512,
                height: 512,
                quality: 100
            };

            $cordovaImagePicker.getPictures(options)
                .then(function(results) {
                    $log.debug("选择照片结果:",results);
                    if(results.length == 0) {
                        Loading.show("未选择图片");
                        return;
                    }

                    Loading.show("图片上传中:0%");

                    var fileURL = results[0];

                    var options = {};
                    options.fileKey = "file";
                    options.fileName = fileURL.substr(fileURL.lastIndexOf('/') + 1);
                    options.mimeType = "image/jpeg";

                    var headers = {
                        'Authorization': 'Bearer ' +$localStorage.token,
                    };
                    options.headers = headers;

                    $cordovaFileTransfer.upload(encodeURI(ENV.apiUrl+'upload/image'), fileURL, options)
                        .then(function(result) {
                            $log.info("上传结果:");

                            result = JSON.parse(result.response);
                            $log.info(result);

                            if(result.status) {
                               Loading.show("上传成功");
                                deferred.resolve(result.data);
                            } else {
                                deferred.reject(result.message);
                            }
                        }, function(error) {
                            Loading.show("上传失败，请重试");
                            $log.debug(error);
                            deferred.reject(error);
                        }, function(progress) {
                            var downloadProgress = (progress.loaded / progress.total) * 100;
                            $log.debug('上传进度:'+downloadProgress);
                            Loading.showWaiting("图片上传中：" + Math.floor(downloadProgress) + "%");
                            if (downloadProgress > 99) {
                               Loading.hide();
                            }
                        });
                }, function(error) {
                    deferred.reject(error);
                });

            return deferred.promise;
        }

        return service;

    }

})();


/**
 * Created by Jason_z on 2016/12/17.
 */

(function () {
    'use strict';

    coreConfig.$inject = ["$controllerProvider", "$compileProvider", "$filterProvider", "$provide", "$animateProvider", "$logProvider", "$localStorageProvider", "$translateProvider"];
    angular
        .module('kd.core')
        .config(coreConfig);

    function coreConfig( $controllerProvider, $compileProvider, $filterProvider, $provide, $animateProvider, $logProvider, $localStorageProvider, $translateProvider) {

        var core = angular.module('kd.core');
        // registering components after bootstrap
        core.controller = $controllerProvider.register;
        core.directive = $compileProvider.directive;
        core.filter = $filterProvider.register;
        core.factory = $provide.factory;
        core.service = $provide.service;
        core.constant = $provide.constant;
        core.value = $provide.value;



        // Disables animation on items with class .ng-no-animation
        $animateProvider.classNameFilter(/^((?!(ng-no-animation)).)*$/);

        $logProvider.debugEnabled(true);

        // $localStorageProvider.setKeyPrefix('wdk');

        $translateProvider.translations('zh-cn', {
            JANUARY: '一月',
            FEBRUARY: '二月',
            MARCH: '三曰',
            APRIL: '四月',
            MAI: '五月',
            JUNE: '六月',
            JULY: '七月',
            AUGUST: '八月',
            SEPTEMBER: '九月',
            OCTOBER: '十月',
            NOVEMBER: '十一月',
            DECEMBER: '十二月',

            SUNDAY: '日',
            MONDAY: '一',
            TUESDAY: '二',
            WEDNESDAY: '三',
            THURSDAY: '四',
            FRIDAY: '五',
            SATURDAY: '六'
        });
        $translateProvider.preferredLanguage('zh-cn');


    }
})();

angular.module('kd.core', [])

// 定义环境
.constant('ENV',{
	"debug":true,// 测试模式
	"version":"0.3.0",// 版本
	// "apiUrl":"http://192.168.2.14/kd/public/api/",
	// "resUrl":"http://192.168.2.14/kd/public/uploads/",
	'homeUrl':"http://drip.growu.me",
	'downUrl':"http://drip.growu.me/update",
	"apiUrl":"http://drip.growu.me/api/",
	"resUrl":"http://drip.growu.me/uploads/",
});

/**
 * Created by Jason.z on 2016/12/8.
 */

(function() {
    'use strict';

    Comment.$inject = ["$http", "$q", "$localStorage", "$ionicLoading", "$ionicActionSheet", "$ionicHistory", "$state", "ENV", "Auth", "User", "Loading"];
    angular
        .module('kd.event')
        .factory('Comment', Comment);

    function Comment($http, $q, $localStorage,$ionicLoading,$ionicActionSheet,$ionicHistory, $state,ENV,Auth,User,Loading) {

        var service = {
            doLike: doLike,
        };

        function doLike(comment) {
            var deferred = $q.defer();

            $http.post(ENV.apiUrl + 'comment/like', {
                comment_id:comment.comment_id
            }).success(function(response) {
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function(error) {
                deferred.reject(error);
            });
            return deferred.promise;
        }

        return service;
    }

})();

/**
 * Created by Jason.z on 2016/10/26.
 */
(function() {

    'use strict';

    EventContentController.$inject = ["$scope", "$compile", "$element"];
    angular
        .module('kd.event')
        .directive('eventContent', eventContent);

    function eventContent () {
        return {
            restrict: 'E',
            scope: {
                content:'@',
            },
            controller:EventContentController,
            controllerAs: 'eventcontent',
            bindToController: true,
        };

    }

    angular
        .module('kd.event')
        .controller('EventContentController', EventContentController);
    function EventContentController($scope,$compile,$element) {
        var vm = this;
        var content = vm.content;
        var isShow = false;

        // 网页链接替换
        // var linkPattern = /(https?:\/\/[^\s]+)/g;
            var linkPattern = /\b((http:\/\/|https:\/\/|ftp:\/\/|mailto:|news:)|www\.|ftp\.|[^ \,\;\:\!\)\(\""\'<>\f\n\r\t\v]+@)([^ \,\;\:\!\)\(\""\'<>\f\n\r\t\v]+)\b/gim;
            content = content.replace(linkPattern, function ($0, $1) {
                var match = $0;
                return "<a href='" + match + "' target='_blank' class='positive'><i class='ion-link'></i>网页链接</a>";
            });

            var topicPattern = /\#([^\#|.]+)\#/g;

            content = content.replace(topicPattern, function ($0, $1) {
                var match = $0;
                var protocol = $1;
                return "<a href='#/topic/" + protocol + "' class='positive'>"+match+"</a>";
            });

            var atPattern = /\@([^\@|.|<|,|:|：|^ ]+)/g;
            // var atPattern = /\@([^<,，：:\s@]+)/g;

            content = content.replace(atPattern, function ($0, $1) {
                var match = $0;
                var protocol = $1;
                return "<a href='#/user/nickname/" + protocol + "' class='positive'>"+match+"</a>";
            });



        if(content.length > 100) {
            isShow = true;
            vm.content1 =  content.substr(0, 100)+'...<a style=\"color:#0c9\" ng-click="eventcontent.hideMore($event)"> 显示全文</a>';
        } else {
            vm.content1 = content;
        }


        vm.showMore = function ($event){
            $event.preventDefault();
            $event.stopPropagation();
            if(isShow) {
                vm.content1 =  content.substr(0, 100)+'...<a href="#" style="color:#0c9" ng-click="eventcontent.hideMore($event)">全文</a>';
            }
        };

        vm.hideMore = function ($event) {
            $event.preventDefault();
            $event.stopPropagation();
            if(isShow) {
                vm.content1 =  content+'<a href="#" style="color:#0c9" ng-click="eventcontent.showMore($event)"> 收起全部</a>';
            }
        };

        $scope.$watch(function(){
                return vm.content1;
            },
            function (value) {
                var ele = $compile('<p>'+value+'</p>')($scope);
                $element.html(ele);
            }
        );
    }


})();
(function () {

    'use strict';

    EventInfoController.$inject = ["$stateParams", "$timeout", "User", "ENV", "Event", "Comment", "$ionicActionSheet"];
    angular
        .module('kd.event')
        .controller('EventInfoController', EventInfoController);

    function EventInfoController($stateParams,$timeout, User, ENV, Event,Comment,$ionicActionSheet) {
        var vm = this;
        vm.event = {};
        vm.comment = {
            content:'',
            parent:null
        };
        vm.resUrl = ENV.resUrl;

        vm.reply = {
            user_id:'',
            nickname:''
        };

        var eventId = $stateParams.eventId;

        Event.getInfo(eventId).then(function (data) {
            vm.event = data;
        });

        vm.doComment = function () {
            Event.doComment(eventId, vm.comment).then(function (data) {
                console.log("comment success");
                vm.event.comments.splice(0, 0, data);
                vm.event.comment_count += 1;
            });
        };

        function reply(comment) {
            vm.comment.parent = comment;
            var input =  angular.element("#reply-input");
            var nickname = comment.user.nickname.length>0?comment.user.nickname:'keeper'+comment.user_id;
            input.attr('placeholder','回复'+nickname);
            if(window.cordova&&window.cordova.plugins.Keyboard) {
                $timeout(function(){
                    cordova.plugins.Keyboard.disableScroll(true);
                    cordova.plugins.Keyboard.show();
                },1000);

            } else {
                input.focus();
            }
        }

        vm.doReply = function (comment,$event) {
            $event.stopPropagation();
            $event.preventDefault();
            reply(comment);
        };

        vm.clearReplay = function() {
            vm.reply = {
                user_id:'',
                nickname:''
            };
        };

        vm.showCommentMenu = function (comment,$event) {
            $ionicActionSheet.show({
                buttons: [
                    {text: '回复'},
                    {text: '举报'},
                ],
                destructiveText: '',
                titleText: '更多操作',
                cancelText: '取消',
                cancel: function () {
                    return true;
                },
                buttonClicked: function (index) {
                    if (index == 0) {
                        reply(comment);
                    }
                    if (index == 1) {
                        User.doReport('comment', comment.comment_id).then(function (response) {
                        }, function (error) {

                        });
                    }
                    return true;
                }
            });

            window.addEventListener('native.keyboardhide', function (e){
               if(vm.comment.content.length == 0) {
                   vm.comment.parent = null;
               }
            });

            vm.doLike = function(comment,$event) {
                $event.stopPropagation();
                $event.preventDefault();

                Comment.doLike(comment).then(function(response){
                    comment.is_like = response.is_like;
                    if(response.is_like) {
                        comment.like_count ++;
                    } else {
                        comment.like_count --;
                    }
                },function(error){

                });
            };

        };

    }

})(); 
(function() {

    'use strict';

    EventLikeController.$inject = ["$ionicHistory", "$stateParams", "Event"];
    angular
        .module('kd.event')
        .controller('EventLikeController', EventLikeController);  

    function EventLikeController($ionicHistory,$stateParams,Event) {
        var vm = this;
        vm.users = [];

        $ionicHistory.nextViewOptions({
            disableBack: true
        });

        var eventId = $stateParams.eventId;
        vm.eventId = eventId;

        Event.getLikes(eventId).then(function(data){
            vm.users = data;
        });

    
    }
    
})(); 
/**
 * Created by Jason.z on 2016/10/31.
 */

(function() {

    'use strict';

    EventListController.$inject = ["Event", "ENV"];
    angular
        .module('kd.event')
        .directive('eventList', eventList);

    function eventList () {
        return {
            restrict: 'E',
            scope: {
                events:'=',
                onRefresh:'&',
                onInfinite:'&'
            },
            controller:EventListController,
            controllerAs: 'eventlist',
            bindToController: true,
            templateUrl: 'templates/event_list.html',
        };

    }

    angular
        .module('kd.event')
        .controller('EventListController', EventListController);
    function EventListController(Event,ENV) {
        var vm = this;

        vm.resUrl = ENV.resUrl;

        vm.showMore = function(eventId){
            Event.showMore(eventId);
        };

        vm.doLike = function(event) {

            var index = vm.events.indexOf(event);

            Event.doLike(event.event_id).then(function(response) {
                if (response == 'post') {
                    // $ionicLoading.show({template: "点赞成功",noBackdrop: true, duration: 2000});
                    vm.events[index].is_like = true;
                    vm.events[index].like_count++;
                } else if (response == 'cancle') {
                    // $ionicLoading.show({template: "取消点赞",noBackdrop: true, duration: 2000});
                    vm.events[index].is_like = false;
                    vm.events[index].like_count --;
                }
            }, function(error) {
                // $ionicLoading.show({
                //     template: "操作失败："+data.msg,
                //     noBackdrop: true,
                //     duration: 2000
                // });
            });
        };


    }


})();
/**
 * Created by Jason.z on 2016/11/24.
 */

(function () {

    'use strict';

    EventShareController.$inject = ["Event", "$q", "Loading", "$log", "$ionicScrollDelegate", "$cordovaSocialSharing", "$timeout", "$stateParams", "ENV"];
    angular
        .module('kd.event')
        .controller('EventShareController', EventShareController);

    function EventShareController(Event, $q, Loading, $log, $ionicScrollDelegate, $cordovaSocialSharing, $timeout, $stateParams, ENV) {
        var vm = this;
        vm.image = {};
        vm.event = {};

        var shareImags = [];
        var shareTitle = "打卡动态";
        var shareMessage = "#水滴打卡# ";
        var shareLink = ENV.homeUrl;

        var eventId = $stateParams.eventId;
        vm.resUrl = ENV.resUrl;
        // var source = document.getElementById('content');
        var source = angular.element('#content');

        Event.getInfo(eventId).then(function (data) {
            vm.event = data;
            shareLink = shareLink + '/event/' + vm.event.event_id;
            shareMessage = "#水滴打卡# " + vm.event.goal.goal_name + "第" + vm.event.checkin.total_days + "天:" + delHtmlTag(vm.event.checkin.checkin_content) + ',' + shareLink;
        });

        function delHtmlTag(str) {
            var title = str.replace(/<[^>]+>/g, "");//去掉所有的html标记
            if (title.length > 500) {
                title = title.substring(0, 50);
            }
            return title;
        }

        function screen() {
            $ionicScrollDelegate.scrollTo(0, 0, false);

            var w = source.outerWidth();
            var h = source.outerHeight();

            source.css('position', "absolute");
            source.css('top', '-44px');
            source.css('left', 0);
            source.css('right', 0);

            var canvasDom = document.createElement("canvas");
            canvasDom.width = w * 2;
            canvasDom.height = h * 2;
            canvasDom.style.width = w + "px";
            canvasDom.style.height = h + "px";
            var context = canvasDom.getContext("2d");
            // 然后将画布缩放，将图像放大两倍画到画布上
            context.scale(2, 2);

            console.log(source.outerHeight());
            var deferred = $q.defer();

            if (shareImags.length == 0) {
                Loading.showWaiting("正在生成分享图片，请稍候...");
                $timeout(function () {
                    html2canvas(source, {
                        logging: true,
                        canvas: canvasDom,
                        allowTaint: false,
                        type: 'view',
                        proxy: ENV.resUrl + 'images/html2canvasproxy.php',
                        height: source.outerHeight(),
                        // width:source.outerWidth()
                    }).then(function (canvas) {
                        Loading.hide();
                        var img = new Image();
                        img.src = canvas.toDataURL("image/png");
                        vm.image = canvas.toDataURL("image/png");
                        console.log(vm.image);
                        img.onload = function () {
                            img.onload = null;
                            img.style.width = w + "px";
                            img.style.height = h + "px";
                            document.getElementById('result').appendChild(img);
                            source.hide();
                            Loading.show("生成成功，现在可以分享啦！");
                            shareImags[0] = vm.image;
                            deferred.resolve(vm.image);
                        };
                        img.onerror = function (err) {
                            img.onerror = null;
                            Loading.show("生成失败，请重新进入该页面！");
                            deferred.reject(err);
                        };

                    }, function (error) {
                        deferred.reject(error);
                    });
                }, 2000);

            } else {
                deferred.resolve(shareImags[0]);
            }

            return deferred.promise;
        }

        vm.shareToQQ = function () {

            screen().then(function (image) {
                var args = {};
                args.url = shareLink;
                args.title = shareTitle;
                args.description = shareMessage;
                args.imageUrl = shareImags;
                YCQQ.shareToQQ(function () {
                    $log.debug("QQ分享成功");
                }, function (failReason) {
                    $log.error("QQ分享失败");
                    $log.error(failReason);
                }, args);
            }, function (err) {

            });


        };

        vm.shareToQZone = function () {

            screen().then(function (image) {
                var args = {};
                args.url = shareLink;
                args.title = shareTitle;
                args.description = shareMessage;
                args.imageUrl = shareImags;
                YCQQ.shareToQZone(function () {
                    $log.debug("QQ空间分享成功");
                }, function (failReason) {
                    $log.error("QQ空间分享失败");
                    $log.error(failReason);
                }, args);
            }, function (err) {

            });


        };

        vm.shareToWeibo = function () {
            var weibo = 'com.sina.weibo';

            screen().then(function (image) {
                window.weibo.share({
                    type: 'image',
                    data: vm.image,
                    text: shareMessage
                }, function (err) {
                    $log.error(err);
                });
            }, function (err) {

            });

        };

        vm.shareToMore = function () {
            screen().then(function (image) {
                $cordovaSocialSharing
                    .share(shareMessage, shareTitle, shareImags, shareLink) // Share via native share sheet
                    .then(function (result) {
                        Loading.show("分享成功");
                        $log.debug(result);
                    }, function (err) {
                        Loading.show("分享失败，请重试");
                        $log.error(err);
                    });
            }, function (err) {

            });

        };

        vm.shareToWechat = function (type) {
            screen().then(function (image) {
                Wechat.isInstalled(function (installed) {
                    // alert("Wechat installed: " + (installed ? "Yes" : "No"));
                    var scene = Wechat.Scene.TIMELINE;
                    if (type === 0) {
                        scene = Wechat.Scene.WXSceneSession;
                    }

                    Wechat.share({
                        message: {
                            title: shareTitle,
                            description: shareMessage,
                            thumb: vm.image,
                            mediaTagName: "checkin share",
                            messageExt: "",
                            messageAction: "<action>dotalist</action>",
                            media: {
                                type: Wechat.Type.IMAGE,
                                image: vm.image
                            }
                        },
                        scene: type   // share to Timeline
                    }, function (res) {
                        $ionicLoading.show({template: '分享成功', noBackdrop: true, duration: 2000});
                        $log.debug("微信分享成功");
                    }, function (reason) {
                        $log.error("微信分享失败");
                        $log.error(reason);
                    });
                }, function (reason) {
                    Loading.show("未安装微信客户端");
                });

            }, function (err) {

            });
        };
    }
})();

(function () {
    'use strict';

    Event.$inject = ["$http", "$q", "$localStorage", "$ionicLoading", "$ionicActionSheet", "$ionicHistory", "$log", "CacheFactory", "$state", "ENV", "Auth", "User", "Loading"];
    angular
        .module('kd.event')
        .factory('Event', Event);

    function Event($http, $q, $localStorage, $ionicLoading, $ionicActionSheet, $ionicHistory,$log, CacheFactory,$state, ENV, Auth, User, Loading) {

        var service = {
            getInfo: getInfo,
            getList: getList,
            getLikes: getLikes,
            doComment: doComment,
            doLike: doLike,
            showMore: showMore
        };

        return service;

        function getInfo(eventId) {
            var deferred = $q.defer();
            Loading.showWaiting("正在获取动态详情...");
            $http.get(ENV.apiUrl + 'event/info?event_id=' + eventId)
                .success(function (response) {
                    Loading.hide();
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                        Loading.show(response.message);
                        $ionicHistory.goBack();
                    }
                }).error(function (error) {
                Loading.hide();
                deferred.reject(error);
            });
            return deferred.promise;
        }

        // 获取动态列表
        function getList(offset, type, userId, cache) {
            var deferred = $q.defer();
            var params = {};
            params.offset = offset;
            if (type) {
                params.type = type;
            }
            if (userId) {
                params.user_id = userId;
            }

            cache = (typeof(cache) == 'undefined') ? true : cache;

            var name =  userId?'userEventsCache-'+userId:type+'EventsCache';

            var eventsCache = CacheFactory.get(name);

            if(!eventsCache) {
                eventsCache = CacheFactory.createCache(name, {
                    maxAge: 24 * 60 * 60 * 1000,
                    deleteOnExpire: 'aggressive'
                });
            }

            if (cache&&eventsCache.get(offset)) {
                $log.debug("从缓存 "+name+" 中读取");
                deferred.resolve(eventsCache.get(offset));
            } else {
                Loading.showWaiting("正在加载动态...");
                $http.get(ENV.apiUrl + 'event/all', {params: params})
                    .success(function (response) {
                        Loading.hide();
                        if (response.status) {
                            eventsCache.put(offset,response.data);
                            deferred.resolve(response.data);
                        } else {
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                    deferred.reject(error);
                });
            }



            return deferred.promise;
        }

        function getLikes(eventId) {
            var deferred = $q.defer();

            $http.get(ENV.apiUrl + 'event/likes?event_id=' + eventId)
                .success(function (response) {
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function (error) {
                deferred.reject(error);
            });
            return deferred.promise;
        }

        function doComment(eventId, comment) {
            var deferred = $q.defer();

            $http.post(ENV.apiUrl + 'event/comment', {
                event_id: eventId,
                content: comment.content,
                parent_id: comment.parent == null ? 0 : comment.parent.comment_id
            })
                .success(function (response) {
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function (error) {
                deferred.reject(error);
            });
            return deferred.promise;
        }

        function doLike(eventId) {
            var deferred = $q.defer();

            $http.post(ENV.apiUrl + 'event/like', {
                event_id: eventId,
            }).success(function (response) {
                if (response.status) {
                    deferred.resolve(response.data);
                } else {
                    deferred.reject(response.message);
                }
            }).error(function (error) {
                // $ionicLoading.show({
                //     template: error,
                //     noBackdrop: true,
                //     duration: 2000
                // });
                deferred.reject(error);
            });
            return deferred.promise;
        }


        function showMore(eventId) {
            $ionicActionSheet.show({
                buttons: [
                    {text: '分享'},
                    {text: '举报'}
                ],
                destructiveText: '',
                titleText: '更多设置',
                cancelText: '取消',
                cancel: function () {
                    return true;
                },
                buttonClicked: function (index) {
                    if (index === 0) {
                        $state.go('eventshare', {eventId: eventId});
                    }
                    if (index === 1) {
                        console.log(eventId);
                        User.doReport('event', eventId).then(function (response) {
                        }, function (error) {

                        });
                    }
                    return true;
                }
            });
        }

    }

})();

(function() {

    'use strict';

    ExploreController.$inject = ["$scope", "Event", "ENV"];
    angular
        .module('kd.explore')
        .controller('ExploreController', ExploreController);  

    function ExploreController($scope,Event,ENV) {

        var vm = this; 
        vm.events = [];
        vm.resUrl = ENV.resUrl;
        vm.currentIndex = 'hot';

        vm.onTabSelected = function(type) {
            vm.events = [];
            vm.currentIndex = type;
            getEvents(0);
        };

        vm.showMore =  function(eventId) {
            Event.showMore(eventId);
        };

        vm.doRefresh = function() {
            getEvents(0,false);
            $scope.$broadcast('scroll.refreshComplete');
            $scope.$apply();
        };

        vm.loadMore = function() {
            var num = vm.events.length;
            if (num > 0 && num % 20 === 0) {
                getEvents(num,false);
            }
            $scope.$broadcast('scroll.infiniteScrollComplete');
        };

        function getEvents(offset,cache) {
            Event.getList(offset,vm.currentIndex,null,cache).then(function(events){
                if(offset === 0) {
                    vm.events = events;
                } else {
                    vm.events = vm.events.concat(events);
                }
            },function(error){

            });
        }
    }
    
})();
(function () {

    'use strict';

    HomeController.$inject = ["$scope", "$state", "$rootScope", "Goal", "goals", "User", "Update"];
    angular
        .module('kd.home')
        .controller('HomeController', HomeController);

    function HomeController($scope, $state, $rootScope,Goal,goals,User, Update) {

        var vm = this;
        var now = Math.floor(moment().toDate().getTime() / 1000);

        vm.processed_goals = goals.processed_goals;
        vm.finished_goals = goals.finished_goals;
        vm.isReorder = false;
        vm.isFinishGroupShow = false;

        // 检查更新
        // Update.checkAndUpdate();

        vm.getGoals = getGoals;
        vm.doRefresh = doRefresh;
        vm.showReorder = showReorder;
        vm.checkinGoal = checkinGoal;
        vm.delGoal = delGoal;
        vm.reOrderGoal = reOrderGoal;
        vm.toggleGroup = toggleGroup;
        vm.checkStatus = checkStatus;

        // 监听事件
        $rootScope.$on('goal.update', function (evt, data) {
            getGoals();
        });
        // 监听事件
        $rootScope.$on('goal.add', function (evt, data) {
            getGoals();
        });

        // 监听事件
        $rootScope.$on('goal.delete', function (evt, data) {
            getGoals();
        });

        function getGoals(isRefresh) {

            User.getGoals(isRefresh).then(function (goals) {
                vm.processed_goals = goals.process;
                vm.finished_goals = goals.finish;
            }, function (error) {

            });
        }

        function doRefresh() {
            getGoals(true);
            $scope.$broadcast('scroll.refreshComplete');
            $scope.$apply();
        }

        function showReorder() {
            vm.isReorder = !vm.isReorder;

            if (!vm.isReorder) {
                Goal.reOrderGoals(vm.processed_goals);
            }
        }

        function checkinGoal(goal) {
            if (goal) {
                $state.go('checkinadd', {goalId: goal.goal_id});
            }
        }

        function delGoal(goal) {
            if (goal) {
                Goal.delGoal(goal.goal_id).then(function (response) {
                    var index;
                    if (goal.pivot.status == 0) {
                        index = vm.processed_goals.indexOf(goal);
                        vm.processed_goals.splice(index, 1);
                    } else {
                        index = vm.finished_goals.indexOf(goal);
                        vm.finished_goals.splice(index, 1);
                    }
                }, function (error) {
                });
            }
        }

        function reOrderGoal(goal, fromIndex, toIndex) {
            vm.processed_goals.splice(fromIndex, 1);
            vm.processed_goals.splice(toIndex, 0, goal);
        }

        function toggleGroup(group) {
            if (group == 'finish') {
                vm.isFinishGroupShow = !vm.isFinishGroupShow;
            }
        }

        function checkStatus(time) {

            if (time == 0) {
                return 'badge-assertive';
            }

            var diff_days = Math.ceil((now - time) / 86400);
            if (diff_days >= 3 && diff_days < 7) {
                return 'badge-energized';
            }
            if (diff_days >= 7) {
                return 'badge-assertive';
            }
            return 'badge-positive';
        }

    }

})();
(function () {

    'use strict';

    CheckinAddController.$inject = ["$rootScope", "$state", "$scope", "$ionicPopup", "$stateParams", "Goal", "goal", "Upload", "ENV"];
    angular
        .module('kd.goal')
        .controller('CheckinAddController', CheckinAddController);

    function CheckinAddController($rootScope, $state, $scope, $ionicPopup, $stateParams, Goal, goal, Upload, ENV) {
        var vm = this;
        var goalId = $stateParams.goalId;

        vm.goal = goal;

        vm.checkin = {
            'type': false,
            'model': 'text',
            'goal_id': goalId,
            'attaches': [],
        };

        var options = {
            maximumImagesCount: 1,
            width: 800,
            height: 800,
            quality: 80
        };

        vm.doUpload = function () {
            Upload.imageUpload().then(function (data) {
                console.log("上传成功");
                console.log(data);
                vm.checkin.attaches = [];
                vm.checkin.attaches.push(data);
                // var image = document.getElementById('upload-image');
                // image.src = data.url;
            }, function (error) {
                console.log("上传失败");
                console.log(error);
            });
        };

        vm.removeAttach = function () {
            vm.checkin.attaches = [];
        };

        vm.day1 = moment().add(-1, 'days').format("YYYY-MM-DD");
        vm.day2 = moment().add(-2, 'days').format("YYYY-MM-DD");
        vm.day3 = moment().add(-3, 'days').format("YYYY-MM-DD");
        // vm.checkin.day = vm.day1;

        // $ionicModal.fromTemplateUrl('templates/checkin_succ_modal.html', {
        //     scope: vm,
        //     animation: 'slide-in-up'
        // }).then(function(modal) {
        //     vm.modal = modal;
        // });

        // vm.cancelShare = function() {
        //     vm.modal.hide();
        //     $state.go('goalview',{
        //         "goalId":goalId
        //     });
        // };

        vm.delItem = function(item) {
            if(vm.goal.items.length>0) {
                var index = vm.goal.items.indexOf(item);
                console.log(index);
                if(index) {
                    vm.goal.items.splice(index,1);
                }
            }
        };

        vm.doCheckin = function () {

            vm.checkin.items = vm.goal.items;
            vm.checkin.obj_id = goalId;
            vm.checkin.obj_type = 'GOAL';

            if (vm.checkin.type && !vm.checkin.day) {
                vm.checkin.day = vm.day1;
            }

            Goal.doCheckin(vm.checkin).then(function (response) {
                // $state.go('goalview', {goalId: goalId});
                var succPopup = $ionicPopup.show({
                    template: '<div class="text-center"><i class="icon ion-ios-checkmark-outline balanced" style="font-size: 100px;"></i><p>正能量 <span class="assertive">+'+response.energy+'</span></p></div>',
                    title: '打卡成功',
                    subTitle: '',
                    scope: $scope,
                    buttons: [
                        {
                            text: '返回',
                            onTap: function (e) {
                                $state.go('goalview', {goalId: goalId});
                            }
                        },
                        {
                            text: '<b>分享</b>',
                            type: 'button-positive',
                            onTap: function (e) {
                                $state.go('eventshare', {eventId: response.event_id});
                            }
                        },
                    ]
                });

                succPopup.then(function (res) {
                });

                $rootScope.$broadcast('goal.update');
            }, function (error) {

                var failPopup = $ionicPopup.show({
                    template: '<div class="text-center"><i class="icon ion-ios-close-outline assertive" style="font-size: 100px;"></i><p>' + error + '</p></div>',
                    title: '打卡失败',
                    subTitle: '',
                    scope: $scope,
                    buttons: [
                        {
                            text: '确定',
                            onTap: function (e) {
                            }
                        }
                    ]
                });

                failPopup.then(function (res) {

                });
            });
        };

        // 返回
        vm.goBack = function () {
            $state.go('goal', {
                goalId: groupId
            });
        };
    }
})(); 

(function() {
    'use strict';

        Checkin.$inject = ["$http", "$q", "$ionicLoading", "$log", "$state", "ENV", "Loading"];
    angular
        .module('kd.goal')
        .factory('Checkin', Checkin);

       	function Checkin($http, $q,$ionicLoading,$log, $state,ENV,Loading) {
	    return {
	        doCheckin: function(checkin) {
	            var deferred = $q.defer();
	            $http.post(ENV.apiUrl + 'checkin/create', checkin)
	                .success(function(response) {
	                	console.log(response);
	                    if (data.status) {
	                        deferred.resolve(response.data);
	                    } else {
							Loading.show(response.message);
	                        deferred.reject(response.message);
	                    }
	                }).error(function(error) {
	                    deferred.reject(error);
	                });
	            return deferred.promise;
	        },
	        getInfo:function(checkinId) {
	            var deferred = $q.defer();

	            $http.get(ENV.apiUrl + 'checkin/info?checkin_id='+checkinId)
	                .success(function(data) {
	                    if (data.code ===  0) {
	                        deferred.resolve(data.data);
	                    } else {
	                        deferred.reject(data);
	                    }
	                }).error(function(data) {
	                    deferred.reject(data);
	                });
	            return deferred.promise;
	        },
	        getComments:function(checkinId) {
	            var deferred = $q.defer();

	            $http.get(ENV.apiUrl + 'checkin/comments?checkin_id='+checkinId)
	                .success(function(data) {
	                    if (data.code ===  0) {
	                        deferred.resolve(data.data);
	                    } else {
	                        deferred.reject(data);
	                    }
	                }).error(function(data) {
	                    deferred.reject(data);
	                });
	            return deferred.promise;
	        },
	        doComment: function(checkinId, content) {
	            var deferred = $q.defer();

	            $http.post(ENV.apiUrl + 'checkin/comment', {
	                    checkin_id: checkinId,
	                    content: content
	                })
	                .success(function(data) {
	                    if (data.code ===  0) {
	                        deferred.resolve(data.data);
	                    } else {
	                        deferred.reject(data);
	                    }
	                }).error(function(error) {
	                    deferred.reject(error);
	                });
	            return deferred.promise;
	        },
	        doLike: function(checkinId) {
	            var deferred = $q.defer();

	            $http.post(ENV.apiUrl + 'checkin/like', {
	                    checkin_id: checkinId,
	                })
	                .success(function(data) {
	                    if (data.code ===  0) {
	                        deferred.resolve(data.data);
	                    } else {
	                        deferred.reject(data);
	                    }
	                }).error(function(data) {
	                    $ionicLoading.show({
	                        template: data.msg,
	                        noBackdrop: true,
	                        duration: 2000
	                    });
	                    deferred.reject(data);
	                });
	            return deferred.promise;
	        },
	        showMore:function(checkinId){
	        	$ionicActionSheet.show({
		            buttons: [
		                { text: '分享' }
		            ],
		            destructiveText: '',
		            titleText: '更多设置',
		            cancelText: '取消',
		            cancel: function() {
		                return true;
		            },
		            buttonClicked: function(index) {
		                if(index === 0) {
		                	$state.go('checkinshare',{checkinId:checkinId});
		                }
		                return true;
		            }
        		});
	        }
	    };

        }

})();

(function() {

    'use strict';

    GoalAddController.$inject = ["$rootScope", "$state", "Goal"];
    angular
        .module('kd.goal')
        .controller('GoalAddController', GoalAddController);  

    function GoalAddController($rootScope,$state,Goal) {
        var vm = this;

        vm.goal = {};

        vm.doSaveGoal =  function() {

            vm.goal.days = vm.goal.days || 0;

            Goal.createGoal(vm.goal).then(function(goal){
                $state.go('goalview', {
                    goalId: goal.goal_id
                });
                $rootScope.$broadcast('goal.add');
            },function(error){

            });
        };

        vm.getRange = function(){
            var today = moment().format("YYYY-MM-DD");
            var end_day = moment().add(vm.goal.days-1, 'days').format("YYYY-MM-DD");
            return '从 '+today+' 到 '+end_day;
        };

    }
    
})(); 
/**
 * Created by Jason.z on 16/10/17.
 */
(function() {

    'use strict';

    GoalCalendarController.$inject = ["$http", "$scope", "$stateParams", "$localStorage", "$ionicLoading", "$timeout", "$state", "$log", "Goal", "ENV"];
    angular
        .module('kd.goal')
        .controller('GoalCalendarController', GoalCalendarController);

    function GoalCalendarController($http,$scope,$stateParams,$localStorage,$ionicLoading,$timeout,$state,$log,Goal,ENV) {
        var vm = this;

        vm.goalId = $stateParams.goalId;

        vm.events = [];

        vm.checkin = {};

        getEvents(moment().year(),moment().month()+1);

        vm.options =  {
            defaultDate: moment().format("YYYY-MM-DD"),
            minDate: "2015-01-01",
            maxDate: moment().format("YYYY-MM-DD"),
            disabledDates: [

            ],
            dayNamesLength: 1, // 1 for "M", 2 for "Mo", 3 for "Mon"; 9 will show full day names. Default is 1.
            mondayIsFirstDay: true,//set monday as first day of week. Default is false
            eventClick: function(date) { // called before dateClick and only if clicked day has events
                console.log(date);
            },
            dateClick: function(date) { // called every time a day is clicked
                console.log(date);
                if(date.event.length>0){
                    vm.checkin = date.event[0];
                }
            },
            changeMonth: function(month, year) {
                console.log(month);
                getEvents(year,month.index+1);
            },
            filteredEventsChange: function(filteredEvents) {
                console.log(filteredEvents);
            },
        };

        function getEvents(year,month) {
            $http.get(ENV.apiUrl+'goal/checkins?goal_id='+vm.goalId+'&month='+month+'&year='+year).success(function(response) {
                $log.debug(response);
                if(response.status) {
                    vm.events = response.data;

                    if(vm.events.length>0) {
                        var last_event = vm.events[vm.events.length-1];
                        if(last_event.checkin_day == moment().format("YYYY-MM-DD")) {
                            vm.checkin = last_event;
                        }
                    }

                }
            }).error(function(error) {
                $log.error(error);
            });
        }

        // $scope.events = [
        //     {foo: 'bar', date: "2016-08-18"}, //value of eventClass will be added to CSS class of the day element
        //     {foo: 'bar', date: "2016-08-20"}
        // ];

    }

})();
/**
 * Created by Jason.z on 16/10/17.
 */

(function() {

    'use strict';

    GoalDataController.$inject = ["$http", "$scope", "$stateParams", "ENV"];
    angular
        .module('kd.goal')
        .controller('GoalDataController', GoalDataController);

    function GoalDataController($http,$scope,$stateParams,ENV) {
        var vm = this;

        var goalId = $stateParams.goalId;

        $scope.goalId = goalId;
        vm.resUrl = ENV.resUrl;
        $scope.chart = null;

        vm.summary = {
            'count':0,
            'items':[]
        };

        function initChart(index) {
            var typeArr = ['week', 'month', 'year'];

            $http.get(ENV.apiUrl + 'goal/' + typeArr[index] + '?goal_id=' + goalId).success(function(response) {
                var y = response.data.y;
                y.splice(0, 0, "data1");
                var x = response.data.x;
                // y.splice(0, 0, "x");
                // console.log(x);
                console.log(y);

                var summary = response.data.summary;

                if(summary.length>0){
                    vm.summary = summary[5];
                }

                $scope.chart = c3.generate({
                    bindto: '#c3chart',
                    data: {
                        columns: [
                            y
                        ],
                        type: 'bar',
                        colors: {
                            'data1': '#0c9'
                        },
                        names: {
                            'data1': '打卡天数'
                        },
                        onclick: function (d, element) {
                            if(summary.length>0) {
                                vm.summary = summary[d.index];
                                $scope.$apply();
                            }
                        }
                    },
                    axis: {
                        x: {
                            type: 'category',
                            categories: x
                        }
                    }
                });
                if(!$scope.$$phase) {
                    $scope.$apply();
                }
            });
        }


        vm.showChart = function(index) {
            vm.summary = {
                'count':0,
                'items':[]
            };
            initChart(index);
        };

    }

})();
(function() {

    'use strict';

    GoalEditController.$inject = ["$scope", "$http", "$state", "$stateParams", "$localStorage", "$log", "$ionicLoading", "$ionicModal", "ENV", "OAuth", "Goal", "Item", "Modal"];
    angular
        .module('kd.goal')
        .controller('GoalEditController', GoalEditController);  

    function GoalEditController($scope,$http,$state,$stateParams,$localStorage,$log, $ionicLoading,$ionicModal,ENV,OAuth,Goal,Item,Modal) {
        var vm = this;
        vm.goal = {};
        vm.items = [];

        vm.goalId = $stateParams.goalId;
        var userId = $localStorage.user.user_id;

        getGoal();

        function getGoal() {
            $log.debug("开始获取目标信息...");
            $http.get(ENV.apiUrl+'user/goal?user_id='+userId+'&goal_id='+vm.goalId).success(function(data) {
                $log.debug("获取成功");
                $log.debug(data);

                if(data.code == 0) {
                    vm.goal = data.data;
                } else {
                    $ionicLoading.show({
                        template: data.message,
                        noBackdrop: true,
                        duration: 2000
                    });
                    $state.go('app.home');
                }
               
            }).error(function(error) {
                $log.error(error);
            });
        }

        vm.doSaveGoal = doSaveGoal;

        function doSaveGoal() {
            Goal.editGoal(vm.goal).then(function(data) {
                $ionicLoading.show({
                    template: '更新成功',
                    noBackdrop: true,
                    duration: 2000
                });
                $state.go('goalview', {
                    goalId: data.goal_id
                });
            }, function(error) {
                $ionicLoading.show({
                    template: error,
                    noBackdrop: true,
                    duration: 2000
                });
            });
        }

        vm.itemAdd = itemAdd;

        $ionicModal.fromTemplateUrl('templates/item_add_modal.html', {
             scope: $scope,
             animation: 'slide-in-up'
         }).then(function(modal) {
             vm.modal = modal;
         });

        function itemAdd(item) {
            Modal.show('templates/item_add_modal.html','ItemAddController as itemadd',item)
                .then(function(result) {
                    console.log(result);
                    if(result&&result.item_name) {
                        if(item){
                            var index = vm.goal.items.indexOf(item);
                            vm.goal.items[index] = result;
                        } else {
                            vm.goal.items.push(result);
                        }
                        console.log(vm.goal);
                    }
                }, function(err) {
                    console.log(err);
                });
        }

        vm.doDelItem = doDelItem;

        function doDelItem(item) {
            var index = vm.goal.items.indexOf(item);
            if(index >= 0) {
                vm.goal.items.splice(index, 1);
            }
        }

        vm.doEditItem = doEditItem;

        function doEditItem(item) {
            itemAdd(item);
        }

    }
    
})(); 
/**
 * Created by Jason.z on 2016/10/28.
 */

(function() {

    'use strict';

    GoalHomeController.$inject = ["$http", "$scope", "$stateParams", "$ionicPopup", "Loading", "$state", "$log", "ENV"];
    angular
        .module('kd.goal')
        .controller('GoalHomeController', GoalHomeController);

    function GoalHomeController($http,$scope,$stateParams,$ionicPopup,Loading,$state,$log,ENV) {
        var vm = this;
        vm.goal = {};
        vm.data = {};
        vm.index = 0;

        var goalId = $stateParams.goalId;

        $http.get(ENV.apiUrl+'goal/info?goal_id='+goalId).success(function(response) {
            if(response.status) {
                vm.goal = response.data;
            }
        }).error(function(error) {
        });

        $http.get(ENV.apiUrl+'goal/events?goal_id='+goalId).success(function(response) {
            if(response.status) {
                vm.events = response.data;
            }
        }).error(function(error) {
        });

        $http.get(ENV.apiUrl+'goal/top?goal_id='+goalId).success(function(response) {
            if(response.status) {
                vm.users = response.data;
            }
        }).error(function(error) {
        });

        vm.changeIndex = function($index) {
            console.log($index);
            vm.index = $index;
            $scope.$apply();
        };

        vm.followGoal = function() {

            var myPopup = $ionicPopup.show({
                template: '<input type="text" ng-model="goalhome.data.days" value="0">',
                title: '目标天数',
                subTitle: '从你制定目标的当天开始算起,0代表每天',
                scope: $scope,
                buttons: [
                    { text: '取消' },
                    {
                        text: '<b>确定</b>',
                        type: 'button-positive',
                        onTap: function(e) {
                            if (!vm.data.days) {
                                //不允许用户关闭，除非他键入wifi密码
                                e.preventDefault();
                                $ionicLoading.show({
                                    template: '请输入天数',
                                    noBackdrop: true,
                                    duration: 2000
                                });
                            } else {
                                return vm.data.days;
                            }
                        }
                    },
                ]
            });

            myPopup.then(function(res) {
               if(res){
                   $http.post(ENV.apiUrl+'goal/follow',{goal_id:goalId,days:res}).success(function(response) {
                       if(response.status) {
                           vm.goal.is_follow = true;
                           $ionicLoading.show({
                               template: '恭喜你,制定成功,<br>开启你的打卡旅程吧...',
                               noBackdrop: true,
                               duration: 2000
                           });
                           $state.go('goalview',{goalId:goalId});
                       }
                   }).error(function(error) {
                       $log.error(error);
                       $ionicLoading.show({
                           template: '请求接口错误,请检查网络或重试',
                           noBackdrop: true,
                           duration: 2000
                       });
                   });
               }
            });


        };
    }

})();

/**
 * Created by Jason.z on 2016/10/28.
 */
(function() {

    'use strict';

    GoalSearchController.$inject = ["Goal"];
    angular
        .module('kd.goal')
        .controller('GoalSearchController', GoalSearchController);

    function GoalSearchController(Goal) {
        var vm = this;
        vm.search = {
            text:''
        };
        vm.goals = [];

        getGoals();

        function getGoals(text) {
            Goal.getAllGoals(text).then(function(goals){
                vm.goals = goals;
            },function(error){

            });
        }

        vm.doSearch = function(){
            getGoals(vm.search.text);
        };

        vm.clearSearch = function(){
            getGoals();
            vm.search.text = '';
        };
    }

})();
(function () {

    'use strict';

    GoalSettingController.$inject = ["$scope", "$stateParams", "$rootScope", "$state", "Goal", "goal", "Modal", "$log", "$ionicModal"];
    angular
        .module('kd.goal')
        .controller('GoalSettingController', GoalSettingController);

    function GoalSettingController($scope, $stateParams, $rootScope, $state, Goal, goal, Modal, $log, $ionicModal) {
        var vm = this;
        vm.goalId = $stateParams.goalId;

        vm.goal = goal;

        vm.setting = {
            goal_id: vm.goalId,
            is_push: Boolean(goal.pivot.is_push),
            is_public: Boolean(goal.pivot.is_public),
            remind_time: goal.pivot.remind_time,
            items: goal.items
        };

        vm.timePickerObject = {
            inputEpochTime: 0,
            step: 1,  //Optional
            format: 24,  //Optional
            titleLabel: '提醒设置',  //Optional
            setLabel: '设置',  //Optional
            closeLabel: '取消',  //Optional
            setButtonType: 'button-positive',  //Optional
            closeButtonType: 'button-stable',  //Optional
            callback: function (val) {
                if (typeof (val) !== 'undefined') {
                    var selectedTime = new Date(val * 1000);
                    var time = selectedTime.getUTCHours() + ':' + selectedTime.getUTCMinutes();
                    vm.setting.remind_time = time;
                    // vm.timePickerObject.inputEpochTime = getEpochTime(time);
                }
            }
        };

        vm.doSaveSetting = doSaveSetting;
        vm.delGoal = delGoal;

        // 保存设置
       function doSaveSetting() {
            Goal.editGoal(vm.setting).then(function (response) {
                $state.go('goalview', {goalId: vm.goalId});
            }, function (error) {
            });
        }

        // 删除目标
        function delGoal () {
            Goal.delGoal(vm.goalId).then(function (response) {
                $state.go('app.home');
                $rootScope.$broadcast('goal.delete');
            }, function (error) {
            });
        }

        $ionicModal.fromTemplateUrl('templates/item_add_modal.html', {
            scope: $scope,
            animation: 'slide-in-up'
        }).then(function (modal) {
            vm.modal = modal;
        });

        vm.itemAdd = function (item) {
            Modal.show('templates/item_add_modal.html', 'ItemAddController as itemadd', item)
                .then(function (result) {
                    console.log(result);
                    if (result && result.item_name) {
                        if (item) {
                            var index = vm.goal.items.indexOf(item);
                            vm.setting.items[index] = result;
                        } else {
                            vm.setting.items.push(result);
                        }
                    }
                }, function (err) {
                    $log.error(err);
                });
        };

        vm.doDelItem = function (item) {
            var index = vm.setting.items.indexOf(item);
            if (index >= 0) {
                vm.setting.items.splice(index, 1);
            }
        };

        vm.doEditItem = function (item) {
            itemAdd(item);
        };



        // function getEpochTime(time) {
        //     if (time) {
        //         var hour = time.substring(0, 2);
        //         var minute = time.substring(time.indexOf(":") + 1, time.indexOf(":") + 3);
        //         console.log((hour * 60 + minute * 1) * 60);
        //         return (hour * 60 + minute * 1) * 60;
        //     }
        //     return 0;
        // }
    }

})();
(function () {

    'use strict';

    GoalViewController.$inject = ["$scope", "$rootScope", "$state", "$http", "$stateParams", "$ionicLoading", "$ionicPopover", "$filter", "$log", "ENV", "Goal", "User", "goal"];
    angular
        .module('kd.goal')
        .controller('GoalViewController', GoalViewController);

    function GoalViewController($scope, $rootScope, $state, $http, $stateParams, $ionicLoading, $ionicPopover, $filter, $log, ENV, Goal,User,goal) {

        var vm = this;
        var goalId = $stateParams.goalId;

        vm.goal = goal;
        vm.users = [];
        vm.checkin = {};
        vm.resUrl = ENV.resUrl;
        vm.selectedDay = $filter('date')(new Date(), 'yyyy-MM-dd');
        vm.today = (new Date()).toDateString();
        vm.events = [];

        vm.getGoal = getGoal;
        vm.setDate = setDate;
        vm.openPopover = openPopover;
        vm.closePopover = closePopover;
        vm.goCheckin = goCheckin;
        vm.goSetting = goSetting;
        vm.goHome = goHome;

        getEvents(moment().year(), moment().month() + 1);
        getEvents(moment().year(), moment().month());

        initPopover();

        // 监听事件
        $rootScope.$on('goal.update', function (evt, data) {
            getGoal();
        });

        //Cleanup the popover when we're done with it!
        $scope.$on('$destroy', function () {
            vm.popover.remove();
        });

        // Execute action on hide popover
        $scope.$on('popover.hidden', function () {
            // Execute action
        });

        // Execute action on remove popover
        $scope.$on('popover.removed', function () {
            // Execute action
        });

        function getGoal() {
            User.getGoal(goalId, false).then(function (goal) {
                vm.goal = goal;
            }, function (error) {

            });
            $scope.$broadcast('scroll.refreshComplete');
            $scope.$apply();
        }

        function getEvents(year, month) {
            $http.get(ENV.apiUrl + 'goal/checkins?goal_id=' + goalId + '&month=' + month + '&year=' + year).success(function (response) {
                $log.debug(response);
                if (response.status) {
                    if (response.data.length > 0) {
                        if (vm.events.length > 0) {
                            vm.events.concat(response.data);
                        } else {
                            vm.events = response.data;
                        }
                    }
                    $log.debug(vm.events);
                }
            }).error(function (error) {
                $log.error(error);
            });
        }

        function setDate(day) {
            vm.today = day.fullDay;
            vm.selectedDay = $filter('date')(new Date(day.fullDay), 'yyyy-MM-dd');
            if (day.event.length > 0) {
                vm.checkin = day.event[0];
            } else {
                vm.checkin = {};
            }
            // getCheckin(day);
        }


        function getCheckin($day) {
            $day = $filter('date')(new Date($day), 'yyyy-MM-dd');
            $log.debug("开始获取目标信息...");
            // This request will hit the index method in the AuthenticateController
            // on the Laravel side and will return the list of users
            $http.get(ENV.apiUrl + 'goal/checkin?&goal_id=' + goalId + '&day=' + $day).success(function (data) {
                $log.debug("获取成功");
                $log.debug(data);

                if (data.code == 0) {
                    vm.checkin = data.data;
                } else {
                    $ionicLoading.show({
                        template: data.message,
                        noBackdrop: true,
                        duration: 2000
                    });
                }

            }).error(function (error) {
                $log.debug("获取失败");
                $log.debug(error);
            });

        }

        function goCheckin() {
            if (vm.goal.pivot.status == 1) {
                $ionicLoading.show({
                    template: '目标已过期，无法进行打卡',
                    noBackdrop: true,
                    duration: 2000
                });
                return;
            }

            $state.go('checkinadd', {goalId: goalId});
        }

        function initPopover() {
            $ionicPopover.fromTemplateUrl('templates/goal_view_menu.html', {
                scope: $scope
            }).then(function (popover) {
                vm.popover = popover;
            });
        }

        function openPopover($event) {
            vm.popover.show($event);
        }



        function closePopover() {
            vm.popover.hide();
        }


        function goSetting () {
            closePopover();
            $state.go('goalsetting', {goalId: goalId});
        }

        function goHome () {
            closePopover();
            $state.go('goalhome', {goalId: goalId});
        }
    }
})();
(function () {
    'use strict';

    Goal.$inject = ["$http", "$q", "$localStorage", "$ionicPopup", "Loading", "$log", "ENV"];
    angular
        .module('kd.goal')
        .factory('Goal', Goal);

    function Goal($http, $q, $localStorage, $ionicPopup,Loading, $log, ENV) {
        var userId = $localStorage.user.user_id;
        var goals = [];
        var topGoals = [];

        var service = {
            doCheckin: doCheckin,
            createGoal: createGoal,
            editGoal: editGoal,
            getGoal: getGoal,
            getGoals: getGoals,
            reOrderGoals: reOrderGoals,
            getAllGoals: getAllGoals,
            delGoal: delGoal,
            getItems: getItems,
            insertItem: insertItem
        };

        return service;

        function doCheckin(checkin) {
            var deferred = $q.defer();
            Loading.showWaiting("正在提交打卡记录，请稍候...");
            $http.post(ENV.apiUrl + 'checkin/create', checkin)
                .success(function (response) {
                    Loading.hide();
                    if (response.status) {
                        // 修改目标打卡状态
                        if (goals.length > 0 && goals[checkin.goal_id]) {
                            goals[checkin.goal_id].pivot.is_today_checkin = true;
                        }
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function (error) {
                $log.error(error);
                deferred.reject(error);
            });
            return deferred.promise;
        }

        function getGoals(isRefresh){
            isRefresh = (typeof(isRefresh)=='undefined')?false:isRefresh;
            var deferred = $q.defer();
            if (!isRefresh && goals.length > 0) {
                $log.debug("从队列中获取...");
                var process = [];
                var finish = [];

                for(var key in goals) {
                    if(goals[key]) {
                        if(goals[key].pivot.status==0) {
                            if(goals[key].pivot.order != 999) {
                                process.splice(goals[key].pivot.order,0,goals[key]);
                            } else {
                                process.push(goals[key]);
                            }
                        }
                        if(goals[key].pivot.status==1) {
                            finish.push(goals[key]);
                        }
                    }
                }

                var new_goals = {
                    process:process,
                    finish:finish
                };

                deferred.resolve(new_goals);
            } else {
                $log.debug("队列为空，从服务器拉取...");
                Loading.showWaiting("正在获取目标列表...");
                $http.get(ENV.apiUrl + 'user/goals')
                    .success(function (response) {
                        if (response.status) {
                            Loading.hide();
                            angular.forEach(response.data.finish,function(data,index,array){
                                goals[data.goal_id] = data;
                            });
                            angular.forEach(response.data.process,function(data,index,array){
                                goals[data.goal_id] = data;
                            });
                            deferred.resolve(response.data);
                        } else {
                            Loading.show(response.message);
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                        deferred.reject(error);
                });
            }
            return deferred.promise;
        }

        function reOrderGoals(new_goals) {
            var deferred = $q.defer();

            var order = [];
            // 修改本地的目标顺序
            angular.forEach(new_goals,function(data,index,array){
                goals[data.goal_id].pivot.order = index;
                var obj = {};
                obj.goal_id = data.goal_id;
                obj.index = index;
                order.push(obj);
            });

            // 同步到服务器
            Loading.showWaiting("正在同步排序到服务器,请稍候...");
            $http.post(ENV.apiUrl + 'goal/reorder',{order:order})
                .success(function (response) {
                    if (response.status) {
                        Loading.show("同步成功");
                        deferred.resolve(response.message);
                    } else {
                        Loading.show(response.message);
                        deferred.reject(response.message);
                    }
                }).error(function (error) {
                    deferred.reject(error);
            });

            return deferred.promise;

        }

        function getAllGoals(searchText){
            searchText = searchText || '';
            var deferred = $q.defer();
            $log.debug("检查队列...");
            if (searchText.length==0 && topGoals.length > 0) {
                $log.debug("存在于队列中");
                deferred.resolve(topGoals);
            } else {
                $log.debug("不存在队列中，从服务器拉取...");
                Loading.showWaiting("正在获取目标列表");
                $http.get(ENV.apiUrl + 'goal/all?q='+searchText)
                    .success(function (response) {
                        if (response.status) {
                            Loading.hide();
                            if(!searchText) {
                                topGoals = response.data;
                            }
                            deferred.resolve(response.data);
                        } else {
                            Loading.show(response.message);
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                        deferred.reject(error);
                });
            }
            return deferred.promise;
        }

        function createGoal(goal) {
            var deferred = $q.defer();
            Loading.showWaiting("目标创建中，请稍候...");
            $http.post(ENV.apiUrl + 'goal/create', goal)
                .success(function (response) {
                    if (response.status) {
                        Loading.show("创建成功");
                        var goal = response.data;
                        goals[goal.goal_id] = goal;
                        deferred.resolve(goal);
                        $log.error(goals);
                    } else {
                        Loading.show(response.message);
                        deferred.reject(response.message);
                    }
                }).error(function (error) {
                    deferred.reject(error);
            });
            return deferred.promise;
        }

        function editGoal(goal) {
            var deferred = $q.defer();
            Loading.showWaiting("正在保存设置...");
            $http.post(ENV.apiUrl + 'goal/setting', goal)
                .success(function (response) {
                    if (response.status) {
                        if(goals.length>0&&goals[goal.goal_id]) {
                            goals[goal.goal_id].pivot.is_public = goal.is_public;
                            goals[goal.goal_id].pivot.is_push = goal.is_push;
                            goals[goal.goal_id].pivot.remind_time = goal.remind_time;
                        }
                        Loading.show("修改成功");
                        deferred.resolve(response.data);
                    } else {
                        Loading.show(response.message);
                        deferred.reject(response.message);
                    }
                }).error(function (error) {
                    $log.error(error);
                    deferred.reject(error);
            });
            return deferred.promise;
        }

        function getGoal(goalId,isRefresh) {
            isRefresh = (typeof(isRefresh)=='undefined')?false:isRefresh;
            var deferred = $q.defer();
            if (!isRefresh && goals.length > 0 && goals[goalId]) {
                $log.debug("存在于队列中");
                deferred.resolve(goals[goalId]);
            } else {
                $log.debug("不存在队列中，从服务器拉取...");
                Loading.showWaiting("正在获取目标详情");
                $http.get(ENV.apiUrl + 'user/goal?user_id=' + userId + '&goal_id=' + goalId)
                    .success(function (response) {
                        if (response.status) {
                            Loading.hide();
                            goals[goalId] = response.data;
                            deferred.resolve(response.data);
                        } else {
                            Loading.show(response.message);
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                        deferred.reject(error);
                });
            }
            return deferred.promise;
        }

        function delGoal(goalId) {
            var deferred = $q.defer();

            var confirmPopup = $ionicPopup.confirm({
                title: '警告',
                template: '删除目标将会清空你在该目标下的所有记录，是否删除？',
                cancelText: '取消',
                okText: '删除',
                okType:'button-assertive'
            });

            confirmPopup.then(function (res) {
                if (res) {
                    Loading.showWaiting("删除中，请稍候...");
                    $http.post(ENV.apiUrl + 'goal/delete', {goal_id: goalId})
                        .success(function (response) {
                            if (response.status) {
                                Loading.show("删除成功");
                                if (goals.length > 0 && goals[goalId]) {
                                    goals.splice(goalId, 1);
                                }
                                deferred.resolve(response.data);
                            } else {
                                Loading.show(response.message);
                                deferred.reject(response.message);
                            }
                        }).error(function (error) {
                        deferred.reject(error);
                    });
                } else {
                    deferred.reject("取消删除");
                }
            });
            return deferred.promise;
        }

        function getItems(goalId) {
            var deferred = $q.defer();
            $log.debug("获取项目信息,先从队列中检查...");
            if (goals.length > 0 && goals[goalId]) {
                $log.debug("存在于队列中");
                deferred.resolve(goals[goalId].items);
            } else {
                $log.debug("不存在队列中，从服务器拉取...");
                Loading.showWaiting("正在获取打卡项目...");
                $http.get(ENV.apiUrl + 'goal/items?goal_id=' + goalId)
                    .success(function (response) {
                        $log.debug("获取成功");
                        $log.debug(response);
                        if (response.status) {
                            Loading.hide();
                            deferred.resolve(response.data);
                        } else {
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                    $log.error(error);
                    deferred.reject(error);
                });
            }

            return deferred.promise;
        }

        function insertItem(item) {
            var deferred = $q.defer();

            $http.post(ENV.apiUrl + 'goal/item', item)
                .success(function (data) {
                    if (data.code === 0) {
                        deferred.resolve(data.data);
                    } else {
                        deferred.reject(data);
                    }
                }).error(function (data) {
                deferred.reject(data);
            });
            return deferred.promise;
        }

    }

})();

/**
 * Created by Jason.z on 16/7/20.
 */


(function() {

    'use strict';

    ItemAddController.$inject = ["$scope", "parameters"];
    angular
        .module('kd.goal')
        .controller('ItemAddController', ItemAddController);

    function ItemAddController($scope,parameters) {
        var vm = this;

        vm.item = parameters || {};

        vm.doSaveItem = function(){
            $scope.closeModal(vm.item);
        };

        vm.closeModal = function(){
            $scope.closeModal(null);
        };


    }

})();
(function() {
    'use strict';

   	Item.$inject = ["$rootScope", "$ionicModal"];
    angular
        .module('kd.goal')
        .factory('Item', Item);

    function Item($rootScope,$ionicModal) {
    	var vm = this;

        var service = {
        	showModal:showModal,
        	hideModal:hideModal,
        };

        function showModal() {
        	$ionicModal.fromTemplateUrl('templates/item_add_modal.html', {
	            scope: $rootScope.$new(),
	            animation: 'slide-in-up'
	        }).then(function(modal) {
	            vm.modal = modal;
	        });
        }

        function hideModal() {
         	vm.modal.hiden();
        }

        return service;
   	}

})();
/**
 * Created by Jason.z on 2016/11/29.
 */

(function() {

    'use strict';

    GoodViewController.$inject = ["$http", "$sce", "$stateParams", "ENV"];
    angular
        .module('kd.mall')
        .controller('GoodViewController', GoodViewController);

    function GoodViewController($http,$sce,$stateParams,ENV) {

        var vm = this;
        vm.good = {};
        var goodId = $stateParams.goodId;

        $http.get(ENV.apiUrl + 'good/info?good_id='+goodId).success(function(response) {
            if (response.status) {
                vm.good = response.data;
                vm.good.content = $sce.trustAsHtml(response.data.content);
            } else {
            }
        }).error(function(error) {
        });
    }

})();
/**
 * Created by Jason.z on 2016/11/29.
 */

(function() {

    'use strict';

    MallController.$inject = ["$http", "ENV"];
    angular
        .module('kd.mall')
            .controller('MallController', MallController);

    function MallController($http,ENV) {

        var vm = this;
        vm.goods = [];

        $http.get(ENV.apiUrl + 'good/hot').success(function(response) {
            if (response.status) {
                vm.goods = response.data;
            } else {
            }
        }).error(function(error) {
        });
    }

})();
/**
 * Created by Jason.z on 16/7/29.
 */

(function () {

    'use strict';

    MessageCommentController.$inject = ["$http", "ENV"];
    angular
        .module('kd.message')
        .controller('MessageCommentController', MessageCommentController);

    function MessageCommentController($http, ENV) {

        var vm = this;
        vm.messages = [];

        getMessages();

        function getMessages() {

            $http.get(ENV.apiUrl + 'message/comment').success(function (response) {
                if (response.status) {
                    vm.messages = response.data;
                }
            }).error(function (error) {
            });
        }
    }

})();

/**
 * Created by Jason.z on 2016/11/23.
 */
(function () {

    'use strict';

    MessageFanController.$inject = ["$http", "ENV"];
    angular
        .module('kd.message')
        .controller('MessageFanController', MessageFanController);

    function MessageFanController($http, ENV) {

        var vm = this;
        vm.messages = [];

        getMessages();

        function getMessages() {

            $http.get(ENV.apiUrl + 'message/fan').success(function (response) {
                if (response.status) {
                    vm.messages = response.data;
                }
            }).error(function (error) {
            });
        }
    }

})();
(function() {

    'use strict';

    MessageLikeController.$inject = ["$http", "ENV"];
    angular
        .module('kd.message')
        .controller('MessageLikeController', MessageLikeController);  

    function MessageLikeController($http,ENV) {

        var vm = this; 
        vm.messages = [];

        getMessages();

        function getMessages() {

            $http.get(ENV.apiUrl+'message/like').success(function(response) {
                if(response.status) {
                    vm.messages = response.data;
                }
            }).error(function(error) {
            });
        }
    }
    
})(); 
/**
 * Created by Jason.z on 2016/11/9.
 */

(function() {

    'use strict';

    MessageNoticeController.$inject = ["$http", "ENV"];
    angular
        .module('kd.message')
        .controller('MessageNoticeController', MessageNoticeController);

    function MessageNoticeController($http,ENV) {

        var vm = this;
        vm.messages = [];

        getMessages();

        function getMessages() {

            $http.get(ENV.apiUrl+'message/notice').success(function(response) {
                if(response.status) {
                    vm.messages = response.data;
                }
            }).error(function(error) {
            });
        }
    }

})();

(function() {

    'use strict';

    MessageController.$inject = ["$http", "ENV"];
    angular
        .module('kd.message')
        .controller('MessageController', MessageController);  

    function MessageController($http,ENV) {

        var vm = this; 
        vm.count = {};

        getMessages();

        function getMessages() {

            $http.get(ENV.apiUrl+'user/messages').success(function(response) {
                if(response.status) {
                    vm.count = response.data;
                    console.log(vm.count);
                }
            }).error(function(error) {
            });
        }
    }
    
})(); 
(function() {

    'use strict';

    MyController.$inject = ["$state", "$localStorage"];
    angular
        .module('kd.my')
        .controller('MyController', MyController);  

    function MyController($state,$localStorage) {

        var vm = this; 
        vm.user = $localStorage.user;
        vm.new_messages_count = $localStorage.new_messages_count;

        vm.doLogout = doLogout;

        function doLogout() {
        	delete $localStorage.user;
        	delete $localStorage.token;
        	$state.go('login');
        }

    }
    
})();
/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    angular
        .module('kd.route')
        .config(routeConfig);

    routeConfig.$inject = ['$stateProvider', '$urlRouterProvider'];
    function routeConfig($stateProvider,$urlRouterProvider) {
        $stateProvider.state('init', {
            url: '/',
            templateUrl: 'templates/init.html',
            controller: 'InitController as init'
        }).state('bind', {
            url: '/bind',
            templateUrl: 'templates/bind.html',
            controller: 'BindController as bind'
        }).state('find', {
            url: '/find',
            templateUrl: 'templates/find.html',
            controller: 'FindController as find'
        }).state('login', {
            url: '/login',
            templateUrl: 'templates/login.html',
            controller: 'LoginController as login',
            resolve:{
                isQQInstalled:["OAuth", function(OAuth){
                    return OAuth.isQQInstalled();
                }],
                isWeiboInstalled:["OAuth", function(OAuth){
                    return OAuth.isWeiboInstalled();
                }],
                isXiaomiChannel:["Comm", function(Comm){
                    return Comm.isXiaoMiChannel();
                }]
            }
        }).state('register', {
            url: '/register',
            templateUrl: 'templates/register.html',
            controller: 'RegisterController as register',
            resolve:{
                isQQInstalled:["OAuth", function(OAuth){
                    return OAuth.isQQInstalled();
                }],
                isWeiboInstalled:["OAuth", function(OAuth){
                    return OAuth.isWeiboInstalled();
                }],
                isXiaomiChannel:["Comm", function(Comm){
                    return Comm.isXiaoMiChannel();
                }]
            }
        }).state('app', {
            url: "/app",
            abstract: true,
            templateUrl: "templates/app.html",
            controller: 'AppController as app'
        }).state('app.home', {
            url: "/home",
            views: {
                'home-tab': {
                    templateUrl: "templates/home.html",
                    controller: 'HomeController as home',
                    resolve:{
                        goals:["User", function(User){
                            return User.getGoals().then(function(goals){
                                return goals;
                            },function(error){
                                return [];
                            });
                        }]
                    }
                }
            }
        }).state('app.explore', {
            url: "/explore",
            views: {
                'explore-tab': {
                    templateUrl: "templates/explore.html",
                    controller: 'ExploreController as explore'
                }
            }
        }).state('app.top', {
            url: "/top",
            views: {
                'top-tab': {
                    templateUrl: "templates/top.html",
                    controller: 'TopController as top',
                }
            }
        }).state('app.my', {
            url: "/my",
            views: {
                'my-tab': {
                    templateUrl: "templates/my.html",
                    controller: 'MyController as my'
                }
            }
        }).state('goalevent', {
            url: "/goal/event/:goalId",
            templateUrl: 'templates/goal_event.html',
            controller: 'GoalEventCtrl'
        }).state('goallog', {
            url: "/goal/log/:goalId",
            templateUrl: 'templates/goal_log.html',
            controller: 'GoalLogCtrl'
        }).state('goalsearch', {
            url: '/goal/search',
            templateUrl: 'templates/goal_search.html',
            controller: 'GoalSearchController as goalsearch',
        }).state('goalhome', {
            url: '/goal/:goalId/home',
            templateUrl: 'templates/goal_home.html',
            controller: 'GoalHomeController as goalhome',
        }).state('goaladd', {
            url: '/goal/add',
            templateUrl: 'templates/goal_add.html',
            controller: 'GoalAddController as goaladd',
            cache:false
        }).state('goaledit', {
            url: '/goal/:goalId/edit',
            templateUrl: 'templates/goal_edit.html',
            controller: 'GoalEditController as goaledit'
        }).state('goalview', {
            url: '/goal/:goalId',
            templateUrl: 'templates/goal_view.html',
            controller: 'GoalViewController as goalview',
            resolve:{
                goal:["$stateParams", "User", function($stateParams,User){
                    var goalId = $stateParams.goalId;
                    console.log(goalId);
                    return User.getGoal(goalId).then(function(goal){
                        return goal;
                    },function(error){
                        return {};
                    });
                }]
            }
        }).state('goalsetting', {
            url: "/goal/:goalId/setting",
            templateUrl: "templates/goal_setting.html",
            controller: 'GoalSettingController as goalsetting',
            resolve:{
                goal:["$stateParams", "User", function($stateParams,User){
                    var goalId = $stateParams.goalId;
                    console.log(goalId);
                    return User.getGoal(goalId).then(function(goal){
                        return goal;
                    },function(error){
                        return {};
                    });
                }]
            }
        }).state('goalcalendar', {
            url: "/goal/:goalId/calendar",
            templateUrl: "templates/goal_calendar.html",
            controller: 'GoalCalendarController as goalcalendar'
        }).state('goaldata', {
            url: "/goal/:goalId/data",
            templateUrl: "templates/goal_data.html",
            controller: 'GoalDataController as goaldata'
        }).state('goaltop', {
            url: "/goal/top/:goalId",
            templateUrl: "templates/goal_top.html",
            controller: 'GoalTopCtrl'
        }).state('checkinadd', {
            url: '/checkin/add/:goalId',
            templateUrl: 'templates/checkin_add.html',
            controller: 'CheckinAddController as checkinadd',
            resolve:{
                goal:["$stateParams", "User", function($stateParams,User){
                    var goalId = $stateParams.goalId;
                    console.log(goalId);
                    return User.getGoal(goalId).then(function(goal){
                        return goal;
                    },function(error){
                        return {};
                    });
                }]
            }
        }).state('eventinfo', {
            url: "/event/:eventId",
            templateUrl: "templates/event_info.html",
            controller: 'EventInfoController as eventinfo'
        }).state('eventlike', {
            url: "/event/:eventId/like",
            templateUrl: "templates/event_like.html",
            controller: 'EventLikeController as eventlike'
        }).state('eventshare', {
            url: "/event/:eventId/share",
            templateUrl: "templates/event_share.html",
            controller: 'EventShareController as eventshare',
            cache:false
        }).state('userhome', {
            url: "/user/:userId",
            templateUrl: 'templates/user_home.html',
            controller: 'UserHomeController as userhome'
        }).state('userlevel', {
            url: "/user/:userId/level",
            templateUrl: 'templates/user_level.html',
            controller: 'UserLevelController as userlevel'
        }).state('userfans', {
            url: "/user/:userId/fans",
            templateUrl: 'templates/user_fans.html',
            controller: 'UserFansController as userfans'
        }).state('userfollow', {
            url: "/user/:userId/follow",
            templateUrl: 'templates/user_follow.html',
            controller: 'UserFollowController as userfollow'
        }).state('usergoals', {
            url: "/user/:userId/goals",
            templateUrl: 'templates/user_goals.html',
            controller: 'UserGoalsController as usergoals'
        }).state('userenergy', {
            url: "/user/:userId/energy",
            templateUrl: 'templates/user_energy.html',
            controller: 'UserEnergyController as userenergy'
        }).state('setting', {
            url: "/setting",
            templateUrl: "templates/setting.html",
            controller: 'SettingController as setting'
        }).state('profile', {
            url: "/profile",
            templateUrl: "templates/profile.html",
            controller: 'ProfileController as profile'
        }).state('feedback', {
            url: "/feedback",
            templateUrl: "templates/feedback.html",
            controller: 'FeedbackController as feedback'
        }).state('about', {
            url: "/about",
            templateUrl: "templates/about.html",
            controller: 'SettingController as setting'
        }).state('version', {
            url: "/version",
            templateUrl: "templates/version.html",
            controller: 'VersionCtrl'
        }).state('message', {
            url: "/message",
            templateUrl: "templates/message.html",
            controller: 'MessageController as message'
        }).state('messagelike', {
            url: "/message/like",
            templateUrl: "templates/message_like.html",
            controller: 'MessageLikeController as messagelike'
        }).state('messagenotice', {
            url: "/message/notice",
            templateUrl: "templates/message_notice.html",
            controller: 'MessageNoticeController as messagenotice'
        }).state('messagecomment', {
            url: "/message/comment",
            templateUrl: "templates/message_comment.html",
            controller: 'MessageCommentController as messagecomment'
        }).state('messagefan', {
            url: "/message/fan",
            templateUrl: "templates/message_fan.html",
            controller: 'MessageFanController as messagefan'
        }).state('topic', {
            url: "/topic/:topicName",
            templateUrl: "templates/topic.html",
            controller: 'TopicController as topic'
        }).state('mall', {
            url: "/mall",
            templateUrl: "templates/mall.html",
            controller: 'MallController as mall'
        }).state('goodview', {
            url: "/good/:goodId",
            templateUrl: "templates/good_view.html",
            controller: 'GoodViewController as goodview'
        }).state('donate', {
            url: "/donate",
            templateUrl: "templates/donate.html",
        });

        $urlRouterProvider.otherwise('/');

    }


})();


/**
 * Created by Jason.z on 2016/12/18.
 */

(function() {
    'use strict';

    appRateConfig.$inject = ["$cordovaAppRateProvider"];
    angular
        .module('kd.setting')
        .config(appRateConfig);

    function appRateConfig($cordovaAppRateProvider) {
        document.addEventListener("deviceready", function () {
            var prefs = {
                language: 'zh-Hans',
                appName: '水滴打卡',
                iosURL: '1017364870',
                androidURL: 'market://details?id=me.growu.drip',
                windowsURL: 'ms-windows-store:Review?name=me.growu.drip'
            };
            $cordovaAppRateProvider.setPreferences(prefs);
        }, false);
    }
})();

/**
 * Created by Jason.z on 16/9/29.
 */

(function() {

    'use strict';

    FeedbackController.$inject = ["$http", "$state", "$log", "Loading", "ENV", "Upload"];
    angular
        .module('kd.setting')
        .controller('FeedbackController', FeedbackController);

    function FeedbackController($http,$state,$log,Loading,ENV,Upload) {

        var vm = this;

        vm.feedback = {
            'content':'',
            'attaches':[],
            'device':ionic.Platform.device(),
            'version':ENV.version
        };

        vm.doFeedback = function(){
            $http.post(ENV.apiUrl + 'user/feedback', vm.feedback).success(function(response) {
                $log.debug(response);
                if (response.status) {
                    Loading.show('感谢反馈,我们会在第一时间处理你的意见～');
                    $state.go('setting');
                } else {
                    $ionicLoading.show({
                        template: response.message,
                        noBackdrop: true,
                        duration: 2000
                    });
                }
            }).error(function(error) {
            });
        };

        vm.doUpload = function() {
            Upload.imageUpload().then(function(data){
                vm.feedback.attaches = [];
                vm.feedback.attaches.push(data);
            },function(error){

            });
        };

        vm.removeAttach = function() {
            vm.feedback.attaches = [];
        };


    }

})();

/**
 * Created by Jason.z on 16/9/20.
 */

(function () {

    'use strict';

    SettingController.$inject = ["$cordovaAppRate", "Update", "ENV"];
    angular
        .module('kd.setting')
        .controller('SettingController', SettingController);

    function SettingController($cordovaAppRate,Update,ENV) {

        var vm = this;

        vm.latestVersion = {};
        vm.localVersionNo = ENV.version;

        vm.isNeedUpdate = false;
        vm.isOpenCheck = false;

        // 检查更新
        Update.check(true).then(function(version){
            vm.latestVersion = version;
            if(version) {
                // 本地版本号小于服务器版本号
                if(version.no>vm.localVersionNo) {
                    vm.isNeedUpdate = true;
                }
                // 本地版本号大于服务器版本号
                if(version.no>=vm.localVersionNo) {
                    vm.isOpenCheck = true;
                }
            }
        },function(error){

        });


        vm.doRate = function () {
            document.addEventListener("deviceready", function () {
                $cordovaAppRate.navigateToAppStore().then(function (result) {
                    // success
                });
            }, false);
        };


        vm.doUpdate = function () {
            Update.update(vm.latestVersion).then(function(success){
            },function(error){
            });
        };
    }

})();

(function() {

    'use strict';

    TopController.$inject = ["$http", "ENV"];
    angular
        .module('kd.top')
        .controller('TopController', TopController);  

    function TopController($http,ENV) {

        var vm = this;
        
        vm.users = [];

        getTop();

        function getTop() {

            $http.get(ENV.apiUrl+'top/users').success(function(data) {
                vm.users = data.users;
                vm.rank = data.rank;
                vm.count = data.count;
                vm.month = data.month;
            }).error(function(error) {
            });
        }
    }
    
})();
/**
 * Created by Jason_z on 2016/11/16.
 */

(function() {

    'use strict';

    TopicController.$inject = ["$scope", "$stateParams", "$ionicScrollDelegate", "$timeout", "Topic", "ENV"];
    angular
        .module('kd.topic')
        .controller('TopicController', TopicController);

    function TopicController($scope,$stateParams,$ionicScrollDelegate,$timeout,Topic,ENV) {

        var vm = this;
        vm.topic = {
            'follow_count':0
        };
        vm.events = [];
        vm.resUrl = ENV.resUrl;
        vm.currentIndex = 'new';
        vm.position = 0;
        vm.topicName = $stateParams.topicName;

        Topic.getInfo(vm.topicName).then(function(topic){
            if(topic) {
                vm.topic = topic;
            }
        },function(error){
        });

        vm.onTabSelected = function(type) {
            vm.currentIndex = type;
            vm.events = [];
            getEvents(0);
        };

        vm.showMore =  function(eventId) {
            Event.showMore(eventId);
        };

        vm.doRefresh = function() {
            getEvents(0);
            $scope.$broadcast('scroll.refreshComplete');
            $scope.$apply();
        };

        vm.loadMore = function() {
            var num = 0;
            if(vm.events) {
                num = vm.events.length;
            }
            if (num > 0 && num % 20 === 0) {
                getEvents(num);
            }
            $scope.$broadcast('scroll.infiniteScrollComplete');
        };

        function getEvents(offset) {

            $scope.$watch(function(){
                    return vm.topic;
                },
                function (topic) {
                   if(topic.id) {
                       Topic.getEvents(vm.topic.id,offset,vm.currentIndex).then(function(data){
                           if(offset === 0) {
                               vm.events = data;
                           } else {
                               vm.events = vm.events.concat(data);
                           }
                       },function(error){

                       });
                   }
                }
            );
        }

        vm.getScrollPosition = function() {
            $timeout(function () {
                vm.position = $ionicScrollDelegate.getScrollPosition().top;
            });
            console.log(vm.position);
        };
    }

})();

/**
 * Created by Jason.z on 2016/11/17.
 */



(function() {
    'use strict';

    Topic.$inject = ["$http", "$q", "ENV", "Loading"];
    angular
        .module('kd.topic')
        .factory('Topic', Topic);

    function Topic($http, $q,ENV,Loading) {

        var service = {
            getInfo: getInfo,
            getEvents:getEvents,
        };

        return service;

        function getInfo(topicName){
            var deferred = $q.defer();

            $http.get(ENV.apiUrl + 'topic/info?name='+topicName)
                .success(function(response) {
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function(error) {
                deferred.reject(error);
            });
            return deferred.promise;
        }

        // 获取动态列表
        function getEvents(topicId,offset,type){
            var deferred = $q.defer();
            var params = {};
            params.topic_id = topicId;
            params.offset = offset;

            if(type) {
                params.type = type;
            }
            Loading.showWaiting("正在加载动态列表...");
            $http.get(ENV.apiUrl + 'topic/events',{params:params})
                .success(function(response) {
                    Loading.hide();
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function(error) {
                Loading.hide();
                deferred.reject(error);
            });
            return deferred.promise;
        }


    }

})();

/**
 * Created by Jason.z on 16/7/29.
 */

(function() {

    'use strict';

    ProfileController.$inject = ["$state", "Loading", "$localStorage", "User", "Upload"];
    angular
        .module('kd.user')
        .controller('ProfileController', ProfileController);

    function ProfileController($state, Loading,$localStorage,User,Upload) {

        var vm = this;

        vm.profile = {};

        var user = $localStorage.user;

        if(user) {
            vm.profile.nickname = user.nickname;
            vm.profile.signature = user.signature;
            vm.profile.user_avatar = user.user_avatar;
        }

        // User.getInfo(userId).then(function(data){
        //     $scope.user = data;
        //     $scope.profile.nickname = data.nickname;
        //     $scope.profile.signature = data.signature;
        //     $scope.profile.user_avatar = data.user_avatar;
        // });

        vm.saveProfile = function() {
            User.saveProfile(vm.profile).then(function(data){
                Loading.show("更新成功");
                $state.go('app.my');
            });
        };

        vm.avatarPick = function() {
            Upload.imageUpload().then(function(data){
                var image = document.getElementById('avatar');
                image.src = data.url;
                vm.profile.user_avatar = data.url;
            },function(error){

            });
        };
    }

})();

/**
 * Created by Jason.z on 2016/12/9.
 */

(function() {

    'use strict';

    UserEnergyController.$inject = ["$scope", "$http", "$stateParams", "User", "ENV"];
    angular
        .module('kd.user')
        .controller('UserEnergyController', UserEnergyController);

    function UserEnergyController($scope,$http,$stateParams,User,ENV) {
        var vm = this;
        vm.logs = [];
        vm.user = {};

        // $ionicHistory.nextViewOptions({
        //     disableBack: true
        // });
        vm.userId = $stateParams.userId;

        User.getInfo(vm.userId).then(function(data){
            vm.user = data;
        });


        getLogs(0);

        vm.doRefresh = function () {
            getLogs(0);
            $scope.$broadcast('scroll.refreshComplete');
            $scope.$apply();
        };

        vm.loadMore = function () {
            var num = vm.logs.length;
            if (num > 0 && num % 10 === 0) {
                getLogs(num);
            }
            $scope.$broadcast('scroll.infiniteScrollComplete');

        };


        function getLogs(offset) {
            var params = {};
            params.user_id = vm.userId;
            params.offset = offset;

            $http.get(ENV.apiUrl + 'user/energy',{params:params})
                .success(function(response) {
                    if (response.status) {
                        if(offset === 0) {
                            vm.logs = response.data;
                        } else {
                            vm.logs = vm.logs.concat(response.data);
                        }
                    }
                    else {
                    }
                }).error(function(data) {

                });

        }

        // User.getFans(vm.userId).then(function(data){
        //     vm.users = data;
        // });


    }

})();

/**
 * Created by Jason.z on 2016/11/14.
 */

(function() {

    'use strict';

    UserFansController.$inject = ["$scope", "$stateParams", "User"];
    angular
        .module('kd.user')
        .controller('UserFansController', UserFansController);

    function UserFansController($scope,$stateParams,User) {
        var vm = this;
        vm.users = [];

        // $ionicHistory.nextViewOptions({
        //     disableBack: true
        // });

        vm.userId = $stateParams.userId;

        User.getInfo(vm.userId).then(function(user){
            vm.user = user;
        },function(error){
        });

        getFans(0);

        vm.doRefresh = function () {
            getFans(0);
            $scope.$broadcast('scroll.refreshComplete');
            $scope.$apply();
        };

        vm.loadMore = function () {
            var num = vm.users.length;
            if (num > 0 && num % 10 === 0) {
                getFans(num);
            }
            $scope.$broadcast('scroll.infiniteScrollComplete');

        };

        vm.showMore = function(eventId) {
            User.showMore(eventId);
        };

        function getFans(offset) {
            User.getFans(vm.userId,offset).then(function(users){
                if(offset === 0) {
                    vm.users = users;
                } else {
                    vm.users = vm.users.concat(users);
                }
            },function(error){

            });
        }

        // User.getFans(vm.userId).then(function(data){
        //     vm.users = data;
        // });


    }

})();

/**
 * Created by Jason.z on 2016/11/15.
 */

(function() {

    'use strict';

    UserFollowController.$inject = ["$scope", "$stateParams", "User"];
    angular
        .module('kd.user')
        .controller('UserFollowController', UserFollowController);

    function UserFollowController($scope,$stateParams,User) {
        var vm = this;
        vm.users = [];

        // $ionicHistory.nextViewOptions({
        //     disableBack: true
        // });

        vm.userId = $stateParams.userId;

        User.getInfo(vm.userId).then(function(user){
            vm.user = user;
        },function(error){
        });

        getFollow(0);

        vm.doRefresh = function () {
            getFollow(0);
            $scope.$broadcast('scroll.refreshComplete');
            $scope.$apply();
        };

        vm.loadMore = function () {
            var num = vm.users.length;
            if (num > 0 && num % 10 === 0) {
                getFollow(num);
            }
            $scope.$broadcast('scroll.infiniteScrollComplete');

        };

        function getFollow(offset) {
            User.getFollow(vm.userId,offset).then(function(users){
                if(offset === 0) {
                    vm.users = users;
                } else {
                    vm.users = vm.users.concat(users);
                }
            },function(error){

            });
        }

        // User.getFans(vm.userId).then(function(data){
        //     vm.users = data;
        // });


    }

})();

/**
 * Created by Jason.z on 2016/11/4.
 */
(function() {

    'use strict';

    UserGoalsController.$inject = ["$http", "$stateParams", "$localStorage", "ENV"];
    angular
        .module('kd.user')
        .controller('UserGoalsController', UserGoalsController);

    function UserGoalsController($http,$stateParams,$localStorage,ENV) {

        var vm = this;

        vm.goals = [];



    }

})();
(function() {

    'use strict';

    UserHomeController.$inject = ["$scope", "$ionicPopover", "$ionicHistory", "$stateParams", "$timeout", "$ionicScrollDelegate", "$localStorage", "User", "ENV", "Event"];
    angular
        .module('kd.user')
        .controller('UserHomeController', UserHomeController);  

    function UserHomeController($scope,$ionicPopover,$ionicHistory,$stateParams,$timeout,$ionicScrollDelegate,$localStorage,User,ENV,Event) {

        var vm = this; 

        var userId = $stateParams.userId;
		vm.resUrl = ENV.resUrl;
		vm.position = 0;

	    vm.isSelf = false;
		vm.isFollow = false;

		vm.level = '';

		var names = ['无','卡渣','卡弱','卡民','卡霸','卡尊','卡圣','卡神','卡帝'];

		if (userId ==  $localStorage.user.user_id) {
	        vm.isSelf = true;
		}

		User.getInfo(userId).then(function(data){
			vm.user = data;
			vm.isFollow = vm.user.is_follow;
			vm.level = names[data.level];
		});

		vm.goBack = goBack;

		function goBack(){
			$ionicHistory.goBack();
		}

		vm.getScrollPosition = function() {
			$timeout(function () {
				vm.position = $ionicScrollDelegate.getScrollPosition().top;
			});
		};

	    vm.events = [];

	    vm.getEvents = getEvents;

	    function getEvents(offset,cache) {
			Event.getList(offset,'new',userId,cache).then(function(data){
	            if (offset === 0) {
	                vm.events = data;
	            } else {
	                vm.events = vm.events.concat(data);
	            }
	        });
	    }

	    getEvents(0,true);

	    vm.doRefresh = function() {
	        getEvents(0,true);
	        $scope.$broadcast('scroll.refreshComplete');
			$scope.$apply();
	    };

		vm.loadMore = function() {
			var num = vm.events.length;
			if (num > 0 && num % 20 === 0) {
				getEvents(num,false);
			}
			$scope.$broadcast('scroll.infiniteScrollComplete');
		};


		if(!vm.isSelf) {
			initPopover();
		}

		function initPopover() {
			$ionicPopover.fromTemplateUrl('templates/user_home_menu.html', {
				scope: $scope
			}).then(function(popover) {
				vm.popover = popover;
			});
		}

		vm.showMenu = function ($event) {
			vm.popover.show($event);
		};

		vm.hideMenu = function(){
			vm.popover.hide();
		};

		//Cleanup the popover when we're done with it!
		$scope.$on('$destroy', function() {
			vm.popover.remove();
		});

		// Execute action on hide popover
		$scope.$on('popover.hidden', function() {
			// Execute action
		});

		// Execute action on remove popover
		$scope.$on('popover.removed', function() {
			// Execute action
		});

		vm.report = function(){
			vm.hideMenu();
			User.doReport("user",userId).then(function(response){
			},function(error){

			});
		};

		vm.blacklist = function(){
			vm.hideMenu();
			User.blacklist(userId).then(function(response){
			},function(error){

			});
		};


		vm.doFollow = function(userId){
			User.doFollow(userId).then(function(){
				vm.isFollow = true;
				vm.user.fans_count ++;
			},function(error){

			});
		};

		vm.unFollow = function(userId){
			User.unFollow(userId).then(function(){
				vm.isFollow = false;
				vm.user.fans_count --;
			},function(error){

			});
		};

    }
    
})();
(function() {

    'use strict';

    UserLogoutController.$inject = ["$http", "$stateParams", "$localStorage", "ENV"];
    angular
        .module('kd.user')
        .controller('UserLogoutController', UserLogoutController);  

    function UserLogoutController($http,$stateParams,$localStorage,ENV) {

        var vm = this; 
        
        vm.user = $localStorage.user;

        var userId = $stateParams.userId;

	    vm.isSelf = false;

    }
    
})();
/**
 * Created by Jason.z on 16/7/29.
 */

(function () {
    'use strict';

    User.$inject = ["$q", "$http", "$localStorage", "$log", "ENV", "Loading", "$ionicActionSheet", "Auth", "CacheFactory"];
    angular
        .module('kd.user')
        .factory('User', User);

    function User($q, $http, $localStorage,$log, ENV, Loading, $ionicActionSheet,Auth,CacheFactory) {

        var service = {
            getInfo: getInfo,
            saveProfile: saveProfile,
            doReport: doReport,
            doFollow: doFollow,
            unFollow: unFollow,
            getFans: getFans,
            getFollow: getFollow,
            getGoals: getGoals,
            getGoal:getGoal
        };

        return service;

        function getInfo(userId) {
            var deferred = $q.defer();

            $http.get(ENV.apiUrl + 'user/info?user_id=' + userId)
                .success(function (response) {
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function (data) {
                deferred.reject(data);
            });
            return deferred.promise;
        }

        function saveProfile(profile) {
            var deferred = $q.defer();

            $http.post(ENV.apiUrl + 'user/profile', profile
            ).success(function (response) {
                if (response.status) {
                    //
                    $localStorage.user.nickname = profile.nickname;
                    $localStorage.user.signature = profile.signature;
                    $localStorage.user.user_avatar = profile.user_avatar;

                    deferred.resolve(response.data);
                } else {
                    deferred.reject(data);
                }
            }).error(function (error) {
                deferred.reject(error);
            });
            return deferred.promise;
        }

        // 举报
        function doReport(obj_type, obj_id) {
            var deferred = $q.defer();
            console.log(obj_id);
            $ionicActionSheet.show({
                buttons: [
                    {text: '含有赌博,色情等违法内容'},
                    {text: '垃圾广告,传销'},
                    {text: '其他'}
                ],
                destructiveText: '',
                titleText: '请选择举报类型',
                cancelText: '取消',
                cancel: function () {
                    deferred.resolve("取消举报");
                    return true;
                },
                buttonClicked: function (index) {
                    $http.post(ENV.apiUrl + 'user/report', {obj_id: obj_id, obj_type: obj_type, reason: index}
                    ).success(function (response) {
                        if (response.status) {
                            Loading.show("举报成功");
                            deferred.resolve("举报成功");
                        } else {
                            Loading.show("举报失败");
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                        deferred.reject(error);
                    });
                    return true;
                }
            });

            return deferred.promise;
        }

        // 关注
        function doFollow(userId) {
            var deferred = $q.defer();

            // TODO 判断参数是否合法,是否未用户自己

            if (typeof userId == undefined) {
                deferred.reject("缺少userId参数");
            }

            $http.post(ENV.apiUrl + 'user/follow', {follow_user_id: userId}
            ).success(function (response) {
                if (response.status) {
                    Loading.show("关注成功");
                    deferred.resolve("关注成功");
                } else {
                    deferred.reject(response.message);
                }
            }).error(function (error) {
                deferred.reject(error);
            });
            return deferred.promise;
        }

        // 取消关注
        function unFollow(userId) {
            var deferred = $q.defer();

            // TODO 判断参数是否合法,是否未用户自己

            if (typeof userId == undefined) {
                deferred.reject("缺少userId参数");
            }

            $http.post(ENV.apiUrl + 'user/unfollow', {follow_user_id: userId}
            ).success(function (response) {
                if (response.status) {
                    Loading.show("取消关注成功");
                    deferred.resolve("关注成功");
                } else {
                    deferred.reject(response.message);
                }
            }).error(function (error) {
                deferred.reject(error);
            });
            return deferred.promise;
        }

        // 获取用户粉丝
        function getFans(userId, offset) {
            var deferred = $q.defer();
            var params = {};
            params.user_id = userId;
            params.offset = offset;

            $http.get(ENV.apiUrl + 'user/fans', {params: params})
                .success(function (response) {
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function (data) {
                deferred.reject(data);
            });
            return deferred.promise;
        }

        // 获取用户关注
        function getFollow(userId, offset) {
            var deferred = $q.defer();

            var params = {};
            params.user_id = userId;
            params.offset = offset;

            $http.get(ENV.apiUrl + 'user/follow', {params: params})
                .success(function (response) {
                    if (response.status) {
                        deferred.resolve(response.data);
                    } else {
                        deferred.reject(response.message);
                    }
                }).error(function (data) {
                deferred.reject(data);
            });
            return deferred.promise;
        }

        function getGoal(goalId,cache) {
            var deferred = $q.defer();

            var params = {};

            params.user_id = Auth.getUserId();
            params.goal_id = goalId;

            cache = (typeof(cache)=='undefined')?true:cache;

            var userGoalCache = CacheFactory.get('userGoalCache');

            if(!userGoalCache) {
                userGoalCache = CacheFactory.createCache('userGoalCache', {
                    maxAge: 24 * 60 * 60 * 1000,
                    deleteOnExpire: 'aggressive'
                });
            }

            if(cache&&userGoalCache.get(goalId)) {
                $log.debug("从缓存中读取...");
                deferred.resolve(userGoalCache.get(goalId));
            } else {
                $log.debug("从服务器拉取...");
                Loading.showWaiting("正在获取目标详情");
                $http.get(ENV.apiUrl + 'user/goal',{params:params})
                    .success(function (response) {
                        if (response.status) {
                            Loading.hide();
                            userGoalCache.put(goalId,response.data);
                            deferred.resolve(response.data);
                        } else {
                            Loading.show(response.message);
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                    deferred.reject(error);
                });
            }
            return deferred.promise;
        }

        function getGoals(cache) {
            var deferred = $q.defer();
            // 是否通过缓存访问 默认true
            cache = (typeof(cache) == 'undefined') ? true : cache;

            var userGoalsCache = CacheFactory.get('userGoalsCache');

            if(!userGoalsCache) {
                userGoalsCache = CacheFactory.createCache('userGoalsCache', {
                    maxAge: 24 * 60 * 60 * 1000,
                    deleteOnExpire: 'aggressive'
                });
            }

            if(cache&&userGoalsCache.get('goals')) {
                deferred.resolve(userGoalsCache.get('goals'));
            } else {
                Loading.showWaiting("正在获取目标列表...");
                $http.get(ENV.apiUrl + 'user/goals')
                    .success(function (response) {
                        if (response.status) {
                            Loading.hide();
                            // 写入缓存
                            userGoalsCache.put("goals",response.data);
                            deferred.resolve(response.data);
                        } else {
                            Loading.show(response.message);
                            deferred.reject(response.message);
                        }
                    }).error(function (error) {
                    deferred.reject(error);
                });

            }
            return deferred.promise;
        }

    }

})();
/**
 * Created by tuo3 on 16/10/21.
 */
(function() {

    'use strict';

    UserLevelController.$inject = ["$http", "$stateParams", "ENV"];
    angular
        .module('kd.user')
        .controller('UserLevelController', UserLevelController);

    function UserLevelController($http,$stateParams,ENV) {

        var vm = this;

        var userId = $stateParams.userId;

        var names = ['无','卡渣','卡弱','卡民','卡霸','卡尊','卡圣','卡神','卡帝'];

        vm.levels = [0,0,0,0,0,0,0,0,0];

        vm.level = '无';
        vm.rank = 0;
        vm.count = 0;

        $http.get(ENV.apiUrl + 'user/level?user_id='+userId)
            .success(function(response) {
                if (response.status) {
                    vm.levels = response.data.levels;
                    vm.level = names[response.data.level];
                    vm.count = response.data.count;
                    vm.rank = response.data.rank;

                }
                else {
                }
            }).error(function(data) {

        });


    }

})();
angular.module('templates', []).run(['$templateCache', function($templateCache) {$templateCache.put('templates/about.html','<ion-view title="\u5173\u4E8E\u6211\u4EEC">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/setting"></a>\n\t\t<div class="title">\u5173\u4E8E</div>\n\t</ion-header-bar>\n\t<ion-content class="padding" style="margin-top:100px;">\n\t\t<center>\n\t\t\t<p>\u6C34\u6EF4\u6253\u5361\u662F\u4E00\u6B3E\u8F85\u52A9\u4F60\u5B8C\u6210\u7684\u4E60\u60EF\u517B\u6210\u548C\u76EE\u6807\u7BA1\u7406\u7684\u5DE5\u5177</p>\n\t\t\t<p>\u5B98\u7F51\uFF1A<a href="https://www.growu.me" target="_blank">https://www.growu.me</a></p>\n\t\t\t<p>\u5FAE\u535A: <a href="https://www.weibo.com/growu" target="_blank">@\u683C\u543E\u793E\u533A</a></p>\n\t\t\t<p>\u5FAE\u4FE1\u516C\u4F17\u53F7\uFF1Agrowu</p>\n\t\t\t<p>qq\u7FA4\uFF1A7852084</p>\n\t\t</center>\n\t</ion-content>\n</ion-view>\n');
$templateCache.put('templates/address.html','<ion-view title="\u5730\u5740">\n\t<ion-content>\n\t\t<ion-list>\n\t\t\t<ion-item class="item" ng-repeat="address in addresses" ng-click="setDefaultAddress(address.address_id,$index)">\n\t\t\t\t<div class="item-checkbox">\n\t\t\t\t    <label class="checkbox">\n\t\t\t\t       <input type="checkbox" ng-checked="address.is_default == 1">\n\t\t\t\t     </label>\n\t\t\t     \t<span class="input-label">{{address.address_province}}{{address.address_city}}{{address.address_area}}{{address.address_detail}}<br>{{address.address_recipient}}({{address.address_phone}})</span>\n\t\t\t     </div>\n\t\t\t     <ion-option-button class="button-positive" ng-click="editAddress(address.address_id)">\u7F16\u8F91</ion-option-button>\n\t\t\t     <ion-option-button class="button-assertive" ng-click="deleteAddress(address.address_id,$index)">\u5220\u9664</ion-option-button>\n\t\t\t</ion-item>\n\t\t</ion-list>\n\t\t<div class="list">\n\t\t\t<a class="item item-divider"></a>\n\t\t\t<a class="item item-icon-right" ng-click="goAddressAdd()">\n\t\t\t\t<i class="icon ion-ios-plus-outline"></i>\n\t\t\t\t\u65B0\u589E\u5730\u5740\n\t\t\t</a>\n\t\t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/address_add.html','<ion-view title="\u65B0\u589E\u5730\u5740">\n\t<ion-content>\n\t\t<form name="addressForm">\n\t\t<div class="list">\n\t\t  \t<label class="item item-input">\n\t\t    \t<span class="input-label">\u6536\u8D27\u4EBA</span>\n\t\t    \t<input type="text" name="recipient" ng-model="address.recipient" required ng-maxlength="20">\n\t\t    \t<div class="error" ng-if="addressForm.recipient.$touched && addressForm.recipient.$invalid">\n                    <small class="error" ng-if="addressForm.recipient.$error.required">\n                        \u6536\u8D27\u4EBA\u4E0D\u80FD\u4E3A\u7A7A\n                    </small>\n                    <small class="error" ng-if="addressForm.recipient.$error.maxlength">\n                        \u8F93\u5165\u5B57\u7B26\u957F\u5EA6\u8FC7\u957F\n                    </small>\n                </div>\n\t\t  \t</label>\n\t\t  \t<label class="item item-input">\n\t\t    \t<span class="input-label">\u624B\u673A/\u7535\u8BDD</span>\n\t\t    \t<input type="text" name="phone" ng-model="address.phone" required>\n\t\t    \t<div class="error" ng-if="addressForm.phone.$touched && addressForm.phone.$invalid">\n                    <small class="error" ng-if="addressForm.phone.$error.required">\n                        \u53F7\u7801\u4E0D\u80FD\u4E3A\u7A7A\n                    </small>\n                    <small class="error" ng-if="addressForm.phone.$error.maxlength">\n                        \n                    </small>\n                </div>\n\t\t  \t</label>\n\t\t\t<label class="item item-input item-select">\n\t\t    \t<div class="input-label">\n\t\t      \t\t\u7701\u4EFD\n\t\t    \t</div>\n\t    \t\t<select id="province" required="" ng-model="address.province" ng-options="key as key for (key,value) in division"  \n                            ng-change="address.city=\'\';address.district=\'\';">\n<!-- \t\t\t\t\t<option value="">\u8BF7\u9009\u62E9</option>\n -->\t\t\t\t</select>\n\t\t  \t</label>\n\t\t  \t<label class="item item-input item-select">\n\t\t    \t<div class="input-label" >\n\t\t      \t\t\u57CE\u5E02\n\t\t    \t</div>\n\t    \t\t<select ng-model="address.city" ng-options="key as key for (key,value) in division[address.province]"  \n                            ng-change="address.district=\'\';"></select>\n\t\t  \t</label>\n\t\t  \t<label class="item item-input item-select">\n\t\t    \t<div class="input-label">\n\t\t      \t\t\u533A/\u53BF\n\t\t    \t</div>\n\t    \t\t<select ng-model="address.area" ng-options="value as value for value in division[address.province][address.city]"></select>\n\t\t  \t</label>\n\t\t  \t<label class="item item-input item-select">\n\t\t    \t<div class="input-label">\n\t\t      \t\t\u4F4F\u5740\u7C7B\u578B\n\t\t    \t</div>\n\t    \t\t<select ng-model="address.type">\n\t      \t\t\t<option value="0">\u5BB6</option>\n\t      \t\t\t<option  value="1">\u529E\u516C</option>\n\t    \t\t</select>\n\t\t  \t</label>\n\t\t  \t<label class="item item-input">\n\t\t    \t<span class="input-label">\u8BE6\u7EC6\u5730\u5740</span>\n\t\t    \t<input type="text" ng-model="address.detail">\n\t\t  \t</label>\n\t\t</div>\n\t\t<div class="padding">\n\t\t\t<button class="button button-positive button-block" ng-click="saveAddress()">\u4FDD\u5B58</button>\n\t\t</div>\n\t\t</form>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/app.html','<ion-tabs class="tabs-icon-top tabs-color-active-positive">\n\n  <ion-tab title="\u9996\u9875" icon-off="ion-ios-home-outline" icon-on="ion-ios-home" href="#/app/home">\n    <ion-nav-view name="home-tab"></ion-nav-view>\n  </ion-tab>\n  \n  <ion-tab title="\u53D1\u73B0" icon-off="ion-ios-search" icon-on="ion-ios-search-strong" href="#/app/explore">\n    <ion-nav-view name="explore-tab"></ion-nav-view>\n  </ion-tab>\n\n  <ion-tab title="\u6392\u884C" icon-off="ion-ios-star-outline" icon-on="ion-ios-star" href="#/app/top">\n    <ion-nav-view name="top-tab"></ion-nav-view>\n  </ion-tab>\n  \n  <ion-tab title="\u6211" badge="app.count" badge-style="badge-assertive" icon-off="ion-ios-person-outline" icon-on="ion-ios-person" href="#/app/my">\n    <ion-nav-view name="my-tab"></ion-nav-view>\n  </ion-tab>\n</ion-tabs>');
$templateCache.put('templates/bind.html','<ion-view title="\u7ED1\u5B9A\u8D26\u6237">\n    <ion-header-bar class="bar-positive">\n        <div class="title">\u7ED1\u5B9A\u8D26\u6237</div>\n    </ion-header-bar>\n    <ion-content>\n        <form name="bindForm">\n            <div class="list list-inset">\n                <div class="item item-toggle">\n                     \u662F\u5426\u6CE8\u518C\u8FC7\u8D26\u6237\n                     <label class="toggle toggle-positive">\n                       <input type="checkbox" ng-model="bind.user.is_register">\n                       <div class="track">\n                         <div class="handle"></div>\n                       </div>\n                     </label>\n                </div>\n\n                <label class="item item-input">\n                    <input type="email" name="email" ng-model="bind.user.email" placeholder="\u90AE\u7BB1" required>\n                    <div class="error" ng-if="bindForm.email.$touched && bindForm.email.$dirty && bindForm.email.$invalid">\n                        <small class="error" ng-if="bindForm.email.$error.required">\n                            \u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                        <small class="error" ng-if="bindForm.email.$error.email">\n                            \u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E\n                        </small>\n                    </div>\n                </label>\n               \n                <label class="item item-input">\n                    <input type="password" name="password" ng-model="bind.user.password" placeholder="\u5BC6\u7801" required>\n                     <div class="error" ng-if="bindForm.password.$touched && bindForm.password.$dirty && bindForm.password.$invalid">\n                        <small class="error" ng-if="bindForm.password.$error.required">\n                            \u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                    </div>\n                </label>               \n            </div>\n            <div class="padding">\n                <button ng-click="bind.doBind()" ng-disabled="bindForm.$invalid" type="submit" class="button button-block button-positive">\u7ACB\u5373\u7ED1\u5B9A</button>\n                <!--<a href="#/app/home" class="button button-block button-default">\u8DF3\u8FC7\u8BE5\u6B65\u9AA4</a>-->\n            </div>   \n        </form>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/buy.html','<ion-view title="\u8D2D\u4E70">\n\t<ion-content>\n\t\t<div class="list">\n\t\t\t<a class="item item-icon-right" ng-click="goAddress()" ng-model="order.address_id">\n \t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t\t<strong>\u914D\u9001\u81F3\uFF1A</strong>\n\t\t\t\t<p>{{address.address_province}}{{address.address_city}}{{address.address_area}}{{address.address_detail}}</p>\n\t\t\t\t<p>{{address.address_recipient}}({{address.address_phone}})</p>\n\t\t\t</a>\n\t\t\t<div class="item item-thumbnail-left">\n\t\t\t\t<img ng-src="{{good.good_image}}">\n\t\t\t    <h2>{{good.good_title}}</h2>\n\t\t\t    <p>\u6570\u91CF\uFF1A1</p>\n\t\t\t    <p>\u5E93\u5B58\uFF1A{{good.stock_num}}</p>\n\t\t\t    <span class="assertive right" ng-if="type == \'tuan\'">{{good.tuan_price}}/\u4EF6</span>\n\t\t\t    <span class="assertive right" ng-if="type == \'single\'">{{good.single_price}}/\u4EF6</span>\n\t\t\t</div>\n\t\t\t<div class="item item-divider">\n\t\t\t\t<span class="assertive right" ng-if="type == \'tuan\'">\u5FEB\u9012\uFF1A{{good.freight_price}} \u603B\u4EF7 {{good.tuan_price}}/\u4EF6</span>\n\t\t\t    <span class="assertive right" ng-if="type == \'single\'">\u5FEB\u9012\uFF1A{{good.freight_price}} \u603B\u4EF7 {{good.single_price}}/\u4EF6</span>\n\t\t\t</div>\n\t\t\t<div class="item item-divider">\u8BF7\u9009\u62E9\u652F\u4ED8\u65B9\u5F0F</div>\n\t\t\t<div class="item item-checkbox" id="buy-checkbox">\n\t\t\t\t<label class="checkbox checkbox-assertive" >\n\t\t\t       <input type="checkbox" checked disabled >\n\t\t\t     </label>\n\t\t\t    \u5FAE\u4FE1\u652F\u4ED8\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="padding">\n\t\t\t<button class="button button-block button-assertive" ng-click="pay()">\u7ACB\u5373\u652F\u4ED8</button>\n\t\t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/checkin_add.html','<ion-view title="\u6253\u5361">\n\t<ion-header-bar class="bar-positive">\n      <a class="button button-icon button-clear ion-ios-arrow-back" href="#/goal/{{checkinadd.checkin.goal_id}}"></a>\n      <div class="title">\u6253\u5361</div>\n  \t</ion-header-bar>\n\t<ion-content class="">\n\t\t<ion-list>\n\t\t    <ion-item ng-repeat="item in checkinadd.goal.items" ng-if="checkinadd.goal.items.length" class="compact-item">\n\t\t    \t<label class="item-input">\n\t\t\t\t\t<span class="input-label">{{item.item_name}}:</span>\n\t\t\t\t\t<input type="text" ng-model="item.item_expect">\n\t\t\t\t\t<span class="input-label">{{item.item_unit}}</span>\n\t\t\t\t\t</label>\n\t\t\t\t<ion-option-button class="button-assertive" ng-click="checkinadd.delItem(item)">\u5220\u9664</ion-option-button>\n\t\t\t</ion-item>\n\t\t\t<div class="item item-divider"></div>\n \t\t\t<label class="item-input">\n\t\t        <textarea rows="5" cols="50" ng-model="checkinadd.checkin.content" placeholder="\u8BF7\u5199\u4E0B\u4ECA\u5929\u884C\u52A8\u6216\u611F\u60F3..."></textarea>\n\t\t    </label>\n\t\t   <label class="item item-input">\n\t\t        <button id="upload-image-btn" class="button button-icon icon ion-image" ng-click="checkinadd.doUpload()"></button>\n\t\t\t</label>\n\t\t   <div class="item" ng-if="checkinadd.checkin.attaches.length>0"  ng-repeat="attach in checkinadd.checkin.attaches">\n\t\t    \t<img ng-src="{{attach.url}}" class="full-image" src="{{attach.url}}" id="upload-image"/>\n\t\t\t\t<a href="javascript:void(0);" ng-click="checkinadd.removeAttach()"><p>\u5220\u9664</p></a>\n\t\t   </div>\n\t\t    <a class="item item-divider"></a>\n\n\t\t\t<li class="item item-toggle">\n\t\t\t\t\u662F\u5426\u516C\u5F00\n\t\t\t\t<label class="toggle toggle-positive">\n\t\t\t\t\t<input type="checkbox" ng-model="checkinadd.checkin.is_public" ng-checked="checkinadd.goal.pivot.is_public==1?true:false">\n\t\t\t\t\t<div class="track">\n\t\t\t\t\t\t<div class="handle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</li>\n\n\t\t     <li class="item item-toggle">\n\t\t\t     \u8865\u6253\u5361\n\t\t\t     <label class="toggle toggle-positive">\n\t\t\t       <input type="checkbox" ng-model="checkinadd.checkin.type">\n\t\t\t       <div class="track">\n\t\t\t         <div class="handle"></div>\n\t\t\t       </div>\n\t\t\t     </label>\n\t\t\t </li>\n\t\t\t <label class="item item-input item-select" ng-show="checkinadd.checkin.type">\n\t\t\t    <div class="input-label">\n\t\t\t      \u65E5\u671F\n\t\t\t    </div>\n\t\t\t    <select ng-model="checkinadd.checkin.day">\n\t\t\t      <option ng-selected="true" value="{{checkinadd.day1}}">{{checkinadd.day1}}</option>\n\t\t\t      <option value="{{checkinadd.day2}}">{{checkinadd.day2}}</option>\n\t\t\t      <option value="{{checkinadd.day3}}">{{checkinadd.day3}}</option>\n\t\t\t    </select>\n\t\t\t  </label>\n\t\t</ion-list>\n\n\t\t<div class="padding">\n\t\t\t<button class="button button-block button-positive" ng-click="checkinadd.doCheckin()">\u6253\u5361</button>\n\t\t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/checkin_comment.html','<ion-view title="\u8BC4\u8BBA">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/checkin/detail/{{checkinId}}"></a>\n\t\t<div class="title">\u8BC4\u8BBA</div>\n\t</ion-header-bar>\n\t<ion-content class="has-header">\n\t\t<div class="list">\n\t\t    <label class="item-input">\n\t\t        <textarea rows="10" cols="50" placeholder="\u5199\u4E0B\u4F60\u7684\u8BC4\u8BBA..." ng-model="comment.content"></textarea>\n\t\t    </label>\n\t\t</div>\n\t\t<div class="padding">\n        \t<button class="button button-block button-positive" ng-click="doComment()" ng-disabled="!comment.content.length">\u63D0\u4EA4</button>\n      \t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/checkin_succ_modal.html','<ion-view title="\u6253\u5361\u6210\u529F">\n<ion-content class="" style="padding-top:100px;">\n\t<center>\n\t\t<h3>\n\t\t\t\u6253\u5361\u6210\u529F\uFF0C\u6B63\u80FD\u91CF \uFF0B<span class="num">{{response.energy}}</span>\n\t\t</h3>\n\t</center>\n\t<center class="padding">\u622A\u81F3\u4ECA\u65E5\uFF0C\u4F60\u5DF2\u7ECF\u5728<span class="positive">#{{response.goal.goal_name}}#</span>\u9879\u76EE</center>\n\t<div class="row padding center">\n\t  \t<div class="col">\n\t  \t\t<strong class="num">{{response.goal.series_days}}</strong>\n\t  \t\t<br>\u8FDE\u7EED\u5929\u6570\n\t  \t</div>\n\t  \t<div class="col">\n\t  \t\t<strong class="num">{{response.goal.total_days}}</strong>\n\t  \t\t<br>\u603B\u5929\u6570\n\t  \t</div>\n\t  \t<div class="col">\n\t  \t\t<strong class="num">{{response.goal.energy}}</strong>\n\t  \t\t<br>\u6B63\u80FD\u91CF\n\t  \t</div>\n\t</div>\n\t<div class="padding">\n\t\t<center>\n\t\t<div class="button button-assertive" ng-click="doShare()">\n\t\t\t\u5206\u4EAB\u597D\u53CB\n\t\t</div>\n\t\t<div class="button" ng-click="cancelShare()">\n\t\t\t\u4F4E\u8C03\u8DEF\u8FC7\n\t\t</div>\n\t\t</center>\n\t</div>\n\t<div class="footer" style="margin-top:50px;" ng-if="response.users.length">\n\t\t<div class="list">\n\t\t\t<div class="item-divider center">\u8FD9\u4E9B\u5C0F\u4F19\u4F34\u4EEC\u4E5F\u521A\u521A\u5B8C\u6210\u4E86\u8BE5\u9879\u76EE\uFF1A</div>\n\t\t\t<a class="item item-icon-right avatar" href="#/goal\n\t\t\t/events/{{response.goal.goal_id}}">\n\t\t\t\t<img ng-src="{{user.user_avatar}}" fallback-src="img/default.jpg" ng-repeat="user in response.users">\n\t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t</a>\n\t\t\t<ion-checkbox ng-model="filter.blue" checkbox-positive>\u4E00\u952E\u70B9\u8D5E</ion-checkbox>\n\t\t</div>\n\t</div>\n</ion-content>\n\t\n</ion-view>');
$templateCache.put('templates/day.html','');
$templateCache.put('templates/donate.html','<ion-view title="\u6350\u8D60\u6211\u4EEC">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/setting"></a>\n        <div class="title">\u6350\u8D60\u6211\u4EEC</div>\n    </ion-header-bar>\n    <ion-content>\n       <div class="list">\n           <div class="item item-body">\n               <p>\u4ECE2013\u5E74\u521B\u529E \u300C\u683C\u543E\u793E\u533A\u300D \u4EE5\u6765 \uFF0C\u6211\u90FD\u628A\u6CE8\u610F\u529B\u653E\u5728\u5982\u4F55\u66F4\u9AD8\u6548\u5730\u5E2E\u52A9\u5927\u5BB6\u66F4\u597D\u5730\u7BA1\u7406\u76EE\u6807\u548C\u57F9\u517B\u4E60\u60EF\u4E0A\uFF0C\u56E0\u6B64\u4E5F\u4ECE\u672A\u8003\u8651\u8FC7\u505A\u4EFB\u4F55\u76C8\u5229\u3002</p>\n               <p>\u4F46\u662F\u968F\u7740\u7528\u6237\u5730\u4E0D\u65AD\u589E\u957F\uFF0C\u6211\u4EEC\u540C\u6837\u9762\u4E34\u7740\u5DE8\u989D\u5730\u5E26\u5BBD\uFF0C\u5F00\u53D1\u7B49\u6210\u672C\uFF0C\u663E\u7136\uFF0C\u8FD9\u9760\u6211\u4E00\u4E2A\u4EBA\u7684\u529B\u91CF\u663E\u7136\u662F\u65E0\u6CD5\u6491\u5230\u6700\u540E\u7684\u3002</p>\n               <p>\u56E0\u6B64\u5728\u672A\u4EA7\u751F\u76C8\u5229\u7684\u524D\u63D0\u4E0B\uFF0C\u6211\u5E0C\u671B\u6240\u6709\u8BA4\u540C\u6211\u4EEC\u4EF7\u503C\u89C2\u548C\u7406\u5FF5\u7684\u5C0F\u4F19\u4F34\u4EEC\u4E5F\u80FD\u591F\u8D21\u732E\u4E00\u4EFD\u81EA\u5DF1\u7684\u529B\u91CF\uFF0C\u4EE5\u652F\u6491\u6211\u4EEC\u66F4\u597D\u5730\u5F00\u53D1\u548C\u6539\u8FDB\u6211\u4EEC\u7684\u4EA7\u54C1\u3002</p>\n               <p>\u5982\u679C\u4F60\u613F\u610F\u6350\u8D60\u6211\u4EEC\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5411\u6211\u7684\u652F\u4ED8\u5B9D\u5E10\u53F7 <span class="positive">ccnuzxg@163.com</span> \u6216\u5FAE\u4FE1\u5E10\u53F7 <span class="positive">foxmee</span> \u8F6C\u8D26\uFF0C\u6216\u8005\u76F4\u63A5\u626B\u63CF\u4E0B\u9762\u4E8C\u7EF4\u7801\u8FDB\u884C\u8F6C\u8D26\uFF08\u8BF7\u5907\u6CE8:\u6C34\u6EF4\u6253\u5361+\u6CE8\u518C\u90AE\u7BB1\uFF0C\u4EE5\u4FBF\u8BB0\u5F55\uFF09</p>\n               <img src="img/alipay.jpeg" class="full-image">\n               <img src="img/wechat.jpeg" class="full-image">\n           </div>\n       </div>\n    </ion-content>\n</ion-view>\n');
$templateCache.put('templates/event_info.html','<ion-view title="\u52A8\u6001\u8BE6\u60C5">\n\t<ion-header-bar class="bar-positive">\n\t\t<go-back></go-back>\n\t\t<div class="title">\u52A8\u6001\u8BE6\u60C5</div>\n\t</ion-header-bar>\n\t<ion-content style="background-color:#e5e5e5;">\n\t\t<div class="list">\n\t\t  <div class="item item-avatar item-button-right">\n\t\t    <img ng-src="{{eventinfo.event.user.user_avatar}}" fallback-src="img/default.jpg" go-state="{state:\'userhome\',params:{userId:eventinfo.event.user_id}}">\n\t\t\t  <h2 go-state="{state:\'userhome\',params:{userId:eventinfo.event.user_id}}">{{eventinfo.event.user.nickname.length>0?eventinfo.event.user.nickname:\'keeper\'+eventinfo.event.user_id}}</h2>\n\t\t    <p ng-if="eventinfo.event.type == \'USER_CHECKIN\'"><span class="">#{{eventinfo.event.goal.goal_name}}#</span><span class="positive" style="font-size:2em;">{{eventinfo.event.checkin.total_days}}</span>\u5929</p>\n\t\t    <button class="button button-small button-clear" ng-if="eventinfo.event.type == \'USER_CHECKIN\'" style="font-size: 14px;">\n\t      \t\t<span am-time-ago="{{eventinfo.event.create_time*1000}}" am-preprocess="unix"></span>\n\t    \t</button>\n\t\t  </div>\n\n\t\t  <div class="item item-body" ng-if="eventinfo.event.checkin.items.length>0||eventinfo.event.checkin.checkin_content">\n\t\t\t\t<event-content content="{{eventinfo.event.checkin.checkin_content}}"></event-content>\n\t\t\t\t<p></p>\n\t\t\t  \t<img class="full-image" ng-src="{{eventinfo.resUrl+\'images/\'+eventinfo.event.checkin.attaches[0].attach_path+\'/\'+eventinfo.event.checkin.attaches[0].attach_name}}" ng-if="eventinfo.event.checkin.attaches.length>0">\n\t\t  </div>\n\n\t\t\t<div class="item item-icon-left checkin-item" ng-if="eventinfo.event.checkin.items.length>0" ng-repeat="item in eventinfo.event.checkin.items" style="font-size:14px;background-color: #f8f8f8;">\n\t\t\t\t<i class="icon ion-android-checkbox-outline"  style="font-size:16px;"></i>\n\t\t\t\t{{item.item_name}}<span class="pull-right"> {{item.item_value}} {{item.item_unit}}</span>\n\t\t\t</div>\n\t\t\t<div class="item tabs tabs-secondary tabs-icon-left">\n\t\t\t\t<a class="tab-item" href="javascript:void(0);" ng-click="eventinfo.doLike(eventinfo.event)">\n\t\t\t\t\t<i class="icon"\n\t\t\t\t\t   ng-class="{\'assertive\':eventinfo.event.is_like,\'ion-ios-heart-outline\':!eventinfo.event.is_like,\'ion-ios-heart\':eventinfo.event.is_like}"></i>\n\t\t\t\t\t{{eventinfo.event.like_count}}\n\t\t\t\t</a>\n\t\t\t\t<a class="tab-item">\n\t\t\t\t\t<i class="icon ion-ios-chatbubble-outline"></i>\n\t\t\t\t\t{{eventinfo.event.comment_count}}\n\t\t\t\t</a>\n\t\t\t\t<a class="tab-item" ng-click="eventinfo.showMore(event.event_id)">\n\t\t\t\t\t<i class="icon ion-ios-more-outline"></i>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t </div>\n\n\t\t <div class="list">\n\t\t\t<a class="item item-icon-right like-item" href="#/event\n\t\t\t/{{eventinfo.event.event_id}}/like">\n\t\t\t\t<label>\n\t\t\t\t{{eventinfo.event.like_count}} \u4EBA\u9F13\u52B1\n\t\t\t\t</label>\n\t\t\t\t<!--<div class="avatars">-->\n\t\t\t\t<img ng-src="{{like.user.user_avatar}}" fallback-src="img/default.jpg" ng-repeat="like in eventinfo.event.likes">\n\t\t\t\t<i class="icon iconfont" ng-if="eventinfo.event.likes.length>=6">&#xe60e;</i>\n\n\t\t\t\t<!--</div>-->\n\t\t\t</a>\n\t\t</div>\n\n\t\t <div class="list">\n\t\t \t <div class="item item-divider">\n\t\t\t    \u5168\u90E8\u8BC4\u8BBA {{eventinfo.event.comment_count}}\n\t\t\t  </div>\n\t\t    <div class="item item-avatar comment-item" ng-repeat="comment in eventinfo.event.comments" ng-click="eventinfo.showCommentMenu(comment,$event)">\n\t\t\t\t<img ng-src="{{comment.user.user_avatar}}" fallback-src="img/default.jpg" go-state="{state:\'userhome\',params:{userId:comment.user_id}}">\n\t\t\t\t<span class="item-note">\n\t\t\t\t\t<i class="icon ion-ios-undo-outline" ng-click="eventinfo.doReply(comment,$event)"></i>\n\t\t\t\t\t<i class="icon ion-thumbsup" ng-click="eventinfo.doLike(comment,$event)"></i>\n\t\t\t\t\t<em ng-if="comment.like_count>0">{{comment.like_count}}</em>\n\t\t\t\t</span>\n\t\t\t\t<h2 go-state="{state:\'userhome\',params:{userId:comment.user_id}}">{{comment.user.nickname.length>0?comment.user.nickname:\'keeper\'+comment.user_id}}</h2>\n\t\t\t\t<p am-time-ago="{{comment.create_time*1000}}" am-preprocess="unix" style="font-size:12px;color:#b2b2b2;"></p>\n\t\t\t\t<p ng-if="comment.parent_id>0" class="comment-quota"><span class="positive">{{comment.parent.user.nickname}}</span>: {{comment.parent.content}}</p>\n\t\t\t\t<p>{{comment.content}}</p>\n\t\t    </div>\n\t\t    <div class="item" ng-if="eventinfo.event.comments.length == 0">\n\t\t    \t\u6682\u65E0\u8BC4\u8BBA\n\t\t    </div>\n\t\t</div>\n\t\t\n\t</ion-content>\n\n\t<ion-footer-bar keyboard-attach class="bar-light item-input-inset footer-item-input-insert">\n         <label class="item-input-wrapper">\n            <input type="search" placeholder="\u8BF4\u70B9\u4EC0\u4E48\u5427"  maxlength="500" ng-model="eventinfo.comment.content" id="reply-input" ng-blur="eventinfo.clearReply()">\n        </label>\n        <button class="button button-clear" ng-click="eventinfo.doComment()">\n            \u53D1\u5E03\n        </button>\n    </ion-footer-bar>\n</ion-view>');
$templateCache.put('templates/event_like.html','<ion-view title="\u9F13\u52B1">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/event/{{eventlike.eventId}}"></a>\n\t\t<div class="title">\u9F13\u52B1</div>\n\t</ion-header-bar>\n\t<ion-content>\n\t\t<div class="list" >\n\t\t\t<a class="item item-avatar item-icon-right" href="#/user/{{user.user_id}}" ng-repeat="user in eventlike.users">\n\t    \t\t<img ng-src="{{user.user.user_avatar}}" fallback-src="img/default.jpg">\n\t\t      \t<h2>{{user.user.nickname.length>0?user.user.nickname:\'keeper\'+user.user.user_id}}</h2>\n\t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t</a>\n\t\t</div>\t\n\t</ion-content>\n\t\n</ion-view>');
$templateCache.put('templates/event_list.html','<ion-refresher\n        pulling-text="\u4E0B\u62C9\u5237\u65B0..."\n        on-refresh="eventlist.onRefresh()">\n</ion-refresher>\n\n<div class="list event-list" ng-repeat="event in eventlist.events" ng-if="eventlist.events.length>0">\n    <div class="item item-avatar">\n        <img ng-src="{{event.user.user_avatar}}" fallback-src="img/default.jpg" go-state="{state:\'userhome\',params:{userId:event.user_id}}">\n        <h2 go-state="{state:\'userhome\',params:{userId:event.user_id}}">{{event.user.nickname.length>0?event.user.nickname:\'keeper\'+event.user_id}}</h2>\n        <p go-state="{state:\'goalhome\',params:{goalId:event.goal.goal_id}}"><span class="">#{{event.goal.goal_name}}#</span><span class="positive" style="font-size:2em;">{{event.checkin.total_days}}</span>\u5929\n        </p>\n        <span am-time-ago="{{event.create_time*1000}}" am-preprocess="unix" class="time"></span>\n        <i class="icon ion-bookmark positive" style="position:absolute;top:-5px;right:10px;font-size: 20px;" ng-if="event.is_hot==1"></i>\n    </div>\n\n    <div class="item item-body" ng-if="event.checkin.checkin_content||event.checkin.attaches.length>0">\n        <a href="#/event/{{event.event_id}}">\n            <event-content content="{{event.checkin.checkin_content}}"></event-content>\n            <p></p>\n            <img class="full-image"\n                 ng-src="{{eventlist.resUrl+\'images/\'+event.checkin.attaches[0].attach_path+\'/\'+event.checkin.attaches[0].attach_name}}"\n                 ng-if="event.checkin.attaches.length>0">\n        </a>\n    </div>\n    <a class="item item-icon-left checkin-item" href="#/event/{{event.event_id}}" ng-if="event.checkin.items.length>0"\n       ng-repeat="item in event.checkin.items" style="font-size:14px;background-color: #f8f8f8;">\n        <i class="icon ion-android-checkbox-outline" style="font-size:16px;"></i>\n        {{item.item_name}}<span class="pull-right"> {{item.item_value}} {{item.item_unit}}</span>\n    </a>\n\n    <div class="item tabs tabs-secondary tabs-icon-left">\n        <a class="tab-item" href="javascript:void(0);" ng-click="eventlist.doLike(event)">\n            <i class="icon"\n               ng-class="{\'assertive\':event.is_like,\'ion-ios-heart-outline\':!event.is_like,\'ion-ios-heart\':event.is_like}"></i>\n            {{event.like_count}}\n        </a>\n        <a class="tab-item" href="#/event/{{event.event_id}}">\n            <i class="icon ion-ios-chatbubble-outline"></i>\n            {{event.comment_count}}\n        </a>\n        <a class="tab-item" ng-click="eventlist.showMore(event.event_id)">\n            <i class="icon ion-ios-more-outline"></i>\n        </a>\n    </div>\n</div>\n\n<div class="list" ng-if="eventlist.events.length==0">\n    <div class="item text-center">\n            \u6682\u65F6\u8FD8\u6CA1\u6709\u52A8\u6001\n        </div>\n</div>\n\n<ion-infinite-scroll\n        on-infinite="eventlist.onInfinite()"\n        distance="1%">\n    \u663E\u793A\u66F4\u591A\n</ion-infinite-scroll>');
$templateCache.put('templates/event_share.html','<ion-view title="\u5206\u4EAB">\n    <ion-header-bar class="bar-positive" id="header">\n\t\t<go-back></go-back>\n        <div class="title">\u5206\u4EAB</div>\n    </ion-header-bar>\n    <ion-content>\n\n\t\t<div style="background-color:#0c9;background: url(\'img/share_bg.jpg\');padding:20px;" id="content">\n\t\t\t<div class="card" style="background-color: rgba(255,255,255,.4);">\n\n\t\t\t\t<h4 style="color:#fff;padding-top: 10px;" class="text-center">#{{eventshare.event.goal.goal_name}}#</h4>\n\t\t\t\t<h1 style="color:#fff;margin-top:0px;" class="text-center">\u7B2C <span style="font-size: 60px;">{{eventshare.event.checkin.total_days}}</span> \u5929</h1>\n\t\t\t\t<p ng-if="eventshare.event.checkin.items.length>0" ng-repeat="item in eventshare.event.checkin.items" style="margin:20px;color: #fff;">\n\t\t\t\t\t<i class="icon ion-android-checkbox-outline"  style="font-size:16px;"></i>\n\t\t\t\t\t{{item.item_name}}<span class="pull-right"> {{item.item_value}} {{item.item_unit}}</span>\n\t\t\t\t</p>\n\t\t\t\t<p ng-bind-html="(eventshare.event.checkin.checkin_content)" style="margin:20px;color: #fff;">\n\t\t\t\t</p>\n\t\t\t\t<p style="text-align: right;color: #fff;padding-right:20px;">By {{eventshare.event.user.nickname.length>0?eventshare.event.user.nickname:\'keeper\'+eventshare.event.user_id}}</p>\n\t\t\t\t<p style="text-align: right;color: #fff;padding-right:20px;">{{eventshare.event.create_time*1000 | date:\'yyyy-MM-dd\'}}</p>\n\t\t\t\t<p  style="margin:20px;" >\n\t\t\t\t\t<img class="full-image"image-onload="eventshare.onLoad($event)" ng-src="{{eventshare.resUrl+\'images/\'+eventshare.event.checkin.attaches[0].attach_path+\'/\'+eventshare.event.checkin.attaches[0].attach_name}}" ng-if="eventshare.event.checkin.attaches.length>0">\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div class="item item-thumbnail-right" style="border: 0;background-color:transparent;margin:20px;">\n\t\t\t\t<img src="img/code.png">\n\t\t\t\t<h2 style="color: #fff;text-align: right;margin-top:10px;">\u6C34\u6EF4\u6253\u5361</h2>\n\t\t\t\t<p style="margin-top: 10px;color: #fff;text-align: right;">\u957F\u6309\u8BC6\u522B\u4E8C\u7EF4\u7801,\u5F00\u59CB\u6253\u5361</p>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div id="result">\n\n\t\t</div>\n\n\t</ion-content>\n\t<div class="bar bar-footer" style="line-height: 36px;">\n\t\t\u5206\u4EAB\u5230\n\t\t<div class="buttons pull-right">\n\n\t\t\t<div class="button button-clear" ng-click="eventshare.shareToQQ()">\n\t\t\t\t<i class="icon iconfont calm">&#xe602;</i>\n\t\t\t</div>\n\t\t\t<div class="button button-clear" ng-click="eventshare.shareToQZone()">\n\t\t\t\t<i class="icon iconfont energized">&#xe603;</i>\n\t\t\t</div>\n\t\t\t<div class="button button-clear" ng-click="eventshare.shareToWeibo()">\n\t\t\t\t<i class="icon iconfont assertive">&#xe604;</i>\n\t\t\t</div>\n\t\t\t<div class="button button-clear" ng-click="eventshare.shareToWechat(0)">\n\t\t\t\t<i class="icon iconfont balanced">&#xe608;</i>\n\t\t\t</div>\n\t\t\t<div class="button button-clear" ng-click="eventshare.shareToWechat(1)">\n\t\t\t\t<i class="icon iconfont royal">&#xe609;</i>\n\t\t\t</div>\n\t\t\t<div class="button button-clear" ng-click="eventshare.shareToMore()">\n\t\t\t\t<i class="icon iconfont ">&#xe60e;</i>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\n\n</ion-view>\n');
$templateCache.put('templates/explore.html','<ion-view>\n    <ion-header-bar align-title="center" class="bar-positive">\n        <!--<div class="title padding-top">-->\n            <!--<ti-segmented-control on-select="explore.getEvents($index)" style="width: 200px;margin:0 auto;">-->\n                <!--<ti-segmented-control-button class="button-positive" title="\'\u6700\u65B0\'"-->\n                                             <!--selected></ti-segmented-control-button>-->\n                <!--<ti-segmented-control-button class="button-positive" title="\'\u7CBE\u9009\'"></ti-segmented-control-button>-->\n                <!--<ti-segmented-control-button class="button-positive" title="\'\u5173\u6CE8\'"></ti-segmented-control-button>-->\n            <!--</ti-segmented-control>-->\n        <!--</div>-->\n        <div class="title">\n            <ion-tabs class="tabs-top tabs-positive tabs-striped tabs-color-light tabs-header" style="top:0px!important;">\n\n                <ion-tab title="\u7CBE\u9009"  on-select="explore.onTabSelected(\'hot\')">\n                    <!--<event-list events="explore.events" on-refresh="explore.doRefresh()"-->\n                                <!--on-infinite="explore.loadMore()"></event-list>-->\n                </ion-tab>\n\n                <ion-tab title="\u5168\u90E8"  on-select="explore.onTabSelected(\'new\')">\n                    <!--<event-list events="explore.events" on-refresh="explore.doRefresh()"-->\n                                <!--on-infinite="explore.loadMore()"></event-list>-->\n                </ion-tab>\n\n                <ion-tab title="\u5173\u6CE8"  on-select="explore.onTabSelected(\'follow\')">\n                    <!--<event-list events="explore.events" on-refresh="explore.doRefresh()"-->\n                                <!--on-infinite="explore.loadMore()"></event-list>-->\n                </ion-tab>\n            </ion-tabs>\n        </div>\n        <!--<a class="button button-icon button-clear ion-ios-camera-outline" href="#/event/create"></a>-->\n    </ion-header-bar>\n\n    <ion-content class="" style="background-color:#e5e5e5;padding-top: 20px;">\n        <event-list events="explore.events" on-refresh="explore.doRefresh()"\n                    on-infinite="explore.loadMore()"></event-list>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/feedback.html','<ion-view title="\u610F\u89C1\u53CD\u9988">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/setting"></a>\n\t\t<div class="title">\u53CD\u9988</div>\n\t</ion-header-bar>\n\t<ion-content>\n\t\t<div class="list">\n\t\t    <label class="item-input">\n\t\t        <textarea rows="10" cols="50" placeholder="\u4F60\u7684\u60F3\u6CD5\u6216\u8005\u5EFA\u8BAE\u5BF9\u6211\u4EEC\u5F88\u6709\u5E2E\u52A9\uFF0C\u6B22\u8FCE\u968F\u65F6\u63D0\u4EA4..." ng-model="feedback.feedback.content"></textarea>\n\t\t    </label>\n\t\t\t<label class="item item-input">\n\t\t\t\t<button id="upload-image-btn" class="button button-icon icon ion-image" ng-click="feedback.doUpload()"></button>\n\t\t\t</label>\n\t\t\t<div class="item" ng-if="feedback.feedback.attaches.length>0"  ng-repeat="attach in feedback.feedback.attaches">\n\t\t\t\t<img ng-src="{{attach.url}}" class="full-image" src="{{attach.url}}" id="upload-image"/>\n\t\t\t\t<a href="javascript:void(0);" ng-click="feedback.removeAttach()"><p>\u5220\u9664</p></a>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="padding">\n        \t<button class="button button-block button-positive" ng-click="feedback.doFeedback()" ng-disabled="!feedback.feedback.content.length" >\u63D0\u4EA4</button>\n      \t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/find.html','<ion-view title="\u627E\u56DE\u5BC6\u7801">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/login"></a>\n        <div class="title">\u627E\u56DE\u5BC6\u7801</div>\n    </ion-header-bar>\n    <ion-content>\n        <form name="sendForm"  ng-if="!find.isSend">\n            <div class="list list-inset">\n\n                <label class="item item-input">\n                    <input type="email" name="email" ng-model="find.email" placeholder="\u8BF7\u8F93\u5165\u4F60\u7684\u6CE8\u518C\u90AE\u7BB1" required>\n                    <div class="error" ng-if="sendForm.email.$touched && sendForm.email.$dirty && sendForm.email.$invalid">\n                        <small class="error" ng-if="sendForm.email.$error.required">\n                            \u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                        <small class="error" ng-if="sendForm.email.$error.email">\n                            \u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E\n                        </small>\n                    </div>\n                </label>\n            </div>\n\n            <div class="padding">\n                <button ng-click="find.doSend()" ng-disabled="bindForm.$invalid" type="submit" class="button button-block button-positive">\u83B7\u53D6\u9A8C\u8BC1\u7801</button>\n            </div>\n        </form>\n\n        <form name="findForm" ng-if="find.isSend">\n            <div class="padding">\n                \u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u81F3\u4F60\u7684\u90AE\u7BB1:{{find.email}},\u5341\u5206\u949F\u5185\u6709\u6548.\n            </div>\n            <div class="list list-inset">\n\n                <div class="item item-input-inset">\n                    <label class="item-input-wrapper">\n                        <input type="text" name="code" placeholder="\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801" ng-model="find.find.code" required>\n                    </label>\n                    <button class="button button-small" ng-disabled="find.time>0" ng-click="find.doSend()">\n                        {{find.codetime}}\n                    </button>\n                    <div class="error" ng-if="findForm.code.$touched && findForm.code.$dirty ">\n                        <small class="error" ng-if="findForm.code.$error.required">\n                            \u9A8C\u8BC1\u7801\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                    </div>\n                </div>\n\n                <label class="item item-input">\n                    <input type="password" name="password" ng-model="find.find.password" placeholder="\u8BF7\u8F93\u5165\u65B0\u7684\u5BC6\u7801" required>\n                    <div class="error" ng-if="findForm.password.$touched && findForm.password.$dirty && findForm.password.$invalid">\n                        <small class="error" ng-if="findForm.password.$error.required">\n                            \u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                    </div>\n                </label>\n\n            </div>\n\n            <div class="padding">\n                <button ng-click="find.doFind()" ng-disabled="findForm.$invalid" type="submit" class="button button-block button-positive">\u91CD\u7F6E\u5BC6\u7801</button>\n            </div>\n        </form>\n\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/goal_add.html','<ion-view title="\u65B0\u589E\u76EE\u6807">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-clear icon ion-ios-arrow-left" href="#/app/home"></a>\n        <div class="title">\u65B0\u589E\u76EE\u6807</div>\n    </ion-header-bar>\n    <ion-content class="">\n        <form name="goalForm">\n            <div class="list">\n                <div class="item item-divider"></div>\n\n                <label class="item item-input">\n                    <span class="input-label">\u76EE\u6807\u540D\u79F0</span>\n                    <input type="text" name="name" placeholder="\u4F8B\u5982\uFF1A\u8DD1\u6B65" ng-model="goaladd.goal.name" ng-maxlength="100"\n                           required>\n                    <div class="error"\n                         ng-if="goalForm.name.$touched && goalForm.name.$dirty && goalForm.name.$invalid">\n                        <small class="error" ng-if="goalForm.name.$error.required">\n                            \u76EE\u6807\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                        <small class="error"\n                               ng-if="goalForm.name.$error.maxlength">\n                            \u76EE\u6807\u540D\u79F0\u957F\u5EA6\u8FC7\u957F\n                        </small>\n                    </div>\n                </label>\n                <div class="item item-divider"></div>\n                <label class="item item-input">\n                    <span class="input-label">\u76EE\u6807\u5929\u6570</span>\n                    <input type="number" name="days" placeholder="\u8BF7\u8F93\u5165\u6570\u5B57\uFF0C0\u4EE3\u8868\u6BCF\u5929" ng-model="goaladd.goal.days"\n                           max="999" ng-pattern="/^[0-9]{1,4}$/" required>\n                    <div class="error"\n                         ng-if="goalForm.days.$touched && goalForm.days.$dirty && goalForm.days.$invalid">\n                        <small class="error" ng-if="goalForm.days.$error.required">\n                            \u5929\u6570\u4E0D\u5F97\u4E3A\u7A7A\n                        </small>\n                        <small class="error"\n                               ng-if="goalForm.days.$error.pattern">\n                            \u5929\u6570\u5FC5\u987B\u57280-999\u8303\u56F4\u5185\n                        </small>\n                    </div>\n                </label>\n                <label class="item" ng-if="goaladd.goal.days>0">\n                    \u8D77\u6B62\u65E5\u671F\n                    <span class="item-note">\n\t\t\t\t\t{{goaladd.getRange()}}\n    \t\t\t    </span>\n                </label>\n                <label class="item" ng-if="goaladd.goal.days>=0">\n                    \u6D88\u8017\u80FD\u91CF\n                    <span class="item-note assertive">\n\t\t\t\t\t-{{goaladd.goal.days==0?1000:goaladd.goal.days}}\n    \t\t\t    </span>\n                </label>\n                <div class="item item-divider"></div>\n\n                <label class="item item-input">\n                    <span class="input-label">\u76EE\u6807\u4ECB\u7ECD</span>\n                    <textarea placeholder="\u7528\u7B80\u77ED\u7684\u8BDD\u8BED\u63CF\u8FF0\u4F60\u7684\u76EE\u6807(\u53EF\u4E0D\u586B\u5199)" rows="3" ng-model="goaladd.goal.desc"></textarea>\n                </label>\n                <div class="item item-divider"></div>\n\n            </div>\n            <div class="padding">\n                <button class="button button-block button-positive" ng-click="goaladd.doSaveGoal()"\n                        ng-disabled="goalForm.$invalid">\u4FDD\u5B58\n                </button>\n            </div>\n        </form>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/goal_calendar.html','<ion-view title="\u65E5\u5386">\n    <ion-header-bar class="bar-dark">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/goal/{{goalcalendar.goalId}}"></a>\n        <div class="title">\u65E5\u5386</div>\n        <a class="button button-icon button-clear ion-ios-pulse" href="#/goal/{{goalcalendar.goalId}}/data"></a>\n    </ion-header-bar>\n    <ion-content class="">\n        <!--<div class="padding-top">-->\n            <!--<ti-segmented-control on-select="showChart($index)" style="width: 200px;margin:0 auto;">-->\n                <!--<ti-segmented-control-button class="button-positive" title="\'\u5468\'" selected></ti-segmented-control-button>-->\n                <!--<ti-segmented-control-button class="button-positive" title="\'\u6708\'"></ti-segmented-control-button>-->\n                <!--<ti-segmented-control-button class="button-positive" title="\'\u5E74\'"></ti-segmented-control-button>-->\n            <!--</ti-segmented-control>-->\n        <!--</div>-->\n\n        <flex-calendar options="goalcalendar.options" events="goalcalendar.events"></flex-calendar>\n        <div class="list" ng-if="!(goalcalendar.checkin | isEmpty)">\n            <div class="item item-divider">\n                {{goalcalendar.selectedDay}} <span class="right">\u5B8C\u6210\u7B2C <em class="num">{{goalcalendar.checkin.total_days}}</em> \u5929</span>\n            </div>\n\n            <div class="item item-body">\n                <event-content content="{{goalcalendar.checkin.checkin_content}}"></event-content>\n                <p></p>\n                <img class="full-image" ng-src="{{goalcalendar.resUrl+\'images/\'+goalcalendar.checkin.attaches[0].attach_path+\'/\'+goalcalendar.checkin.attaches[0].attach_name}}" ng-if="goalcalendar.checkin.attaches.length>0">\n            </div>\n\n            <div class="item item-icon-left checkin-item" ng-if="goalcalendar.checkin.items.length>0" ng-repeat="item in goalcalendar.checkin.items" style="font-size:14px;background-color: #f8f8f8;">\n                <i class="icon ion-android-checkbox-outline"  style="font-size:16px;"></i>\n                {{item.item_name}}<span class="pull-right"> {{item.item_value}} {{item.item_unit}}</span>\n            </div>\n        </div>\n        <div class="list" ng-if="goalcalendar.checkin | isEmpty">\n            <a class="item">\n                <p>\u65E0\u6253\u5361\u8BB0\u5F55</p>\n            </a>\n        </div>\n    </ion-content>\n</ion-view>\n\n\n\n\n\n');
$templateCache.put('templates/goal_data.html','<ion-view title="\u7EDF\u8BA1">\n\t <ion-header-bar class="bar-positive">\n \t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/goal/{{goalId}}"></a>\n\t\t<div class="title">\u7EDF\u8BA1</div>\n\t</ion-header-bar>\n\t<ion-content class="">\n\t\t<div class="padding-top">\n\t\t\t<ti-segmented-control on-select="goaldata.showChart($index)" style="width: 200px;margin:0 auto;">\n\t\t\t    <ti-segmented-control-button class="button-positive" title="\'\u5468\'" selected></ti-segmented-control-button>\n\t\t\t    <ti-segmented-control-button class="button-positive" title="\'\u6708\'"></ti-segmented-control-button>\n\t\t\t    <ti-segmented-control-button class="button-positive" title="\'\u5E74\'"></ti-segmented-control-button>\n\t\t\t</ti-segmented-control>\n\t\t</div>\n\t\t<div id="c3chart" ng-init="goaldata.showChart(0)"></div>\n\t\t<!-- <c3chart bindto-id="chart1">\n\t\t<chart-column column-id="x"\n          column-values="{{count.x}}"/>\n    \t<chart-column column-id="data1"\n    \t\t\t\tcolumn-name="\u6253\u5361\u6B21\u6570"\n    \t\t\t  column-color="#0c9" \n                  column-values="count.y"\n                  column-type="bar"/>  \n        <chart-axes values-x="x" y="data1"/>\n    \t<chart-axis>\n\t\t    <chart-axis-x axis-position="outer-center"\n\t\t                  axis-type="category">\n\t\t      </chart-axis-x>\n\t\t</chart-axis>\n\t\t</c3chart> -->\n\t\t<div class="list">\n\t\t\t<div class="item item-divider">\n\t\t\t\t\u6570\u636E\u6C47\u603B\n\t\t\t</div>\n\t\t\t<div class="item ">\n\t\t\t\t\u6253\u5361\u5929\u6570: <span class="item-note"><strong class="positive num">{{goaldata.summary.count}}</strong> \u5929</span>\n\t\t\t</div>\n\t\t\t<div class="item" ng-repeat="item in goaldata.summary.items" ng-if="goaldata.summary.items.length>0">\n\t\t\t\t{{item.item_name}}:\n\t\t\t\t<span class="item-note"><strong class="positive num"> {{item.sum}}</strong> {{item.item_unit}}\n</span>\n\t\t\t</div>\n\n\t\t</div>\n    </ion-content>\n</ion-view>\n\n\n\n\n\n');
$templateCache.put('templates/goal_edit.html','<ion-view title="\u7F16\u8F91\u76EE\u6807">\n  \t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-clear icon ion-ios-arrow-left" href="#/app/home"></a>\n\t\t<div class="title">\u7F16\u8F91\u76EE\u6807</div>\n\t</ion-header-bar>\n\t<ion-content class="">\n\t<div class="list">\n\t\t<div class="item item-divider"></div>\n\n\t\t<label class="item item-input">\n\t\t\t<span class="input-label">\u76EE\u6807\u540D\u79F0</span>\n\t\t\t<input type="text" name="name" placeholder="\u4F8B\u5982\uFF1A\u8DD1\u6B65" ng-model="goaledit.goal.goal_name"  ng-maxlength="100" required disabled>\n\t\t\t<div class="error"\n\t\t\t\t ng-if="goalForm.name.$touched && goalForm.name.$dirty && goalForm.name.$invalid">\n\t\t\t\t<small class="error" ng-if="goalForm.name.$error.required">\n\t\t\t\t\t\u76EE\u6807\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\n\t\t\t\t</small>\n\t\t\t\t<small class="error"\n\t\t\t\t\t   ng-if="goalForm.name.$error.maxlength">\n\t\t\t\t\t\u76EE\u6807\u540D\u79F0\u957F\u5EA6\u8FC7\u957F\n\t\t\t\t</small>\n\t\t\t</div>\n\t\t</label>\n\t\t<div class="item item-divider"></div>\n\t\t<label class="item item-input">\n\t\t\t<span class="input-label">\u76EE\u6807\u5929\u6570</span>\n\t\t\t<input type="number" name="days" placeholder="\u8BF7\u8F93\u5165\u6570\u5B57\uFF0C0\u4EE3\u8868\u6BCF\u5929" ng-model="goaledit.goal.pivot.expect_days"\n\t\t\t\t   max="9999" ng-pattern="/^[0-9]{1,4}$/" required>\n\t\t\t<div class="error"\n\t\t\t\t ng-if="goalForm.days.$touched && goalForm.days.$dirty && goalForm.days.$invalid">\n\t\t\t\t<small class="error" ng-if="goalForm.days.$error.required">\n\t\t\t\t\t\u5929\u6570\u4E0D\u5F97\u4E3A\u7A7A\n\t\t\t\t</small>\n\t\t\t\t<small class="error"\n\t\t\t\t\t   ng-if="goalForm.days.$error.pattern">\n\t\t\t\t\t\u5929\u6570\u5FC5\u987B\u57280-9999\u8303\u56F4\u5185\n\t\t\t\t</small>\n\t\t\t</div>\n\t\t</label>\n\t\t<label class="item" ng-if="goaledit.goal.days>0">\n\t\t\t\u8D77\u6B62\u65E5\u671F\n\t\t\t<span class="item-note">\n\t\t\t\t\t{{goaledit.getRange()}}\n    \t\t\t</span>\n\t\t</label>\n\t\t<div class="item item-divider"></div>\n\n\t\t<label class="item item-input">\n\t\t\t<span class="input-label">\u76EE\u6807\u4ECB\u7ECD</span>\n\t\t\t<textarea placeholder="\u7528\u7B80\u77ED\u7684\u8BDD\u8BED\u63CF\u8FF0\u4F60\u7684\u76EE\u6807(\u53EF\u4E0D\u586B\u5199)" rows="3" ng-model="goaledit.goal.pivot.\tgoal_desc"></textarea>\n\t\t</label>\n\t\t<div class="item item-divider"></div>\n\n\t\t<!--   <label class="item item-input item-select">\n\t\t    <div class="input-label">\n\t\t      \u9891\u7387\n\t\t    </div>\n\t\t    <select>\n\t\t      <option>\u6BCF\u5929</option>\n\t\t      <option selected>\u6BCF\u5468</option>\n\t\t      <option>\u6BCF\u6708</option>\n\t\t    </select>\n\t\t  </label> -->\n\t\t<!--<div class="item item-divider" style="line-height:30px;">-->\n\t\t  \t\t<!--\u7EDF\u8BA1\u9879\u76EE(\u975E\u5FC5\u9700)-->\n\t\t  \t\t<!--<i class="right icon ion-ios-plus" style="font-size:28px;" ng-click="goaledit.itemAdd()"></i>-->\n\t\t<!--</div>-->\n\t\t  <!--<div class="item item-button-right" ng-repeat="item in goaledit.goal.items">-->\n\t\t  \t\t<!--{{item.item_name}}: <strong class="positive num">{{item.item_expect}}</strong> {{item.item_unit}}-->\n\t\t  \t\t<!--<div class="buttons">-->\n                    <!--<button class="button button-clear" ng-click="goaledit.doEditItem(item)">-->\n                        <!--<i class="icon ion-edit" ></i>-->\n                    <!--</button>-->\n                    <!--<button class="button button-clear" ng-click="goaledit.doDelItem(item)">-->\n                        <!--<i class="icon ion-trash-a"></i>-->\n                    <!--</button>-->\n                <!--</div>-->\n            <!--</div>-->\n\t\t<!--</div>-->\n\t<div class="padding">\n\t\t<button class="button button-block button-positive" ng-click="goaledit.doSaveGoal()">\u4FDD\u5B58</button>\n\t</div>\n</ion-content>\n</ion-view>');
$templateCache.put('templates/goal_event.html','<ion-view title="\u4E3B\u9875">\n \t<ion-header-bar class="bar-positive">\n \t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/goal/{{goalId}}"></a>\n\t\t<div class="title">\u52A8\u6001</div>\n\t</ion-header-bar>\n<ion-content>\n\t<ion-refresher\n\t    pulling-text="\u4E0B\u62C9\u5237\u65B0..."\n\t    on-refresh="doRefresh()">\n\t</ion-refresher>\n\n\t<div class="list card" ng-if="!events.length">\n      <div class="row">\n        <div class="col"><center>\u6682\u65F6\u8FD8\u6CA1\u6709\u52A8\u6001</center></div>\n      </div>\n    </div>\n\n\t<div class="list card" ng-repeat="event in events" ng-if="events.length>0">\n\t  <a class="item item-avatar item-button-right" href="#/user/{{event.user_id}}">\n\t    <img ng-src="{{event.user_avatar}}" fallback-src="img/default.jpg">\n\t    <h2>{{event.nickname.length > 0?event.nickname:\'keeper\'+event.user_id}}</h2>\n\t    <p><span am-time-ago="{{event.create_time*1000}}" am-preprocess="unix"></span></p>\n\t    <button class="button button-positive button-outline" ng-if="event.event_type==\'USER_CHECKIN\'">\n      \t\t\u7B2C{{event.checkin.total_days}}\u5929\n    \t</button>\n\t  </a>\n\n\t  <div class="item item-body" ng-if="event.event_type==\'USER_CHECKIN\'">\n\t  \t<a href="#/checkin/detail/{{event.checkin.checkin_id}}">\n\t     \t<p>\n\t     \t{{event.checkin.checkin_content}}\n\t     \t</p>\n\t     \t<blockquote ng-if="event.checkin.checkin_remark" ng-bind-html="event.checkin.checkin_remark | parseUrl">\t\t\n     \t\t</blockquote>\n\t   \t</a>\n\n\t   \t <p ng-if="event.checkin.tags.length>0" class="padding-top">\n      \t\t<a href="#/tag/{{tag.tag_id}}" class="positive tag" ng-repeat="tag in event.checkin.tags">#{{tag.tag_name}}#</a>\n    \t</p>\n\t  </div>\n\n\t  <div class="item item-body" ng-if="event.event_type !=\'USER_CHECKIN\'">\n\t    <p>\n\t     \t{{event.event_content}}\n\t    </p>\n\t  </div>\n\n\t  <div class="item tabs tabs-secondary tabs-icon-left" ng-if="event.event_type==\'USER_CHECKIN\'">\n\t    <a class="tab-item"  href="javascript:void(0);" ng-click="doLike(event)">\n\t      <i class="icon" ng-class="{\'assertive\':event.is_like,\'ion-ios-heart-outline\':!event.is_like,\'ion-ios-heart\':event.is_like}"></i>\n\t      {{event.checkin.like_num}}\n\t    </a>\n\t    <a class="tab-item" href="#/checkin/detail/{{event.checkin.checkin_id}}">\n\t      <i class="icon ion-ios-chatbubble-outline"></i>\n\t      {{event.checkin.comment_num}}\n\t    </a>\n\t    <a class="tab-item" ng-click="checkinMore(event.checkin.checkin_id)">\n\t      <i class="icon ion-ios-more-outline"></i>\n\t    </a>\n\t  </div>\n\t</div>\n\n\t <ion-infinite-scroll\n\t\t    on-infinite="loadMore()"\n\t\t    distance="1%">\n\t\t    \u663E\u793A\u66F4\u591A\n\t</ion-infinite-scroll>\n</ion-content>\n</ion-view>');
$templateCache.put('templates/goal_home.html','<ion-view title="{{goalhome.goal.goal_name}}">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon button-clear ion-ios-arrow-back" href="#/app/home"></a>\n        <div class="title">{{goalhome.goal.goal_name}}</div>\n    </ion-header-bar>\n\n    <ion-content>\n\n        <div class="card text-center padding" style="margin-top: 10px;">\n            <p>\u521B\u5EFA\u8005:<a href="#/user/{{goalhome.goal.create_user.user_id}}">{{goalhome.goal.create_user.nickname?goalhome.goal.create_user.nickname:\'keeper\'+goalhome.goal.create_user.user_id}}</a></p>\n            <p><span class="num">{{goalhome.goal.follow_nums}}</span>\u4EBA\u53C2\u52A0</p>\n            <p><button class="button button-positive button-block" ng-if="!goalhome.goal.is_follow" ng-click="goalhome.followGoal()">\u5236\u5B9A\u76EE\u6807</button></p>\n            <p><button class="button button-stable button-block" ng-if="goalhome.goal.is_follow">\u5DF2\u5236\u5B9A</button></p>\n        </div>\n\n        <ti-segmented-control on-select="goalhome.changeIndex($index)" style="width: 200px;margin:0 auto;">\n\t\t\t    <ti-segmented-control-button class="button-positive" title="\'\u52A8\u6001\'" selected></ti-segmented-control-button>\n\t\t\t    <ti-segmented-control-button class="button-positive" title="\'\u6392\u884C\'"></ti-segmented-control-button>\n        </ti-segmented-control>\n\n        <div class="padding-top">\n            <event-list events="goalhome.events" ng-if="goalhome.index==0"></event-list>\n\n            <div class="list" ng-if="goalhome.index==1">\n                <a class="item item-avatar item-icon-right" ng-repeat="user in goalhome.users" href="#/user/{{user.user_id}}">\n                    <img ng-src="{{user.user_avatar}}" fallback-src="img/default.jpg">\n                    <h2>{{user.nickname.length > 0?user.nickname:\'keeper\'+user.user_id}}</h2>\n                    <p>\u5929\u6570\uFF1A{{user.total_days}}</p>\n                    <span class="badge" ng-class="getClass($index + 1)">NO.{{$index + 1}}</span>\n                </a>\n            </div>\n        </div>\n\n    </ion-content>\n\n\n</ion-view>\n\n\n');
$templateCache.put('templates/goal_log.html','<ion-view title="\u65E5\u5FD7">\n \t<ion-header-bar class="bar-positive">\n \t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/app/home"></a>\n\t\t<div class="title">\u65E5\u5FD7</div>\n\t</ion-header-bar>\n\t<ion-content class="padding">\n\t\t<div class="responsive-calendar">\n\t        <div class="controls">\n\t            <a class="pull-left" data-go="prev"><div class="btn btn-icon"><i class="ion-ios-arrow-back positive"></i></div></a>\n\t            <h4><span data-head-year></span> <span data-head-month></span></h4>\n\t            <a class="pull-right" data-go="next"><div class="btn btn-icon"><i class="ion-ios-arrow-forward positive"></i></div></a>\n\t        </div><hr/>\n\t        <div class="day-headers">\n\t          <div class="day header">\u4E00</div>\n\t          <div class="day header">\u4E8C</div>\n\t          <div class="day header">\u4E09</div>\n\t          <div class="day header">\u56DB</div>\n\t          <div class="day header">\u4E94</div>\n\t          <div class="day header">\u516D</div>\n\t          <div class="day header">\u65E5</div>\n\t        </div>\n\t        <div class="days" data-group="days">\n\t          \n\t        </div>\n\t  </div>\n\n\t\t<!-- <div class="timeline">\n\n\t    \t<h2 ng-repeat-start="event in events">Day {{event.checkin.total_days}}</h2>\n\t    \t<ul ng-repeat-end>\n\t\t      <li>\n\t\t        <p>{{event.checkin.checkin_content}}</p>\n\t\t        <time>{{event.checkin.checkin_day}}</time>\n\t\t        <a class="right" style="float:right;" href="#/checkin/detail/{{event.checkin.checkin_id}}">\u8BE6\u60C5>></a>\n\t\t      </li>\n\t\t    </ul>\n\t    \n\t    </div> -->\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/goal_search.html','<ion-view title="\u5168\u90E8\u76EE\u6807">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/app/home"></a>\n\t\t<div class="title">\u5168\u90E8\u76EE\u6807</div>\n\t\t<a class="button button-clear icon ion-android-add" href="#/goal/add"></a>\n\t</ion-header-bar>\n\t<ion-content>\n\t\t<div class="bar bar-header item-input-inset">\n\t\t\t  <div class="item-input-wrapper">\n\t\t\t    <i class="icon ion-search placeholder-icon"></i>\n\t\t\t    <input type="search" placeholder="\u641C\u7D22\u76EE\u6807" ng-model="goalsearch.search.text" ng-change="goalsearch.doSearch()">\n\t\t\t    <i ng-if="goalsearch.search.text.length > 0" ng-click="goalsearch.clearSearch()" class="icon ion-close"></i>\n\t\t\t  </div>\n\t  \t</div>\n\t\t<div class="list">\n\t\t    <a class="item item-icon-right" href="#/goal/{{goal.goal_id}}/home" ng-repeat="goal in goalsearch.goals" ng-if="goalsearch.goals.length>0">\n\t\t\t      \t<h2>{{goal.goal_name}}</h2>\n\t\t\t     \t<p>{{goal.follow_nums}} \u4EBA\u53C2\u4E0E</p>\n\t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t\t<!--<button class="button button-positive button-outline button-small" ng-click="doJoin($event,{{group.group_id}})">-->\n      \t\t\t\t<!--\u52A0\u5165-->\n    \t\t\t<!--</button>-->\n\t\t    </a>\n\n\t\t</div>\n\t\t<div class="padding text-center" ng-if="goalsearch.goals.length==0">\n\t\t\t\t\u8FD8\u6CA1\u6709\u4EBA\u521B\u5EFA\u76EE\u6807 <span style="color:#0c9;font-size: 24px;">{{goalsearch.search.text}}</span>\n\t\t\t\t<br><a href="#/goal/add" class="button button-positive">\u7ACB\u5373\u521B\u5EFA</a>\n\t\t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/goal_setting.html','<ion-view title="\u8BBE\u7F6E">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-clear icon ion-ios-arrow-left" href="#/goal/{{goalsetting.goalId}}"></a>\n        <div class="title">\u8BBE\u7F6E</div>\n    </ion-header-bar>\n    <ion-content class="">\n        <ul class="list">\n\n            <div class="item item-divider" style="line-height:30px;">\n                \u7EDF\u8BA1\u9879\u76EE\n                <i class="right icon ion-ios-plus" style="font-size:28px;" ng-click="goalsetting.itemAdd()"></i>\n            </div>\n\n            <div class="item item-button-right" ng-repeat="item in goalsetting.setting.items">\n                {{item.item_name}}: <strong class="positive num">{{item.item_expect}}</strong> {{item.item_unit}}\n                <div class="buttons">\n                    <button class="button button-clear" ng-click="goalsetting.doEditItem(item)">\n                        <i class="icon ion-edit"></i>\n                    </button>\n                    <button class="button button-clear" ng-click="goalsetting.doDelItem(item)">\n                        <i class="icon ion-trash-a"></i>\n                    </button>\n                </div>\n            </div>\n\n            <div class="item item-divider"></div>\n            <li class="item item-toggle">\n                \u662F\u5426\u516C\u5F00\n                <label class="toggle toggle-positive">\n                    <input type="checkbox" ng-checked="goalsetting.setting.is_public==1"\n                           ng-model="goalsetting.setting.is_public">\n                    <div class="track">\n                        <div class="handle"></div>\n                    </div>\n                </label>\n            </li>\n\n            <div class="item item-divider"></div>\n            <li class="item item-toggle">\n                \u5F00\u542F\u63D0\u9192\n                <label class="toggle toggle-positive">\n                    <input type="checkbox" ng-model="goalsetting.setting.is_push">\n                    <div class="track">\n                        <div class="handle"></div>\n                    </div>\n                </label>\n            </li>\n            <ionic-timepicker input-obj="goalsetting.timePickerObject" ng-if="goalsetting.setting.is_push==1">\n\n                <li class="item item-icon-right">\n                    \u63D0\u9192\u65F6\u95F4\n                    <span class="pull-right">{{goalsetting.setting.remind_time?goalsetting.setting.remind_time:\'\u65E0\'}}</span>\n                    <i class="icon ion-ios-arrow-right"></i>\n                </li>\n            </ionic-timepicker>\n\n            <div class="item item-divider"></div>\n\n        </ul>\n        <div class="padding">\n            <button class="button button-block button-positive" ng-click="goalsetting.doSaveSetting()">\u4FDD\u5B58\u8BBE\u7F6E</button>\n\n            <button class="button button-block button-outline button-assertive" ng-click="goalsetting.delGoal()">\u5220\u9664\u9879\u76EE\n            </button>\n        </div>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/goal_top.html','<ion-view title="\u76EE\u6807\u6392\u540D">\n\t <ion-header-bar class="bar-positive">\n \t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/goal/{{goalId}}"></a>\n\t\t<div class="title">\u76EE\u6807\u6392\u540D</div>\n\t</ion-header-bar>\n\t<ion-content class="">\n\t\t<div class="list padding-top">\t\n\t\t\t<a class="item item-thumbnail-left item-icon-right" ng-repeat="user in users" href="#/user/{{user.user_id}}">\n\t\t        \t<img ng-src="{{user.user_avatar}}" fallback-src="img/default.jpg">\n\t\t        \t<h2>{{user.nickname.length > 0?user.nickname:\'keeper\'+user.user_id}}</h2>\n\t\t        \t<p>\u6B63\u80FD\u91CF\uFF1A{{user.energy}}</p>\n\t\t        \t<p>\u6253\u5361\u5929\u6570\uFF1A{{user.total_days}}</p>\n\t\t        \t<p>\u5F00\u59CB\u65F6\u95F4\uFF1A{{user.start_time*1000 | date:"yyyy/MM/dd"}}</p>\n\t\t          <span class="badge" ng-class="getClass({{$index + 1}})">No.{{$index + 1}}</span>\n\t\t      </a>\n\t\t </div>\n\t\t <ion-infinite-scroll\n\t\t    on-infinite="loadMore()"\n\t\t    distance="1%">\n\t\t    \u663E\u793A\u66F4\u591A\n\t\t</ion-infinite-scroll>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/goal_view.html','<ion-view title="{{goalview.goal.goal_name}}">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon button-clear ion-ios-arrow-back" href="#/app/home"></a>\n        <div class="title">{{goalview.goal.goal_name}}</div>\n        <a class="button button-icon button-clear ion-ios-more" ng-click="goalview.openPopover($event)"></a>\n    </ion-header-bar>\n\n    <ion-content>\n        <ion-refresher\n                pulling-text="\u4E0B\u62C9\u5237\u65B0..."\n                on-refresh="goalview.getGoal()">\n        </ion-refresher>\n        <div class="text-center" style="margin-top: 10px;">\n            <p><span class="badge badge-balanced" ng-if="goalview.goal.pivot.status == 0">\u8FDB\u884C\u4E2D</span></p>\n            <p><span class="badge badge-assertive" ng-if="goalview.goal.pivot.status == 1">\u5DF2\u7ED3\u675F</span></p>\n            <p style="color:#bbb;">\u5F00\u59CB\u4E8E\uFF1A{{goalview.goal.pivot.start_date}}\uFF0C\u7ED3\u675F\u4E8E\uFF1A{{goalview.goal.pivot.end_date?goalview.goal.pivot.end_date:\'\u672A\u77E5\'}}</p>\n        </div>\n        <div class="row" style="margin:10px auto;">\n            <div class="progress-wrapper" ng-click="goalview.goCheckin()">\n                <div class="progress ng-cloak">\n                    <i class="icon ion-checkmark-round" style="font-size: 120px;" ng-style="{color:goalview.goal.pivot.is_today_checkin?\'#1abc9c\':\'#bbb\'}"></i>\n                </div>\n                <round-progress\n                        max="goalview.goal.pivot.expect_days>0?goalview.goal.pivot.expect_days:999"\n                        current="goalview.goal.pivot.total_days"\n                        color="#1abc9c"\n                        bgcolor="#eaeaea"\n                        radius="100"\n                        stroke="20"\n                        semi="false"\n                        rounded="true"\n                        clockwise="false"\n                        responsive="false"\n                        duration="800"\n                        animation="easeInOutQuart"\n                        animation-delay="0">\n                </round-progress>\n            </div>\n        </div>\n\n        <div class="row center">\n            <div class="col card">\n                <strong class="num">{{goalview.goal.pivot.expect_days}}</strong>\n                <br>\u76EE\u6807\u5929\u6570\n            </div>\n            <div class="col card"><strong class="num">{{goalview.goal.pivot.total_days}}</strong><br>\u5B8C\u6210\u5929\u6570</div>\n            <div class="col card"><strong class="num">{{goalview.goal.pivot.series_days}}</strong><br>\u8FDE\u7EED\u5929\u6570\n            </div>\n        </div>\n\n        <div class="card" style="margin-top: 0px;">\n            <div class="row">\n                <div class="col text-left"><span>\u6700\u8FD1\u6253\u5361</span></div>\n                <div class="col text-right"><a href="#/goal/{{goalview.goal.goal_id}}/calendar">\u8BE6\u7EC6>></a></div>\n            </div>\n            <data-date-slider-picker on-select-date="goalview.setDate" total-days="30" date-select-var="goalview.today"\n                                     date-events="goalview.events">\n            </data-date-slider-picker>\n        </div>\n\n        <div class="list" ng-if="!(goalview.checkin | isEmpty)">\n\n            <div class="item item-divider">\n                {{goalview.selectedDay}} <span class="right">\u5B8C\u6210\u7B2C <em class="num">{{goalview.checkin.total_days}}</em> \u5929</span>\n            </div>\n\n            <div class="item item-body">\n                <event-content content="{{goalview.checkin.checkin_content}}"></event-content>\n                <p></p>\n                <img class="full-image" ng-src="{{goalview.resUrl+\'images/\'+goalview.checkin.attaches[0].attach_path+\'/\'+goalview.checkin.attaches[0].attach_name}}" ng-if="goalview.checkin.attaches.length>0">\n            </div>\n\n            <div class="item item-icon-left checkin-item" ng-if="goalview.checkin.items.length>0" ng-repeat="item in goalview.checkin.items" style="font-size:14px;background-color: #f8f8f8;">\n                <i class="icon ion-android-checkbox-outline"  style="font-size:16px;"></i>\n                {{item.item_name}}<span class="pull-right"> {{item.item_value}} {{item.item_unit}}</span>\n            </div>\n\n        </div>\n        <div class="list" ng-if="goalview.checkin | isEmpty">\n            <div class="item item-divider">\n                {{goalview.selectedDay}}\n            </div>\n\n            <a class="item">\n                <p>\u65E0\u6253\u5361\u8BB0\u5F55</p>\n            </a>\n\n        </div>\n\n    </ion-content>\n\n\n</ion-view>\n\n\n');
$templateCache.put('templates/goal_view_menu.html','<ion-popover-view style="width:100px;" class="fit">\n\t<ion-content>\n\t\t<div class="list">\n\t\t\t<a class="item"  ng-click="goalview.goHome()">\n\t\t\t\t<i class="ion ion-ios-home"></i>\n\t\t\t\t\u4E3B\u9875\n\t    \t</a>\n\t     \t<!--<a class="item" ng-click="goalview.goSetting()">-->\n\t\t\t\t<!--\u5206\u4EAB-->\n\t    \t<!--</a>-->\n\t    \t<!--<a class="item" ng-click="hello()">\u9080\u8BF7</a>-->\n\t\t\t<a class="item" ng-click="goalview.goSetting()">\n\t\t\t\t<i class="ion ion-gear-b"></i>\n\n\t\t\t\t\u8BBE\u7F6E</a>\n\t\t</div>\n\t</ion-content>\n</ion-popover-view>\n');
$templateCache.put('templates/good_view.html','<ion-view title="\u5546\u54C1\u8BE6\u60C5">\n    <ion-header-bar class="bar-positive" align-title="center">\n        <go-back></go-back>\n        <div class="title">\u5546\u54C1\u8BE6\u60C5</div>\n    </ion-header-bar>\n    <ion-content>\n        <!--<ion-slide-box does-continue="true" auto-play="true" slide-interval="4000">-->\n            <!--<ion-slide >-->\n                <!--<div class="box">-->\n                    <!--<img class="full-image" ng-src="{{goodview.good.main_image}}" style="height:auto;min-height:200px;">-->\n                <!--</div>-->\n            <!--</ion-slide>-->\n        <!--</ion-slide-box>-->\n        <div class="row">\n            <img class="full-image" ng-src="{{goodview.good.main_image}}" style="height:auto;min-height:200px;">\n        </div>\n\n        <div class="list">\n            <div class="item">\n                \u539F\u4EF7\n                <span class="item-note">\n                    <del>{{goodview.good.original_price}}</del>\n                </span>\n            </div>\n            <div class="item">\n                \u73B0\u4EF7\n                <span class="item-note">\n                    {{goodview.good.sell_price}}\n                </span>\n            </div>\n            <div class="item">\n                \u6D88\u8017\u80FD\u91CF\u5E01\n                <span class="item-note">\n                    {{goodview.good.energy_price}}\n                </span>\n            </div>\n            <div class="item">\n                \u90AE\u8D39\n                <span class="item-note">\n                    {{goodview.good.postage}}\n                </span>\n            </div>\n            <div class="item">\n                \u5E93\u5B58\u6570\u91CF\n                <span class="item-note">\n                    {{goodview.good.stock_count}}\n                </span>\n            </div>\n            <div class="item">\n                \u5151\u6362\u4EBA\u6570\n                <span class="item-note">\n                    {{goodview.good.sell_count}}\n                </span>\n            </div>\n        </div>\n\n        <div class="item item-divider"></div>\n\n        <div class="row" ng-bind-html="goodview.good.content">\n\n        </div>\n\n    </ion-content>\n    <div class="bar bar-footer bar-stable" style="height:64px;">\n        <button class="button button-block button-positive">\u7ACB\u5373\u5151\u6362</button>\n    </div>\n</ion-view>');
$templateCache.put('templates/home.html','<ion-view title="\u76EE\u6807">\n    <ion-header-bar class="bar-positive" align-title="center">\n        <div class="buttons" side="right">\n            <button class="button button-icon button-clear ion-navicon" ng-click="home.showReorder()">\n            </button>\n        </div>\n        <div class="title">\u76EE\u6807</div>\n        <div class="buttons" side="right">\n            <a class="button button-icon button-clear ion-ios-search-strong" href="#/goal/search"></a>\n        </div>\n    </ion-header-bar>\n    <ion-content class="" ng-init="home.getGoals()">\n        <ion-refresher\n                pulling-text="\u4E0B\u62C9\u5237\u65B0..."\n                on-refresh="home.doRefresh()">\n        </ion-refresher>\n\n        <div ng-if="home.processed_goals.length == 0" class="padding">\n            <center>\u4F60\u8FD8\u6CA1\u6709\u8BBE\u5B9A\u76EE\u6807\uFF0C<br>\u70B9\u51FB\u53F3\u4FA7"+"\u53F7\u7ED9\u81EA\u5DF1\u5236\u5B9A\u4E00\u4E2A\u76EE\u6807\u5427\u3002</center>\n        </div>\n        <ion-list ng-if="home.processed_goals.length > 0" show-reorder="home.isReorder"\n                  class="left-recorder-button">\n            <div class="item item-divider" style="letter-space:0.2em;">\u8FDB\u884C\u4E2D({{home.processed_goals.length}})</div>\n            <ion-item class="item home-item" ng-repeat="goal in home.processed_goals">\n                <div class="item-checkbox" go-state="{state:\'goalview\',params:{goalId:goal.goal_id}}">\n                    <label class="checkbox checkbox-positive" ng-if="goal.pivot.is_today_checkin">\n                        <input type="checkbox" checked="checked">\n                    </label>\n                    <label class="checkbox" ng-if="!goal.pivot.is_today_checkin">\n                        <input type="checkbox">\n                    </label>\n                    <h2 class="input-label">\n                        {{goal.goal_name}}\n                    </h2>\n                    <span class="badge" ng-class="home.checkStatus(goal.pivot.last_checkin_time)">{{goal.pivot.total_days}}/{{goal.pivot.expect_days>0?goal.pivot.expect_days:999}}</span>\n                </div>\n                <ion-option-button class="button-positive button-clear ion-checkmark"\n                                   ng-click="home.checkinGoal(goal)">\n                </ion-option-button>\n                <ion-option-button class="button-assertive button-clear ion-trash-a"\n                                   ng-click="home.delGoal(goal,$index)">\n                </ion-option-button>\n                <ion-reorder-button class="ion-navicon" on-reorder="home.reOrderGoal(goal, $fromIndex, $toIndex)">\n                </ion-reorder-button>\n            </ion-item>\n            </ion-list>\n            <ion-list ng-if="home.finished_goals.length > 0" >\n                <div class="item item-divider" style="letter-space:0.2em;" ng-click="home.isFinishGroupShow = !home.isFinishGroupShow"\n                >\u5DF2\u8FC7\u671F({{home.finished_goals.length}})<i class="icon right" ng-class="home.isFinishGroupShow? \'ion-ios-arrow-up\' : \'ion-ios-arrow-down\'"></i></div>\n                <ion-item href="#/goal/{{goal.goal_id}}" ng-repeat="goal in home.finished_goals" ng-if="home.isFinishGroupShow">\n                    <div class="item-checkbox">\n                        <label class="checkbox checkbox-light">\n                            <input type="checkbox" checked>\n                        </label>\n                        <h2 class="input-label">\n                            {{goal.goal_name}}\n                        </h2>\n                        <span class="badge badge-stable">{{goal.pivot.total_days}}/{{goal.pivot.expect_days>0?goal.pivot.expect_days:999}}</span>\n                    </div>\n                    <ion-option-button class="button-assertive button-clear ion-trash-a"\n                                       ng-click="home.delGoal(goal,$index)">\n                    </ion-option-button>\n                </ion-item>\n            </ion-list>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/init.html','<ion-view class="" id="init-view">\n\t<ion-slide-box>\n\t\t<ion-slide class="bg-blue">\n\t\t\t<div class="intro-img">\n\t\t\t\t<img src="img/intro-1.png" width="300">\n\t\t\t</div>\n\t\t\t<h3>\u6253\u5361\u5206\u4EAB</h3>\n\t\t\t<p>\n\t\t\t\t\u65E5\u5FD7\u5C55\u73B0\uFF0C\u4F20\u64AD\u6B63\u80FD\u91CF\u4E8E\u793E\u533A\n\t\t\t</p>\n\t\t</ion-slide>\n\t\t<ion-slide class="bg-red">\n\t\t\t<div class="intro-img">\n\t\t\t\t<img src="img/intro-2.png" width="300">\n\t\t\t</div>\n\t\t\t<h3>\u65B0\u589E\u8BDD\u9898</h3>\n\t\t\t<p>\n\t\t\t\t\u805A\u7126\u70ED\u70B9\uFF0C\u627E\u51FA\u5FD7\u540C\u9053\u5408\u7684\u5C0F\u4F19\u4F34\n\t\t\t</p>\n\t\t</ion-slide>\n\t\t<ion-slide class="bg-pink">\n\t\t\t<div class="intro-img">\n\t\t\t\t<img src="img/intro-3.png" width="300">\n\t\t\t</div>\n\t\t\t<h3>\u66F4\u591A\u529F\u80FD</h3>\n\t\t\t<p>\n\t\t\t\t\u4E0D\u65AD\u6539\u8FDB\u548C\u4F18\u5316\uFF0C\u656C\u8BF7\u671F\u5F85\n\t\t\t</p>\n\t\t\t<button class="button button-light button-outline" ng-click="init.startApp()">\u7ACB\u5373\u4F53\u9A8C</button>\n\t\t</ion-slide>\n\t</ion-slide-box>\n</ion-view>');
$templateCache.put('templates/item_add_modal.html','<ion-modal-view title="\u65B0\u589E\u9879\u76EE">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-clear icon ion-android-close" ng-click="itemadd.closeModal()"></a>\n\t\t<div class="title">\u65B0\u589E\u9879\u76EE</div>\n\t</ion-header-bar>\n<ion-content class="">\n\t<div class="list">\n\t\t<label class="item item-input">\n\t\t    <span class="input-label">\u540D\u79F0</span>\n\t\t    <input type="text" placeholder="\u4F8B\u5982\uFF1A\u65F6\u95F4" ng-model="itemadd.item.item_name">\n\t\t  </label>\n\t\t  <label class="item item-input">\n\t\t    <span class="input-label">\u5355\u4F4D</span>\n\t\t    <input type="text" placeholder="\u4F8B\u5982\uFF1A\u5206\u949F" ng-model="itemadd.item.item_unit">\n\t\t  </label>\n\t\t   <label class="item item-input">\n\t\t    <span class="input-label">\u9884\u671F</span>\n\t\t    <input type="text" placeholder="\u521D\u59CB\u8BBE\u5B9A" ng-model="itemadd.item.item_expect">\n\t\t  </label>\n\t</div>\n\t<div class="padding">\n\t\t<button class="button button-block button-positive" ng-click="itemadd.doSaveItem()">\u6DFB\u52A0</button>\n\t</div>\n</ion-content>\n</ion-modal-view>');
$templateCache.put('templates/login.html','<ion-view title="\u767B\u9646" id="test">\n    <ion-content>\n        <div id="logo">\n            <div class="pulse1"></div>\n            <div class="pulse2"></div>\n            <div class="profilepicture"></div>\n        </div>\n        <form name="loginForm">\n            <div class="list list-inset login">\n                <label class="item item-input">\n                    <i class="icon ion-ios-email-outline placeholder-icon"></i>\n                    <input type="email" name="email" ng-model="login.user.email" placeholder="\u90AE\u7BB1" required>\n                    <div class="error"\n                         ng-if="loginForm.email.$touched && loginForm.email.$dirty && loginForm.email.$invalid">\n                        <small class="error" ng-if="loginForm.email.$error.required">\n                            \u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                        <small class="error" ng-if="loginForm.email.$error.email">\n                            \u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E\n                        </small>\n                    </div>\n                </label>\n\n                <label class="item item-input">\n                    <i class="icon ion-ios-locked-outline placeholder-icon"></i>\n\n                    <input type="password" name="password" ng-model="login.user.password" placeholder="\u5BC6\u7801" required\n                           ng-minlength="6" ng-maxlength="20">\n                    <div class="error"\n                         ng-if="loginForm.password.$touched && loginForm.password.$dirty && loginForm.password.$invalid">\n                        <small class="error" ng-if="loginForm.password.$error.required">\n                            \u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                        <small class="error"\n                               ng-if="loginForm.password.$error.minlength || regForm.password.$error.maxlength">\n                            \u8BF7\u8F93\u51656-20\u4F4D\u5BC6\u7801\n                        </small>\n                    </div>\n                </label>\n\n            </div>\n            <div class="padding">\n                <button ng-click="login.doLogin()"\n                        ng-disabled="(loginForm.email.$touched||loginForm.password.$touched)&&loginForm.$invalid"\n                        type="submit"\n                        class="button button-block button-light">\u767B\u9646\n                </button>\n            </div>\n            <div class="padding">\n                <div class="row">\n                    <div class="col text-left"><a href="#/find" style="color:#fff;">\u5FD8\u8BB0\u5BC6\u7801?</a></div>\n                    <div class="col text-right"><a href="#/register" style="color:#fff;">\u7ACB\u5373\u6CE8\u518C</a></div>\n                </div>\n            </div>\n            <div class="padding login-more" ng-if="login.isQQInstalled||login.isWeiboInstalled||login.isXiaomiChannel">\n            <p class="title">\u7B2C\u4E09\u65B9\u5E10\u53F7\u767B\u5F55</p>\n        </div>\n            <div class="padding login-toolbar text-center" ng-if-end>\n                <i class="iconfont light" ng-if="login.isQQInstalled" ng-click="login.doQQLogin()">&#xe602;</i>\n                <!--<i class="iconfont balanced" ng-click="doWechatLogin()">&#xe611;</i>-->\n                <i class="iconfont light" ng-if="login.isWeiboInstalled" ng-click="login.doWeiboLogin()">\n                    &#xe607;</i>\n                <i class="iconfont light" ng-if="login.isXiaomiChannel" ng-click="login.doXiaomiLogin()">\n                    &#xe64f;</i>\n            </div>\n        </form>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/mall.html','<ion-view title="\u80FD\u91CF\u5546\u57CE">\n    <ion-header-bar class="bar-positive" align-title="center">\n        <go-back></go-back>\n        <div class="title">\u80FD\u91CF\u5546\u57CE</div>\n    </ion-header-bar>\n    <ion-content>\n        <a class="item item-divider">\u70ED\u95E8\u5151\u6362</a>\n        <div class="list card" collection-repeat="good in mall.goods" item-width="50%" item-height="300px">\n            <a class="item item-body" href="#/good/{{good.id}}">\n                <img ng-src="{{good.main_image}}" class="full-image" style="height:auto;">\n                <h2>{{good.title}}</h2>\n                <p><strong>\uFFE5{{good.sell_price}}&nbsp;</strong> +<span class="positive">{{good.energy_price}}</span> </p>\n            </a>\n        </div>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/message.html','<ion-view title="\u6D88\u606F">\n\t\t<ion-header-bar class="bar-positive">\n\t\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/app/home"></a>\n\t\t\t<div class="title">\u6D88\u606F</div>\n\t\t</ion-header-bar>\n\t<ion-content>\n\t\t<div class="list" id="message-group">\n\t\t  <a class="item item-icon-left item-icon-right" href="#/message/comment">\n\t\t    <i class="icon ion-chatbox-working"></i>\n\t\t    \u8BC4\u8BBA\n\t\t    <span class="badge badge-assertive" ng-if="message.count.comment_count>0">{{message.count.comment_count}}</span>\n\t\t    <i class="icon ion-ios-arrow-right"></i>\n\t\t  </a>\n\n\t\t  <a class="item item-icon-left item-icon-right" href="#/message/at">\n\t\t    <i class="icon ion-at"></i>\n\t\t    @\n\t\t   <span class="badge badge-assertive" ng-if="message.count.at_count>0">{{message.count.at_count}}</span>\n\t\t    <i class="icon ion-ios-arrow-right"></i>\n\t\t  </a>\n\n\t\t  <a class="item item-icon-left item-icon-right" href="#/message/like">\n\t\t    <i class="icon ion-ios-heart"></i>\n\t\t    \u9F13\u52B1\u548C\u8D5E\n\t\t    <span class="badge badge-assertive" ng-if="message.count.like_count>0">{{message.count.like_count}}</span>\n\t\t    <i class="icon ion-ios-arrow-right"></i>\n\t\t  </a>\n\n\t\t  <a class="item item-icon-left item-icon-right" href="#/message/fan">\n\t\t    <i class="icon ion-ios-person"></i>\n\t\t    \u7C89\u4E1D\n\t\t    <span class="badge badge-assertive" ng-if="message.count.fan_count>0">{{message.count.fan_count}}</span>\n\t\t    <i class="icon ion-ios-arrow-right"></i>\n\t\t  </a>\n\n\t\t   <a class="item item-icon-left item-icon-right" href="#/message/notice\t">\n\t\t    <i class="icon ion-ios-bell"></i>\n\t\t    \u901A\u77E5\n\t\t    <span class="badge badge-assertive" ng-if="message.count.notice_count>0">{{message.count.notice_count}}</span>\n\t\t    <i class="icon ion-ios-arrow-right"></i>\n\t\t  </a>\n\n\t\t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/message_comment.html','<ion-view title="\u8BC4\u8BBA">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/message"></a>\n        <div class="title">\u8BC4\u8BBA</div>\n    </ion-header-bar>\n    <ion-content>\n\n        <div class="list" ng-if="messagecomment.messages.length>0">\n            <a class="item item-avatar" href="#/event/{{message.event_id}}" ng-repeat="message in messagecomment.messages">\n                <img ng-src="{{message.user_avatar}}" fallback-src="img/default.jpg">\n                <h2>{{message.nickname}}  \u8BC4\u8BBA\u4E86\u4F60\u7684\u6253\u5361</h2>\n                <p><span am-time-ago="{{message.create_time*1000}}" am-preprocess="unix"></span></p>\n            </a>\n        </div>\n        <div class="list" ng-if="messages.length == 0">\n            <a class="item item-title">\n                <h2>\u522B\u6025\uFF0C\u7231\u4E0E\u9F13\u52B1\u603B\u4F1A\u6709\u7684\u3002\u3002</h2>\n            </a>\n        </div>\n\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/message_fan.html','<ion-view title="\u7C89\u4E1D" hide-nav-bar="true">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/message"></a>\n        <div class="title">\u7C89\u4E1D</div>\n    </ion-header-bar>\n    <ion-content>\n\n        <div class="list" ng-if="messagefan.messages.length>0">\n            <a class="item item-avatar" href="#/event/{{message.event_id}}" ng-repeat="message in messagefan.messages">\n                <img ng-src="{{message.user_avatar}}" fallback-src="img/default.jpg">\n                <h2>{{message.nickname}}  \u5173\u6CE8\u4E86\u4F60</h2>\n                <p><span am-time-ago="{{message.create_time*1000}}" am-preprocess="unix"></span></p>\n            </a>\n        </div>\n        <div class="list" ng-if="messagefan.messages.length == 0">\n            <a class="item item-title">\n                <h2>\u5148\u5173\u6CE8\u522B\u4EBA\u53EF\u80FD\u4F1A\u8D62\u5F97\u66F4\u591A\u5173\u6CE8</h2>\n            </a>\n        </div>\n\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/message_like.html','<ion-view title="\u8D5E" hide-nav-bar="true">\n\t\t<ion-header-bar class="bar-positive">\n\t\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/message"></a>\n\t\t\t<div class="title">\u9F13\u52B1</div>\n\t\t</ion-header-bar>\n\t<ion-content>\n\t\n\t\t<div class="list" ng-if="messagelike.messages.length>0">\n\t\t    <a class="item item-avatar" href="#/event/{{message.event_id}}" ng-repeat="message in messagelike.messages">\n\t\t      <img ng-src="{{message.user_avatar}}" fallback-src="img/default.jpg">\n\t\t      <h2>{{message.nickname}}  \u8D5E\u4E86\u4F60\u7684\u6253\u5361</h2>\n\t\t      <p><span am-time-ago="{{message.create_time*1000}}" am-preprocess="unix"></span></p>\n\t\t    </a>\n\t\t</div>\n\t\t<div class="list" ng-if="messagelike.messages.length == 0">\n\t\t    <a class="item item-title">\n\t\t      <h2>\u522B\u6025\uFF0C\u7231\u4E0E\u9F13\u52B1\u603B\u4F1A\u6709\u7684\u3002\u3002</h2>\n\t\t    </a>\n\t\t</div>\n\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/message_notice.html','<ion-view title="\u901A\u77E5" hide-nav-bar="true">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/message"></a>\n        <div class="title">\u901A\u77E5</div>\n    </ion-header-bar>\n    <ion-content>\n\n        <div class="list" ng-if="messagenotice.messages.length>0">\n\n            <div class="card" ng-repeat="message in messagenotice.messages">\n                <div class="item">\n                    {{message.title}}\n                    <span am-time-ago="{{message.create_time*1000}}" am-preprocess="unix" class="item-note"></span>\n                </div>\n\n                <div class="item item-body">\n                    <p ng-bind-html="message.content">\n                    </p>\n                </div>\n            </div>\n        </div>\n        <div class="list" ng-if="messagenotice.messages.length == 0">\n            <a class="item item-title">\n                <h2>\u6682\u65F6\u8FD8\u672A\u6536\u5230</h2>\n            </a>\n        </div>\n\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/my.html','<ion-view title="\u6211">\n\t <ion-header-bar class="bar-positive" align-title="center">\n        <div class="title">\u6211</div>\n    </ion-header-bar>\n<ion-content>\n\t<div class="list">\n      \t<a class="item item-thumbnail-left item-icon-right" href="#/user/{{my.user.user_id}}">\n        \t<img ng-src="{{my.user.user_avatar}}" class="avatar">\n        \t<h2>{{my.user.nickname.length>0?my.user.nickname:\'keeper\'+my.user.user_id}}</h2>\n        \t<button class="button button-clear button-small icon-left ion-compose" ui-sref="profile">\u7F16\u8F91\u8D44\u6599</button>\n        \t<i class="icon ion-ios-arrow-right"></i>\n       \t</a>\n\t  \t\n\t \t<!--<a class="item item-divider"></a>-->\n\t\t<!--<a class="item item-icon-left" href="#/user/{{my.user.user_id}}/level">-->\n\t\t \t<!--<i class="icon ion-arrow-graph-up-right"></i>-->\n\t    \t<!--\u6253\u5361\u7B49\u7EA7-->\n\t  \t<!--</a>-->\n\n\t \t<a class="item item-divider"></a>\n\t  \t<a class="item item-icon-left" href="#/message">\n\t\t  \t<i class="icon ion-ios-email"></i>\n\t\t    \u6D88\u606F\n\t\t    <span class="badge badge-assertive" ng-if="my.new_messages_count > 0">{{my.new_messages_count}}</span>\n\t  \t</a>\n\t\t<a class="item item-divider"></a>\n\t  \t<a class="item item-icon-left" href="#/setting">\n\t  \t  \t<i class="icon ion-gear-b"></i>\n\t    \t\u8BBE\u7F6E\n\t  \t</a>\n\t</div>\n\t<div class="padding" >\n\t  \t  <button class="button button-outline button-block button-assertive" ng-click="my.doLogout()">\u9000\u51FA\u767B\u5F55</button>\n\t</div>\n</ion-content>\n</ion-view>');
$templateCache.put('templates/order.html','<ion-view title="\u8BA2\u5355" hide-nav-bar="true">\n\t<div class="tabs-top tabs-striped tabs-color-assertive" id="order-tab">\n\t\t    <div class="tabs">\n\t\t      \t<a class="tab-item" ng-click="getOrders(\'all\')" ng-class="{\'active\':currentIndex==\'all\'}">\n\t\t        \u5168\u90E8\u8BA2\u5355\n\t\t      </a>\n\t\t      <a class="tab-item" ng-click="getOrders(1)" ng-class="{\'active\':currentIndex==1}">\n\t\t        \u5DF2\u652F\u4ED8\n\t\t      </a>\n\t\t      <a class="tab-item" ng-click="getOrders(0)" ng-class="{\'active\':currentIndex==0}">\n\t\t        \u672A\u4ED8\u6B3E\n\t\t      </a>\n\t\t    </div>\n\t\t</div>\n\t<ion-content>\n  \t\t<div class="list padding-top has-header">\n  \t\t\t<div class="item item-divider"\n\t\t        ng-repeat-start="order in orders">\n\t\t        {{order.create_time*1000 | date:"yyyy-MM-dd HH:mm:ss"}}\n\t\t    </div>\n\t\t   \t<a class="item item-thumbnail-left" href="#/app/order?orderId={{order.order_id}}">\n  \t\t\t\t<img ng-src="{{order.good_image}}">\n\t\t\t    <h2>{{order.good_title}}</h2>\n\t\t\t    <p>\u6570\u91CF\uFF1A{{order.order_num}}</p>\n\t\t\t    <span class="right"><span class="assertive">\uFFE5 {{order.tuan_price}}</span>/\u4EF6</span>\n  \t\t\t</a>\n  \t\t\t<div class="item">\n  \t\t\t\t<p>\u5171 {{order.order_num}} \u4EF6\u5546\u54C1\uFF0C\u514D\u8FD0\u8D39<span class="right">\u5B9E\u4ED8\uFF1A<span class="assertive">\uFFE5{{order.order_fee}}</span></span></p>\n  \t\t\t</div>\n  \t\t\t<div class="item">\n  \t\t\t\t<span class="assertive">\n  \t\t\t\t\t{{order.order_status | status}}\n  \t\t\t\t\t<em ng-if="order.refund_status == 1">(\u9000\u8D27\u7533\u8BF7\u4E2D)</em>\n  \t\t\t\t\t<em ng-if="order.refund_status == 2">(\u540C\u610F\u9000\u8D27)</em>\n  \t\t\t\t\t<em ng-if="order.refund_status == 3">(\u62D2\u7EDD\u9000\u8D27)</em>\n  \t\t\t\t\t<em ng-if="order.refund_status == 4">(\u9000\u8D27\u6210\u529F)</em>\n  \t\t\t\t\t<em ng-if="order.exchange_status == 1">(\u6362\u8D27\u7533\u8BF7\u4E2D)</em>\n  \t\t\t\t\t<em ng-if="order.exchange_status == 2">(\u540C\u610F\u6362\u8D27)</em>\n  \t\t\t\t\t<em ng-if="order.exchange_status == 3">(\u62D2\u7EDD\u6362\u8D27)</em>\n  \t\t\t\t\t<em ng-if="order.exchange_status == 4">(\u6362\u8D27\u6210\u529F)</em>\n  \t\t\t\t</span>\n  \t\t\t\t<button class="button button-small button-dark right" style="margin-left:10px;" ng-if="order.order_status == 0" ng-click="cancleOrder(order)">\u53D6\u6D88\u8BA2\u5355</button>\n\t\t    \t<button class="button button-small button-dark right" ng-if="order.order_status == 0" ng-click="payOrder(order.good_id,order.order_type,order.tuan_id)">\u53BB\u652F\u4ED8</button>\n\t\t    \t<button class="button button-small button-dark right" style="margin-left:10px;" ng-if="order.order_status == 6 && order.refund_status==0 && order.exchange_status==0" ng-click="openRequestModal(order)">\u9000\u6362\u8D27\u7533\u8BF7</button>\n\t\t    \t<button class="button button-small button-dark right" style="margin-left:10px;" ng-if="order.refund_logistics_no == null && (order.refund_status == 2 || order.exchange_status == 2)" ng-click="openLogisticsModal(order)">\u586B\u5199\u5355\u53F7</button>\n\t\t    \t<button class="button button-small button-dark right" ng-if="order.order_status == 6 || order.order_status == 8" ng-click="finishOrder(order)">\u786E\u8BA4\u6536\u8D27</button>\n  \t\t\t</div>\n\n\t\t    <div ng-repeat-end></div>\n  \t\t\t\n  \t\t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/order_view.html','<ion-view>\n\t<ion-content>\n\t\t<div class="state" ng-class="{state_1:order.order_status==1,state_2:order.order_status==6,state_3:order.order_status==10}">\n\t\t\t<div class="state_step">\n\t            <ul>\n\t                <li class="state_step_1"></li>\n\t                <li class="state_step_2"></li>\n\t                <li class="state_step_3"></li>\n\t            </ul>\n\t            <span class="state_arrow">\n\t            \t<i class="state_arrow_i"></i>\n\t            \t<i class="state_arrow_o"></i>\n\t            </span>\n\t        </div>\n        </div>\n\t\t<div class="list">\n\t\t\t<div class="item order_info_item">\n\t\t\t\t<p><strong>\u8BA2\u5355\u72B6\u6001\uFF1A</strong>\n\t\t\t\t\t<span class="assertive">{{order.order_status | status}}</span>\n\t\t\t\t</p>\n\t\t\t\t<p><strong>\u603B\u989D\uFF1A</strong><span class="assertive" style="font-size:14px;">{{order.order_fee}}</span>\uFF08\u5FAE\u4FE1\u652F\u4ED8\uFF09</p>\n\t\t\t\t<p><strong>\u9001\u81F3\uFF1A</strong>{{order.address_province+order.address_city+order.address_area+order.address_detail}}</p>\n\t\t\t\t<p><strong>\u6536\u8D27\u4EBA\uFF1A</strong>{{order.address_recipient}}({{order.address_phone}})</p>\n\t\t\t\t<p><strong>\u8BA2\u5355\u7F16\u53F7\uFF1A</strong>{{order.order_no}}</p>\n\t\t\t\t<p><strong>\u4E0B\u5355\u65F6\u95F4\uFF1A</strong>{{order.create_time*1000 | date:"yyyy-MM-dd HH:mm:ss"}}</p>\n\n\t\t\t\t<p ng-if="order.order-status==6"><strong>\u7269\u6D41\u516C\u53F8\uFF1A</strong>{{order.compnay_name}}</p>\n\t\t\t\t<p ng-if="order.order-status==6"><strong>\u7269\u6D41\u5355\u53F7\uFF1A</strong>{{order.logistics_no}}</p>\n\n\t\t\t\t<p ng-if="order.refund_status == 1">\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u9000\u8D27\u7533\u8BF7\u4E2D</span>\n\t\t\t\t</p>\n\n\t\t\t\t<p ng-if="order.refund_status == 2">\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u540C\u610F\u9000\u8D27</span>\n\t\t\t\t</p>\n\n\t\t\t\t<p ng-if="order.refund_status == 3">\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u62D2\u7EDD\u9000\u8D27</span>\n\t\t\t\t</p>\n\n\t\t\t\t<p ng-if="order.refund_status == 4">\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u9000\u8D27\u5B8C\u6210</span>\n\t\t\t\t</p>\n\n\n\t\t\t\t<p ng-if="order.exchange_status == 1"><\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u6362\u8D27\u7533\u8BF7\u4E2D</span>\n\t\t\t\t</p>\n\n\t\t\t\t<p ng-if="order.exchange_status == 2"><\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u540C\u610F\u6362\u8D27</span>\n\t\t\t\t</p>\n\n\t\t\t\t<p ng-if="order.exchange_status == 3"><\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u62D2\u7EDD\u6362\u8D27</span>\n\t\t\t\t</p>\n\n\t\t\t\t<p ng-if="order.exchange_status == 4"><\t\t\t\t\t\n\t\t\t\t\t<span class="assertive">\u6362\u8D27\u6210\u529F</span>\n\t\t\t\t</p>\n\n\t\t\t</div>\n\t\t\t<div class="item item-divider">\u5546\u54C1\u4FE1\u606F</div>\n\t\t\t<a class="item item-thumbnail-left" href="#/good?goodId={{order.good_id}}">\n\t\t\t\t<img ng-src="{{order.good_image}}">\n\t\t\t    <h2>{{order.good_title}}</h2>\n\t\t\t    <p>\u6570\u91CF\uFF1A{{order.order_num}}</p>\n\t\t\t    <p>\u5E93\u5B58\uFF1A{{order.stock_num}}</p>\n\t\t\t    <span class="assertive right" ng-if="type == \'tuan\'">{{order.tuan_price}}/\u4EF6</span>\n\t\t\t    <span class="assertive right" ng-if="type == \'single\'">{{order.single_price}}/\u4EF6</span>\n\t\t\t</a>\n\t\t\t<div class="item" ng-if="order.tuan_status!=0">\n\t\t\t\t<a class="button button-default button-small" style="float:right;" href="#/tuan?tuanId={{order.tuan_id}}">\u67E5\u770B\u56E2\u8BE6\u60C5</a>\n\t\t\t</div>\n\t\t</div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/profile.html','<ion-view title="\u4E2A\u4EBA\u8D44\u6599">\n \t<ion-header-bar class="bar-positive">\n \t\t<a class="button button-icon icon ion-ios-arrow-left button-clear" href="#/app/my"></a>\n\t\t<div class="title">\u4E2A\u4EBA\u8D44\u6599</div>\n\t</ion-header-bar>\n\t<ion-content class="has-header">\n\t\t<div class="list">\n\t\t\t<a class="item item-avatar item-icon-right" ng-click="profile.avatarPick()" id="profile-avatar">\n\t\t  \t\t<img ng-src="{{profile.profile.user_avatar}}" src="{{profile.profile.user_avatar}}" fallback-src="img/default.jpg" id="avatar">\n\t\t  \t\t<span class="input-label">\u5934\u50CF</span>\n\t\t  \t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t  \t</a>\t\n\t\t  \t<label class="item item-input">\n\t\t    \t<span class="input-label">\u6635\u79F0</span>\n\t\t    \t<input type="text" placeholder="\u6635\u79F0" ng-model="profile.profile.nickname">\n\t\t \t </label>\n\t\t  \t<label class="item item-input">\n\t\t    \t<span class="input-label">\u7B7E\u540D</span>\n\t\t    \t<textarea placeholder="\u7B7E\u540D" ng-model="profile.profile.signature"></textarea>\n\t\t  \t</label>\n\t\t</div>\n\t\t<div class="padding">\n            <button ng-click="profile.saveProfile()" type="submit" class="button button-block button-positive">\u4FDD\u5B58</button>\n        </div>\n\t</ion-content>\n</ion-view>');
$templateCache.put('templates/register.html','<ion-view title="\u6CE8\u518C" id="test">\n    <ion-content>\n        <div id="logo">\n            <div class="pulse1"></div>\n            <div class="pulse2"></div>\n            <div class="profilepicture"></div>\n        </div>\n        <form name="regForm">\n            <div class="list list-inset login">\n                <label class="item item-input">\n                    <input type="email" name="email" ng-model="register.user.email" placeholder="\u90AE\u7BB1" required>\n                    <div class="error" ng-if="regForm.email.$touched && regForm.email.$dirty && regForm.email.$invalid">\n                        <small class="error" ng-if="regForm.email.$error.required">\n                            \u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                        <small class="error" ng-if="regForm.email.$error.email">\n                            \u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E\n                        </small>\n                    </div>\n                </label>\n\n                <label class="item item-input">\n                    <input type="password" name="password" ng-model="register.user.password" placeholder="\u5BC6\u7801" required\n                           ng-minlength="6" ng-maxlength="20">\n                    <div class="error"\n                         ng-if="regForm.password.$touched && regForm.password.$dirty && regForm.password.$invalid">\n                        <small class="error" ng-if="regForm.password.$error.required">\n                            \u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\n                        </small>\n                        <small class="error"\n                               ng-if="regForm.password.$error.minlength || regForm.password.$error.maxlength">\n                            \u8BF7\u8F93\u51656-20\u4F4D\u5BC6\u7801\n                        </small>\n                    </div>\n                </label>\n\n                <label class="item item-input">\n                    <input type="password" name="password2" ng-model="register.user.password2" placeholder="\u786E\u8BA4\u5BC6\u7801"\n                           required compare-to="user.password">\n                    <div class="error">\n                        <small class="error" ng-if="regForm.password2.$touched && regForm.password2.$error.compareTo">\n                            \u5BC6\u7801\u4E0D\u4E00\u81F4\n                        </small>\n                    </div>\n                </label>\n\n            </div>\n            <div class="padding">\n                <button ng-click="register.doRegister()"\n                        ng-disabled="(regForm.email.$touched||regForm.password.$touched||regForm.password2.$touched)&&regForm.$invalid"\n                        type="submit" class="button button-block button-light">\u6CE8\u518C\n                </button>\n            </div>\n            <div class="padding">\n                <div class="row">\n                    <div class="col text-left"><a href="#/find" style="color:#fff;">\u5FD8\u8BB0\u5BC6\u7801?</a></div>\n                    <div class="col text-right"><a href="#/login" style="color:#fff;">\u5DF2\u6709\u5E10\u53F7</a></div>\n                </div>\n            </div>\n            <div class="padding login-more text-center" ng-if-start="register.isQQInstalled||register.isWeiboInstalled||register.isXiaoMiChannel">\n                <p class="title">\u7B2C\u4E09\u65B9\u5E10\u53F7\u767B\u5F55</p>\n            </div>\n            <div class="padding login-toolbar text-center" ng-if-end>\n                <i class="iconfont light" ng-if="register.isQQInstalled" ng-click="register.doQQLogin()">&#xe602;</i>\n                <!--                     <i class="iconfont balanced" ng-click="doWechatLogin()">&#xe611;</i>\n                 --> <i class="iconfont light" ng-if="register.isWeiboInstalled" ng-click="register.doWeiboLogin()">&#xe607;</i>\n                <i class="iconfont light" ng-if="register.isXiaomiChannel" ng-click="login.doXiaomiLogin()">\n                    &#xe64f;</i>\n            </div>\n        </form>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/setting.html','<ion-view title="\u8BBE\u7F6E">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/app/my"></a>\n\t\t<div class="title">\u8BBE\u7F6E</div>\n\t</ion-header-bar>\n\t<ion-content class="">\n\t\t<div class="list">\n\t\t\t<div class="item item-divider"><center>\u6C34\u6EF4\u6253\u5361 v{{setting.localVersionNo}}</center></div>\n\n\t\t\t<a class="item item-icon-right" href="#/feedback">\n\t\t\t\t\u610F\u89C1\u53CD\u9988\n\t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t</a>\n\t  \t\t<a class="item item-icon-right" href="#/about">\n\t\t\t\t\u5173\u4E8E\u6211\u4EEC\n\t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t</a>\n\t\t\t<a class="item item-icon-right" href="#/donate">\n\t\t\t\t\u6350\u8D60\u6211\u4EEC\n\t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t</a>\n\t\t\t<a class="item item-icon-right" href="javascript:void(0);" ng-click="setting.doRate()">\n\t\t\t\t\u4E94\u661F\u597D\u8BC4\n\t\t\t\t<i class="icon ion-ios-arrow-right"></i>\n\t\t\t</a>\n\t  \t\t<a class="item" href="javascript:void(0);" ng-if="setting.isOpenCheck&&!setting.isNeedUpdate">\n\t\t\t\t\u68C0\u67E5\u66F4\u65B0\n\t\t\t\t<span class="item-note">\u5F53\u524D\u5DF2\u662F\u6700\u65B0\u7248\u672C</span>\n\t  \t\t</a>\n\n\t\t\t<a class="item" href="javascript:void(0);" ng-if="setting.isOpenCheck&&setting.isNeedUpdate" ng-click="setting.doUpdate()">\n\t\t\t\t\u68C0\u67E5\u66F4\u65B0\n\t\t\t\t<span class="item-note positive">\u53D1\u73B0\u65B0\u7248\u672C v{{setting.latestVersion.no}}(\u70B9\u51FB\u66F4\u65B0)</span>\n\t\t\t</a>\n\t\t</div>\n\t</ion-content>\n</ion-view>\n');
$templateCache.put('templates/top.html','<ion-view title="\u6392\u884C\u699C">\n\t<ion-header-bar align-title="center" class="bar-positive">\n\t\t<div class="title">\n\t\t\t{{top.month}} \u6708\u6253\u5361\u6392\u884C\n\t\t</div>\n\t\t<!-- <div class="title padding-top">\n\t\t\t<ti-segmented-control on-select="getTop($index)" style="width: 200px;margin:0 auto;">\n\t\t\t    <ti-segmented-control-button class="button-positive" title="\'\u76EE\u6807\'"></ti-segmented-control-button>\n\t\t\t    <ti-segmented-control-button class="button-positive" title="\'\u4E2A\u4EBA\'" selected></ti-segmented-control-button>\n\t\t\t</ti-segmented-control>\n\t\t</div> -->\n\t</ion-header-bar>\n\t<ion-content class="has-header">\n\n\t\t<div class="list">\n\t\t\t\t <div class="item item-divider">\u672C\u6708\u6253\u5361 {{top.count}} \u6B21<span class="pull-right">\u6392\u540D {{top.rank}}</span></div>\n\n \t\t\t    <a class="item item-avatar item-icon-right" ng-repeat="user in top.users" href="#/user/{{user.user_id}}">\n\t\t        \t<img ng-src="{{user.user_avatar}}" fallback-src="img/default.jpg">\n\t\t        \t<h2>{{user.nickname.length > 0?user.nickname:\'keeper\'+user.user_id}}</h2>\n\t\t        \t<p>\u6B21\u6570\uFF1A{{user.count}}</p>\n\t\t\t\t\t<i class="icon iconfont energized" style="right:42px;" ng-if="$index==0">&#xe611</i>\n\t\t\t\t\t<i class="icon iconfont balanced" style="right:42px;" ng-if="$index==1">&#xe612</i>\n\t\t\t\t\t<i class="icon iconfont royal" style="right:42px;" ng-if="$index==2">&#xe613</i>\n\n\t\t\t\t\t<span class="badge" ng-class="getClass($index + 1)" ng-if="$index>2">NO.{{$index + 1}}</span>\n\t\t      \t</a>\n\n\t\t </div>\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/topic.html','<ion-view >\n    <!--<cover-header-parallax header-size="150" bg-color="[0, 121, 107]">-->\n        <!--<div class="padding-top padding-right" style="padding-top:50px;background-color: #0C9;height:100%; color: #fff;">-->\n        <!--<h4 style="color: #fff;">#\u6BCF\u5468\u5171\u8BFB\u4E00\u672C\u4E66#</h4>-->\n        <!--<p>\u5DF2\u670932\u4EBA\u53C2\u4E0E</p>-->\n    <!--</div>-->\n    <!--</cover-header-parallax>-->\n    <ion-header-bar ng-class="{\'bar-hidden\':topic.position<80}" class="bar-positive">\n        <go-back></go-back>\n        <div class="title">#{{topic.topicName}}#</div>\n    </ion-header-bar>\n    <div ng-hide="topic.position>80" class="bar bar-subheader bar-positive text-center" style="height:100px;border-top:0;">\n        <h4 style="color: #fff;">#{{topic.topicName}}#</h4>\n        <p>\u5DF2\u6709{{topic.topic.follow_count}}\u4EBA\u53C2\u4E0E</p>\n    </div>\n\n    <ion-pane ng-style="{\'top\':(topic.position>80)?\'0px\':\'100px\'}" style="background-color:#e5e5e5;">\n        <ion-tabs class="tabs-top tabs-striped tabs-color-positive">\n\n            <ion-tab title="\u7CBE\u9009"  on-select="topic.onTabSelected(\'hot\')">\n                <ion-content class="has-header" ng-style="{\'top\':(topic.position>80)?\'0px\':\'100px\'}" style="background-color:#e5e5e5;padding-top:10px;" on-scroll="topic.getScrollPosition()">\n                    <event-list events="topic.events" on-refresh="topic.doRefresh()"\n                                on-infinite="topic.loadMore()"></event-list>\n\n                </ion-content>\n            </ion-tab>\n\n            <ion-tab title="\u5168\u90E8"  on-select="topic.onTabSelected(\'new\')">\n                <ion-content class="has-header" ng-style="{\'top\':(topic.position>80)?\'0px\':\'100px\'}" style="background-color:#e5e5e5;padding-top:10px;" on-scroll="topic.getScrollPosition()">\n                    <event-list events="topic.events" on-refresh="topic.doRefresh()"\n                                on-infinite="topic.loadMore()"></event-list>\n                </ion-content>\n            </ion-tab>\n        </ion-tabs>\n    </div>\n\n    </ion-pane>\n\n    <!--<ion-content class="has-header" style="background-color:#e5e5e5;" on-scroll="topic.getScrollPosition()">-->\n        <!--<event-list events="topic.events" on-refresh="topic.doRefresh()"-->\n                    <!--on-infinite="topic.loadMore()"></event-list>-->\n\n    <!--</ion-content>-->\n</ion-view>');
$templateCache.put('templates/user_energy.html','<ion-view title="\u80FD\u91CF\u660E\u7EC6">\n    <div class="bar bar-header bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#app/my"></a>\n        <div class="title">\u80FD\u91CF\u660E\u7EC6</div>\n    </div>\n    <div class="bar bar-positive bar-subheader" style="height:104px;">\n        <div class="padding text-center" style="width:100%;">\n            <h2 class="light">{{userenergy.user.energy_count}}</h2>\n\n            <div class="row">\n                <div class="col">\n                    <a href="#/mall" class="light">\n                        <i class="icon ion-ios-briefcase-outline"></i>\n                        \u80FD\u91CF\u5546\u57CE\n                    </a>\n                </div>\n                <div class="col">\n                    <a href="#/energy/help" class="light">\n                        <i class="icon ion-ios-paper-outline"></i>\n                        \u89C4\u5219\u8BF4\u660E\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n    <ion-content class="hasheader has-subheader" style="top:148px;">\n\n        <div class="list">\n            <li class="item" ng-repeat="log in userenergy.logs">\n                <h3>{{log.name2}}</h3>\n                <p>{{log.create_time*1000 |date:"yyyy-MM-dd" }}</p>\n                <span class="badge" ng-class="{ \'positive\':log.change>0,\'assertive\':log.change<0}">{{log.change>0?\'+\'+log.change:log.change}}</span>\n            </li>\n\n        </div>\n        <!--<ion-infinite-scroll-->\n                <!--ng-if="canScroll"-->\n                <!--on-infinite="loadMore()"-->\n                <!--distance="1%">-->\n            <!--\u663E\u793A\u66F4\u591A-->\n        <!--</ion-infinite-scroll>-->\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/user_fans.html','<ion-view title="{{userfans.user.nickname}} \u7684\u7C89\u4E1D">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/user/{{userfans.user.user_id}}"></a>\n        <div class="title">{{userfans.user.nickname}} \u7684\u7C89\u4E1D</div>\n    </ion-header-bar>\n    <ion-content>\n        <ion-refresher\n                pulling-text="\u4E0B\u62C9\u5237\u65B0..."\n                on-refresh="userfans.doRefresh()">\n        </ion-refresher>\n        <div class="list" >\n            <a class="item item-avatar item-icon-right" href="#/user/{{user.user_id}}" ng-repeat="user in userfans.users">\n                <img ng-src="{{user.user_avatar}}" fallback-src="img/default.jpg">\n                <h2>{{user.nickname.length>0?user.nickname:\'keeper\'+user.user_id}}</h2>\n                <!--<button class="button button-positive button-outline button-small">-->\n                    <!--\u5173\u6CE8-->\n                <!--</button>-->\n                <i class="icon ion-ios-arrow-right"></i>\n            </a>\n            <a class="item text-center" ng-if="userfans.users.length == 0">\n                \u6682\u65F6\u8FD8\u6CA1\u6709\u4EBA\u5173\u6CE8Ta\u3002\n            </a>\n        </div>\n\n        <ion-infinite-scroll\n                on-infinite="userfans.loadMore()"\n                distance="1%">\n            \u663E\u793A\u66F4\u591A\n        </ion-infinite-scroll>\n    </ion-content>\n\n</ion-view>');
$templateCache.put('templates/user_follow.html','<ion-view title="{{userfollow.user.nickname}} \u7684\u5173\u6CE8">\n    <ion-header-bar class="bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/user/{{userfollow.user.user_id}}"></a>\n        <div class="title">{{userfollow.user.nickname}} \u7684\u5173\u6CE8</div>\n    </ion-header-bar>\n    <ion-content>\n        <ion-refresher\n                pulling-text="\u4E0B\u62C9\u5237\u65B0..."\n                on-refresh="userfollow.doRefresh()">\n        </ion-refresher>\n        <div class="list" >\n            <a class="item item-avatar item-icon-right" href="#/user/{{user.user_id}}" ng-repeat="user in userfollow.users" ng-if="userfollow.users.length>0">\n                <img ng-src="{{user.user_avatar}}" fallback-src="img/default.jpg">\n                <h2>{{user.nickname.length>0?user.nickname:\'keeper\'+user.user_id}}</h2>\n                <!--<button class="button button-positive button-outline button-small">-->\n                <!--\u5173\u6CE8-->\n                <!--</button>-->\n                <i class="icon ion-ios-arrow-right"></i>\n\n            </a>\n            <a class="item text-center" ng-if="userfollow.users.length == 0">\n                \u6682\u65F6\u8FD8\u6CA1\u6709Ta\u5173\u6CE8\u7684\u4EBA\n            </a>\n        </div>\n\n        <ion-infinite-scroll\n                on-infinite="userfollow.loadMore()"\n                distance="1%">\n            \u663E\u793A\u66F4\u591A\n        </ion-infinite-scroll>\n    </ion-content>\n\n</ion-view>');
$templateCache.put('templates/user_goals.html','<ion-view>\n    <ion-header-bar class="bar-positive">\n        <go-back></go-back>\n        <div class="title">xx\u7684\u76EE\u6807</div>\n    </ion-header-bar>\n    <ion-content>\n        <ti-segmented-control on-select="usergoals.getEvents($index)" style="width: 200px;margin:0 auto;">\n            <ti-segmented-control-button class="button-positive" title="\'\u8FDB\u884C\u4E2D\'"\n                                         selected></ti-segmented-control-button>\n            <ti-segmented-control-button class="button-positive" title="\'\u5DF2\u8FC7\u671F\'"></ti-segmented-control-button>\n        </ti-segmented-control>\n\n        <div class="list">\n            <div class="item item-icon-right" ng-repeat="goal in usergoals.goals">\n                <h2>{{goal.goal_name}}</h2>\n                <p>\u5F53\u524D\u8FDB\u5EA6:10/20</p>\n                <i class="icon ion-ios-arrow-right"></i>\n            </div>\n        </div>\n    </ion-content>\n</ion-view>\n');
$templateCache.put('templates/user_home.html','<ion-view>\n    <ion-header-bar ng-class="{\'bar-hidden\':userhome.position<80}" class="bar-positive">\n        <go-back></go-back>\n        <div class="title">{{userhome.user.nickname}}</div>\n        <a class="button button-icon button-clear ion-ios-more" ng-click="userhome.showMenu($event)"\n           ng-if="!userhome.isSelf"></a>\n    </ion-header-bar>\n    <div ng-hide="userhome.position>80" class="bar bar-subheader bar-positive text-center"\n         style="height:280px;border-top:0;border-bottom:0;padding:0;">\n        <div class="padding-bottom text-center" style="background-color: #00cc99;color:#fff;width:100%;">\n            <div class="row">\n                <div class="col"></div>\n                <div class="col">\n                    <img class="profilepicture2" ng-src="{{userhome.user.user_avatar}}"\n                         fallback-src="img/default.jpg" width="96" height="96">\n                </div>\n                <div class="col">\n                    <div class="row">\n                        <div class="col"><a href="#/user/{{userhome.user.user_id}}/follow"><span class="num"\n                                                                                                 style="color:#fff;">{{userhome.user.follow_count}}</span></a><br>\u5173\u6CE8\n                        </div>\n                        <div class="col"><a href="#/user/{{userhome.user.user_id}}/fans"><span class="num"\n                                                                                               style="color:#fff;">{{userhome.user.fans_count}}</span></a><br>\u7C89\u4E1D\n                        </div>\n                    </div>\n\n                    <div class="row">\n                        <div class="col">\n                            <button class="button button-small button-outline button-light"\n                                    ng-if="!userhome.isSelf&&!userhome.isFollow"\n                                    style="width:96px;" ng-click="userhome.doFollow(userhome.user.user_id)">\n                                <i class="icon ion-person-add"></i> \u5173\u6CE8Ta\n                            </button>\n                            <button class="button button-small button-outline button-light"\n                                    ng-if="!userhome.isSelf&&userhome.isFollow"\n                                    style="width:96px;" ng-click="userhome.unFollow(userhome.user.user_id)">\n                                <i class="icon ion-ios-checkmark-empty"></i> \u5DF2\u5173\u6CE8\n                            </button>\n                            <a class="button button-small button-outline button-light" ng-if="userhome.isSelf"\n                               style="width:96px;" href="#/profile">\n                                <i class="icon ion-compose"></i> \u7F16\u8F91\u8D44\u6599\n                            </a>\n                        </div>\n                        <!--<div class="col">-->\n                        <!--<button class="button button-small button-outline button-dark"-->\n                        <!--style="">-->\n                        <!--<i class="icon ion-email"></i> \u79C1\u4FE1-->\n                        <!--</button>-->\n                        <!--</button>-->\n                        <!--</div>-->\n                    </div>\n                </div>\n            </div>\n            <h3 style="color:#fff;font-size:18px;margin-top:0px;">\n                {{userhome.user.nickname.length>0?userhome.user.nickname:\'keeper\'+userhome.user.user_id}}\n                <span class="level" ng-if="userhome.user.level>0"><a href="#/user/{{userhome.user.user_id}}/level">{{userhome.level}}</a></span>\n            </h3>\n            <p style="margin-left: 8px; margin-right: 8px;">{{userhome.user.signature}}</p>\n\n        </div>\n\n        <div class="row center" style="background-color:#fff;color:#aaa;position:absolute;bottom:0;left: 0;right: 0;">\n            <div class="col" style="border-right: 1px solid #ccc;"><span\n                    class="num">{{userhome.user.goal_count}}</span><br>\u76EE\u6807\n            </div>\n            <div class="col" style="border-right: 1px solid #ccc;"><span\n                    class="num">{{userhome.user.checkin_count}}</span><br>\u6253\u5361\n            </div>\n            <div class="col"><a href="#/user/{{userhome.user.user_id}}/energy"><span class="num">{{userhome.user.energy_count}}</span></a><br>\u80FD\u91CF\n            </div>\n        </div>\n\n\n    </div>\n    <ion-content style="background-color:#e5e5e5;padding-top:20px;" on-scroll="userhome.getScrollPosition()"\n                 ng-style="{\'top\':(userhome.position>80)?\'0px\':\'300px\'}">\n        <div class="" style="margin-top:20px;">\n            <div class="item item-divider">\u52A8\u6001</div>\n        </div>\n        <event-list events="userhome.events" on-refresh="userhome.doRefresh()"\n                    on-infinite="userhome.loadMore()"></event-list>\n\n    </ion-content>\n</ion-view>\n\n\n');
$templateCache.put('templates/user_home_menu.html','<ion-popover-view style="width:100px;" class="fit">\n    <ion-content>\n        <div class="list">\n            <a class="item"  ng-click="userhome.blacklist()">\n                \u62C9\u9ED1\n            </a>\n            <a class="item" ng-click="userhome.report()">\n                \u4E3E\u62A5</a>\n        </div>\n    </ion-content>\n</ion-popover-view>\n');
$templateCache.put('templates/user_level.html','<ion-view title="\u7B49\u7EA7">\n    <div class="bar bar-header bar-positive">\n        <a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/app/my"></a>\n        <div class="title">\u7B49\u7EA7</div>\n    </div>\n    <div class="bar bar-positive bar-subheader" style="height:124px;">\n        <div class="padding text-center" style="width:100%;">\n            <h2 class="light">{{userlevel.level}}</h2>\n\n            <div class="row center" style="color:#ddd;">\n                <div class="col"><span\n                        class="num" style="color:#fff;">{{userlevel.count}}</span><br>\u6253\u5361\u6B21\u6570</div>\n                <div class="col"><span class="num" style="color:#fff;">{{userlevel.rank}}</span><br>\u6392\u540D</div>\n            </div>\n        </div>\n    </div>\n    <ion-content class="has-header has-subheader" style="top:188px;">\n\n        <div class="list">\n            <div class="item item-button-right">\n                <h2>\u5361\u6E23</h2>\n                <p>{{userlevel.levels[1]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 5</button>\n            </div>\n\n            <div class="item item-button-right">\n                <h2>\u5361\u5F31</h2>\n                <p>{{userlevel.levels[2]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 10</button>\n            </div>\n\n            <div class="item item-button-right">\n                <h2>\u5361\u6C11</h2>\n                <p>{{userlevel.levels[3]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 20</button>\n            </div>\n\n            <div class="item item-button-right">\n                <h2>\u5361\u9738</h2>\n                <p>{{userlevel.levels[4]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 50</button>\n            </div>\n\n            <div class="item item-button-right">\n                <h2>\u5361\u5C0A</h2>\n                <p>{{userlevel.levels[5]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 100</button>\n            </div>\n\n            <div class="item item-button-right">\n                <h2>\u5361\u5723</h2>\n                <p>{{userlevel.levels[6]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 200</button>\n            </div>\n\n            <div class="item item-button-right">\n                <h2>\u5361\u795E</h2>\n                <p>{{userlevel.levels[7]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 500</button>\n            </div>\n\n            <div class="item item-button-right">\n                <h2>\u5361\u5E1D</h2>\n                <p>{{userlevel.levels[8]}} \u4EBA\u5728\u6B64\u7B49\u7EA7</p>\n                <button class="button button-clear button-large button-positive">\u2265 1000</button>\n            </div>\n        </div>\n        <!--<ul class="timeline">-->\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u6E23</h4>-->\n                    <!--<p>\u521D\u6765\u548B\u5230,\u6BEB\u65E0\u8868\u73B0\u3002</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570>=10-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u5F31</h4>-->\n                    <!--<p>\u6682\u9732\u5934\u89D2,\u4F46\u8FD8\u662F\u6BD4\u8F83\u5F31</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 100+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u6C11</h4>-->\n                    <!--<p>\u666E\u666E\u901A\u901A\u7684\u6253\u5361\u7FA4\u4F17\u3002\u3002</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 200+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u9738</h4>-->\n                    <!--<p>\u521D\u5177\u5B9E\u529B,\u79F0\u9738\u4E00\u65B9\u3002\u3002\u3002</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 500+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u5C0A</h4>-->\n                    <!--<p>\u4E07\u4EBA\u4EF0\u6155,\u4E5D\u4E94\u81F3\u5C0A</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 2000+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u5723</h4>-->\n                    <!--<p>\u5723\u5149</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 5000+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u4ED9</h4>-->\n                    <!--<p>\u8D85\u51E1\u8131\u4FD7,\u5F97\u9053\u6210\u4ED9</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 5,000+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u795E</h4>-->\n                    <!--<p>\u795E\u4E00\u6837\u7684\u5B58\u5728</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 10,000+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n            <!--<li>-->\n                <!--<div class="timeline-thumb timeline-icon bg-color-gray">-->\n                    <!--<i class="ion-flash"></i>-->\n                <!--</div>-->\n                <!--<div class="timeline-item">-->\n                    <!--<h4>\u5361\u5E1D</h4>-->\n                    <!--<p>\u81F3\u9AD8\u5883\u754C</p>-->\n                    <!--<div class="timeline-stats">-->\n                        <!--\u5B8C\u6210\u6761\u4EF6:\u6253\u5361\u6B21\u6570 100,000+-->\n                        <!--<span class="pos-absolute-right"><i class="ion-ios-clock"></i> 20123 \u4EBA\u5728\u6B64\u7B49\u7EA7</span>-->\n                    <!--</div>-->\n                <!--</div>-->\n            <!--</li>-->\n\n        <!--</ul>-->\n\n    </ion-content>\n</ion-view>');
$templateCache.put('templates/user_tag.html','<ion-view title="\u4E3B\u9875">\n \t<ion-header-bar class="bar-positive">\n \t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/app/my"></a>\n\t\t<div class="title">\u6211\u7684\u6807\u7B7E</div>\n\t</ion-header-bar>\n<ion-content>\n\t\t<div class="item item-input-inset">\n\t\t\t  <label class="item-input-wrapper">\n\t\t\t    <i class="icon ion-search placeholder-icon"></i>\n\t\t\t    <input type="search" placeholder="\u641C\u7D22\u6807\u7B7E" ng-model="goalsearch.search.text">\n\t\t\t    <i ng-if="search.text.length > 0" ng-click="clearSearch()" class="icon ion-close"></i>\n\t\t\t  </label>\n\t  \t</div>\n\t\t<div class="list">\n\t\t    <a class="item item-icon-right" href="#/tag/{{tag.tag_id}}" ng-repeat="tag in tags | filter:search.text">\n\t\t\t      \t<p>{{tag.tag_name}} ({{tag.follow_count}})</p>\n\t\t\t      \t<i class="icon ion-ios-arrow-right"></i>\n\t\t    </a>\n\t\t</div>\n</ion-content>');
$templateCache.put('templates/version.html','<ion-view title="\u7248\u672C\u66F4\u65B0">\n\t<ion-header-bar class="bar-positive">\n\t\t<a class="button button-icon icon ion-ios-arrow-left butoon-clear" href="#/app/setting"></a>\n\t\t<div class="title">\u7248\u672C\u66F4\u65B0</div>\n\t</ion-header-bar>\n\t<ion-content class="padding">\n\t\t<div class="list card">\n\t\t\t<div class="item">\n\t\t\t    <h2>\u7248\u672C\u53F7\uFF1Av0.0.4</h2>\n\t\t\t    <p>\u66F4\u65B0\u65E5\u671F\uFF1A2015-08-31</p>\t\t  \n\t\t\t </div>\n\t\t\t  <div class="item item-body">\n\t\t\t    <p>\u66F4\u65B0\u5185\u5BB9\uFF1A</p> \n\t\t\t    <p>1:\u589E\u52A0\u53D1\u73B0\u529F\u80FD</p>\n\t\t\t    <p>2:\u589E\u52A0\u6D88\u606F\u529F\u80FD</p>\n\t\t\t    <p>3:\u589E\u52A0\u4E2A\u4EBA\u8BBE\u7F6E\u529F\u80FD</p>\n\t\t\t   \t<p>4:\u589E\u52A0\u4E2A\u4EBA\u4E3B\u9875\u529F\u80FD</p>\n\t  \t\t</div>\n\t\t</div>\n\t\t<div class="list card">\n\t\t\t<div class="item">\n\t\t\t    <h2>\u7248\u672C\u53F7\uFF1Av0.0.3</h2>\n\t\t\t    <p>\u66F4\u65B0\u65E5\u671F\uFF1A2015-08-26</p>\t\t  \n\t\t\t </div>\n\t\t\t  <div class="item item-body">\n\t\t\t  \t<p>\u66F4\u65B0\u5185\u5BB9\uFF1A</p> \n\t\t\t    <p>1:\u6539\u8FDB\u5E95\u90E8\u5BFC\u822A\u4E3A\u4FA7\u8FB9\u680F</p>\n\t\t\t    <p>2:\u4FEE\u6539\u6253\u5361\u65B9\u5F0F</p>\n\t\t\t    <p>3:\u53D6\u6D88\u5C0F\u7EC4\u66F4\u6539\u4E3A\u76EE\u6807</p>\n\t  \t\t</div>\n\t\t</div>\n\n\t\t<div class="list card">\n\t\t\t<div class="item">\n\t\t\t    <h2>\u7248\u672C\u53F7\uFF1Av0.0.2</h2>\n\t\t\t    <p>\u66F4\u65B0\u65E5\u671F\uFF1A2015-08-16</p>\t\t  \n\t\t\t </div>\n\t\t\t  <div class="item item-body">\n\t\t\t    <p>\u66F4\u65B0\u5185\u5BB9\uFF1A</p> \n\t\t\t    <p>1:\u4FEE\u6B63\u90E8\u5206ui</p>\n\t\t\t    <p>2:\u589E\u52A0\u6807\u7B7E\u529F\u80FD</p>\n\t\t\t    <p>3:\u589E\u52A0\u8865\u6253\u5361\u529F\u80FD</p>\n\t  \t\t</div>\n\t\t</div>\n\n\t\t<div class="list card">\n\t\t\t<div class="item">\n\t\t\t    <h2>\u7248\u672C\u53F7\uFF1Av0.0.1</h2>\n\t\t\t    <p>\u66F4\u65B0\u65E5\u671F\uFF1A2015-08-01</p>\t\t  \n\t\t\t </div>\n\t\t\t  <div class="item item-body">\n\t\t\t    <p>\u66F4\u65B0\u5185\u5BB9\uFF1A</p> \n\t\t\t    <p>\u5168\u65B0\u6784\u9020app</p>\n\t  \t\t</div>\n\t\t</div>\n\t</ion-content>\n</ion-view>');}]);